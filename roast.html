<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Roast Bot</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts - Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #1a202c; /* Dark background for the body */
            color: #e2e8f0; /* Light text color */
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        /* Navbar Styling (Dungeon Escape inspired) */
        .navbar {
            background-image: linear-gradient(to right, #2d3748, #1a202c); /* Darker gradient */
            padding: 1rem;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.4);
            display: flex;
            justify-content: space-between; /* Space out items */
            align-items: center;
            border-bottom-left-radius: 1rem;
            border-bottom-right-radius: 1rem;
            position: sticky;
            top: 0;
            z-index: 1000;
        }
        .navbar-title {
            color: #a78bfa; /* Purple-ish color for title */
            font-size: 2rem; /* Larger font for title */
            font-weight: 800; /* Extra bold */
            letter-spacing: 0.1em; /* Wider tracking */
            text-transform: uppercase;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5); /* Subtle shadow */
            flex-grow: 1; /* Allow title to grow */
            text-align: center; /* Center the title */
        }
        .navbar-link {
            color: #cbd5e0; /* Light gray for links */
            font-weight: 600;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            transition: background-color 0.2s ease-in-out;
            text-decoration: none; /* Remove underline */
        }
        .navbar-link:hover {
            background-color: rgba(255, 255, 255, 0.1); /* Slight highlight on hover */
        }

        /* Chat Container Styling */
        .chat-container {
            background-color: #2d3748; /* Slightly lighter dark background for container */
            border-radius: 1rem; /* Rounded corners */
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.3); /* Subtle shadow */
            padding: 1.5rem;
            max-width: 700px;
            width: 95%;
            margin: 2rem auto; /* Center the container with margin */
            display: flex;
            flex-direction: column;
            gap: 1rem;
            flex-grow: 1; /* Allow container to grow */
        }

        /* Chat Messages Area */
        #chatMessages {
            flex-grow: 1;
            overflow-y: auto; /* Enable scrolling for chat history */
            padding-right: 0.5rem; /* Space for scrollbar */
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
            min-height: 250px; /* Minimum height for chat area */
            max-height: 60vh; /* Max height to prevent it from taking too much space */
        }

        /* Individual Message Styling */
        .message-bubble {
            max-width: 80%; /* Limit bubble width */
            padding: 0.75rem 1rem;
            border-radius: 1rem;
            word-wrap: break-word; /* Ensure long words wrap */
        }
        .user-message {
            background-color: #4c51bf; /* Blue for user messages */
            align-self: flex-end; /* Align to the right */
            border-bottom-right-radius: 0.25rem; /* Sharper corner on one side */
        }
        .bot-message {
            background-color: #6b46c1; /* Purple for bot messages */
            align-self: flex-start; /* Align to the left */
            border-bottom-left-radius: 0.25rem; /* Sharper corner on one side */
        }

        /* Input and Button Area */
        .input-area {
            display: flex;
            gap: 0.75rem;
            margin-top: 1rem;
        }
        #userInput {
            flex-grow: 1; /* Allow input to take available space */
            background-color: #4a5568; /* Darker input background */
            border: 1px solid #6b7280; /* Border color */
            color: #e2e8f0; /* Text color */
            padding: 0.75rem;
            border-radius: 0.5rem;
            font-size: 1rem;
            outline: none; /* Remove outline on focus */
        }
        #userInput:focus {
            border-color: #a78bfa; /* Highlight border on focus */
        }
        #sendMessageButton {
            background-image: linear-gradient(to right, #6b46c1, #805ad5); /* Purple gradient for button */
            color: white;
            font-weight: bold;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
            white-space: nowrap; /* Prevent button text from wrapping */
        }
        #sendMessageButton:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 8px rgba(0, 0, 0, 0.3);
        }
        #sendMessageButton:active {
            transform: translateY(0);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        /* Loading and Error Indicators */
        .loading-indicator, .error-message {
            text-align: center;
            font-weight: bold;
            padding: 0.5rem;
            border-radius: 0.5rem;
            margin-top: 0.5rem;
        }
        .loading-indicator {
            color: #a0aec0; /* Gray-ish color */
        }
        .error-message {
            color: #fc8181; /* Red color for errors */
            background-color: #c5303020; /* Light red background */
            border: 1px solid #c53030;
        }
    </style>
</head>
<body>
    <!-- Navbar - Mimicking Dungeon Escape style -->
    <nav class="navbar">
        <a href="turtle.html" class="navbar-link">Back to Games</a>
        <div class="navbar-title">Roast Bot</div>
        <!-- Placeholder for symmetry, or add another link/icon if needed -->
        <div class="w-24 text-right"></div>
    </nav>

    <main class="flex-grow flex items-center justify-center p-4">
        <div class="chat-container">
            <h1 class="text-3xl font-extrabold text-center text-purple-300 mb-4">Chat with the Roast Bot!</h1>
            <div id="chatMessages" class="overflow-y-auto">
                <!-- Chat messages will be appended here -->
            </div>

            <div id="loadingIndicator" class="loading-indicator hidden">Roasting... Please wait.</div>
            <div id="errorMessage" class="error-message hidden"></div>

            <div class="input-area">
                <input type="text" id="userInput" placeholder="Ask for a roast or chat..." class="w-full">
                <button id="sendMessageButton">Send Roast</button>
            </div>
        </div>
    </main>

    <script>
        // Get references to HTML elements
        const userInput = document.getElementById('userInput');
        const sendMessageButton = document.getElementById('sendMessageButton');
        const chatMessages = document.getElementById('chatMessages');
        const loadingIndicator = document.getElementById('loadingIndicator');
        const errorMessage = document.getElementById('errorMessage');

        // Initialize chat history for the bot. This will maintain context for the AI.
        let chatHistory = [
            { role: "model", parts: [{ text: "Hello there! I'm the Roast Bot. Tell me something, and I'll give it a lighthearted, humorous roast. Or just chat!" }] }
        ];

        // Function to display messages in the chat interface
        function displayMessage(role, text) {
            const messageBubble = document.createElement('div');
            messageBubble.classList.add('message-bubble');
            messageBubble.textContent = text;

            if (role === 'user') {
                messageBubble.classList.add('user-message');
            } else {
                messageBubble.classList.add('bot-message');
            }
            chatMessages.appendChild(messageBubble);

            // Scroll to the bottom of the chat
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        // Display initial bot message
        displayMessage('model', chatHistory[0].parts[0].text);

        // Function to send message and get roast from API
        async function sendMessage() {
            const userText = userInput.value.trim();

            // Clear previous error messages
            errorMessage.textContent = '';
            errorMessage.classList.add('hidden');

            if (!userText) {
                errorMessage.textContent = 'Please type a message!';
                errorMessage.classList.remove('hidden');
                return;
            }

            // Display user message
            displayMessage('user', userText);
            chatHistory.push({ role: "user", parts: [{ text: userText }] });

            // Clear input field
            userInput.value = '';

            // Show loading indicator and disable button
            loadingIndicator.classList.remove('hidden');
            sendMessageButton.disabled = true;

            try {
                // Construct the payload for the Gemini API
                // The prompt is designed to encourage conversational roasting
                const payload = {
                    contents: [
                        ...chatHistory, // Send the entire chat history for context
                        {
                            role: "user",
                            parts: [{ text: `Based on our conversation so far, please provide a short, humorous, and lighthearted roast, or continue the conversation in a witty, slightly sarcastic, but friendly tone. Keep it to 1-3 sentences. Do not be genuinely offensive.` }]
                        }
                    ]
                };

                const apiKey = ""; // Canvas will automatically provide the API key at runtime
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(`API error: ${response.status} - ${errorData.error.message || response.statusText}`);
                }

                const result = await response.json();

                // Check if the response structure is as expected
                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    const botResponse = result.candidates[0].content.parts[0].text;
                    displayMessage('model', botResponse);
                    chatHistory.push({ role: "model", parts: [{ text: botResponse }] }); // Add bot response to history
                } else {
                    throw new Error('Unexpected API response structure or no content found.');
                }

            } catch (error) {
                console.error('Error fetching roast:', error);
                errorMessage.textContent = `Failed to get a response: ${error.message}. Please try again.`;
                errorMessage.classList.remove('hidden');
                // If there's an error, we might want to remove the last user message from history
                // or handle it differently depending on desired behavior. For now, we'll leave it.
            } finally {
                // Hide loading indicator and enable button
                loadingIndicator.classList.add('hidden');
                sendMessageButton.disabled = false;
                userInput.focus(); // Keep input focused for continuous chat
            }
        }

        // Event listeners for sending messages
        sendMessageButton.addEventListener('click', sendMessage);
        userInput.addEventListener('keypress', (event) => {
            if (event.key === 'Enter') {
                sendMessage();
            }
        });

        // Focus on input when page loads
        userInput.focus();
    </script>
</body>
</html>
