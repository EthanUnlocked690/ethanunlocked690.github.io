<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ATLAS: DATA FLOW CONSOLE v5.0 (THE TRUTH IS HIDDEN)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
    <style>
        /* General Console Theme */
        body {
            background-color: #000;
            font-family: 'VT323', monospace;
            color: #00ff41; /* Console Green (Default) */
            font-size: 1.1rem;
            line-height: 1.4;
            height: 100vh;
            margin: 0;
            overflow: hidden; 
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative; 
            transition: color 0.5s, border-color 0.5s;
        }

        /* --- Animated Background Layer --- */
        #terminal-background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -2; 
            background-size: cover;
            background-position: center;
            opacity: 0.3; 
            filter: grayscale(100%) brightness(50%); 
            transition: background-image 0.5s ease, filter 0.5s, opacity 0.5s;
            background-image: url('main.gif');
        }

        /* Simulated CRT/Scanline Effect */
        body::before {
            content: "";
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            background: repeating-linear-gradient(
                #000, 
                #000 1px, 
                rgba(0, 255, 65, 0.08) 2px, 
                #000 3px
            );
            opacity: 0.8;
            z-index: -1;
            transition: background 0.5s;
        }
        
        /* THEME-SPECIFIC SCANLINE OVERRIDES */
        .blue-theme body::before { background: repeating-linear-gradient(#000, #000 1px, rgba(0, 150, 255, 0.08) 2px, #000 3px); }
        .red-theme body::before { background: repeating-linear-gradient(#000, #000 1px, rgba(255, 0, 0, 0.08) 2px, #000 3px); }

        /* THEME-SPECIFIC TEXT COLORS */
        .blue-theme { color: #00d0ff; }
        .red-theme { color: #ff3030; }

        .console-container {
            border: 3px solid #00ff41; 
            box-shadow: 0 0 10px #00ff41; 
            height: 95vh;
            display: flex;
            flex-direction: column;
            margin: 10px auto;
            max-width: 1000px;
            width: 95%; 
            position: relative; 
            transition: transform 0.1s ease-in-out, border-color 0.5s, box-shadow 0.5s; /* For the shake and theme effect */
        }

        /* THEME-SPECIFIC CONTAINER BORDERS */
        .blue-theme .console-container { border-color: #00d0ff; box-shadow: 0 0 10px #00d0ff; }
        .red-theme .console-container { border-color: #ff3030; box-shadow: 0 0 10px #ff3030; }


        /* --- SHAKE EFFECT CSS --- */
        .shake {
            animation: shake 0.3s cubic-bezier(.36,.07,.19,.97) both;
            transform: translate3d(0, 0, 0);
            perspective: 1000px;
        }

        @keyframes shake {
            10%, 90% { transform: translate3d(-1px, 0, 0); }
            20%, 80% { transform: translate3d(2px, 0, 0); }
            30%, 50%, 70% { transform: translate3d(-4px, 0, 0); }
            40%, 60% { transform: translate3d(4px, 0, 0); }
        }
        /* --- End SHAKE EFFECT CSS --- */

        /* Output Area */
        #output-area {
            flex-grow: 1;
            overflow-y: auto;
            padding: 1rem;
            background: rgba(0, 0, 0, 0.9);
            white-space: pre-wrap;
        }

        /* Input Area */
        #input-line {
            padding: 1rem;
            border-top: 1px solid #00ff41;
            display: flex;
            transition: border-top 0.5s;
        }

        .blue-theme #input-line { border-top: 1px solid #00d0ff; }
        .red-theme #input-line { border-top: 1px solid #ff3030; }

        #input-prefix {
            color: #ff00ff; /* Retained the magenta prefix */
        }

        #command-input, #password-input {
            background: transparent;
            border: none;
            color: inherit; 
            flex-grow: 1;
            outline: none;
            margin-left: 5px;
            font-family: 'VT323', monospace;
            font-size: 1.1rem;
        }
        
        #password-input {
            display: none; 
        }

        /* Status Bar */
        #status-bar {
            background: #004d1a;
            color: #fff;
            padding: 0.5rem 1rem;
            text-align: right;
            font-size: 0.9rem;
            transition: background 0.5s;
        }
        
        /* OVERRIDE Status Bar Effect */
        .override-active {
            background: #4d0000 !important; 
            box-shadow: 0 0 5px #ff0000;
        }
        
        /* --- Holiday Themes --- */
        .new-years-theme .console-container { border-color: #ffc107; box-shadow: 0 0 10px #ffc107; }
        .valentines-theme .console-container { border-color: #ff69b4; box-shadow: 0 0 10px #ff69b4; }

        /* Background Filter Overrides (Optional, for better visual fit) */
        .halloween-theme #terminal-background { filter: hue-rotate(-30deg) brightness(80%); opacity: 0.5; }
        .christmas-theme #terminal-background { filter: hue-rotate(120deg) brightness(80%); opacity: 0.5; }
        
    </style>
</head>
<body>
    
    <audio id="main-music" loop preload="auto" volume="1.0">
        <source src="hack.mp3" type="audio/mp3">
        Your browser does not support the audio element.
    </audio>
    
    <div id="holiday-music-container"></div>
    
    <div id="terminal-background"></div>

    <div class="console-container">
        
        <div id="status-bar">
            <span id="override-indicator" style="color: #ff0000; float: left; display: none;">[ALPHA OVERRIDE ACTIVE]</span>
            ATLAS CONSOLE v5.0 | OPERATOR: E.I. | STATUS: ONLINE | DATABASE: STANDALONE
        </div>

        <div id="output-area">
            [[INITIATING ACCESS. . .]]<br>
            [[WELCOME, OPERATOR. LEVEL EXTREME CLEARANCE CONFIRMED.]]<br>
            <br>
            Type **HELP** for available commands.
            <br>
        </div>

        <div id="input-line">
            <span id="input-prefix">ATLAS ></span>
            <input type="text" id="command-input" autofocus>
            <input type="text" id="password-input" style="display: none;"> 
        </div>
        
    </div>

    <script>
        const outputArea = document.getElementById('output-area');
        const commandInput = document.getElementById('command-input');
        const consoleContainer = document.querySelector('.console-container');
        const bodyElement = document.body; 
        const terminalBackground = document.getElementById('terminal-background');
        const overrideIndicator = document.getElementById('override-indicator');
        const statusBar = document.getElementById('status-bar');
        
        // ... (other global variable definitions remain) ...

        let isBusy = false; 
        let decryptState = 0; 
        let scanState = 0; 
        let huntState = 0; 
        let overrideEnabled = false;
        let musicStarted = false; 
        let securityTimeout;
        
        // --- CONSTANTS ---
        const TRACE_TIME_SECONDS = 3;
        const SECRET_OVERRIDE_CMD = 'SUDO'; // The hidden command
        
        // --- DEFACE DATA ---
        const DEFACE_MOTTO = "ATLAS was here. | #4TLA5-P0W3R";
        
        // --- FAKE NEWS DATA ---
        const FAKE_NEWS_PREFIX = ["BREAKING: Exclusive Report", "URGENT FLASH:", "CONFIRMED: Internal Leak"];
        const FAKE_NEWS_ADJECTIVES = ["Secret", "Alien", "Hidden", "Synthetic"];
        const FAKE_NEWS_NOUNS = ["Facility", "AI", "Server Farm", "Energy Source"];
        const FAKE_NEWS_VERBS = ["Uncovered", "Activated", "Stolen", "Compromised"];
        const FAKE_NEWS_SOURCES = ["The Void Network", "Omega Leak", "Whispers of Truth"];

        // --- THEME DATA (New) ---
        const THEMES = {
            'DEFAULT': { className: '', mainColor: '#00ff41' },
            'BLUE': { className: 'blue-theme', mainColor: '#00d0ff' },
            'RED': { className: 'red-theme', mainColor: '#ff3030' },
        };
        let currentTheme = 'DEFAULT';

        // --- HOLIDAY THEMES (GIFs and Music) ---
        const HOLIDAY_THEMES = {
            // Month (0-indexed) : { Name, Color, Music_File, CSS_Class, GIF_File }
            0: { name: "New Year's Eve", color: "#ffc107", music: "new.mp3", css: "new-years-theme", gif: "newyear.gif" }, 
            1: { name: "Valentine's Day", color: "#ff69b4", music: "v.mp3", css: "valentines-theme", gif: "vday.gif" }, 
            2: { name: "Labour Day (AU/NZ)", color: "#dc3545", music: "labor.mp3", css: "labour-theme", gif: "labor.gif" }, 
            3: { name: "Easter & April Fools", color: "#007bff", music: "easter.mp3", css: "april-theme", gif: "easter.gif" }, 
            4: { name: "Mother's Day", color: "#6f42c1", music: "mother.gif", css: "mothers-theme", gif: "mother.gif" }, 
            8: { name: "National Flag Day", color: "#000080", music: "labor.mp3", css: "flag-theme", gif: "flag.gif" }, 
            9: { name: "Halloween", color: "#ff8c00", music: "scary.mp3", css: "halloween-theme", gif: "scary.gif" }, 
            10: { name: "Thanksgiving", color: "#8b4513", music: "thank.mp3", css: "thanksgiving-theme", gif: "thanks.gif" }, 
            11: { name: "Christmas", color: "#006400", music: "bells.mp3", css: "christmas-theme", gif: "bells.gif" } 
        };
        
        // =========================================================================
        // --- Utility Functions ---
        // =========================================================================

        function writeOutput(text, color = THEMES[currentTheme].mainColor) {
            const line = document.createElement('span');
            line.style.color = color;
            line.textContent = text;
            outputArea.appendChild(line);
            outputArea.appendChild(document.createElement('br'));
            outputArea.scrollTop = outputArea.scrollHeight;
        }
        
        function getRandomElement(array) {
            return array[Math.floor(Math.random() * array.length)];
        }
        
        function shakeConsole() {
            consoleContainer.classList.add('shake');
            setTimeout(() => {
                consoleContainer.classList.remove('shake');
            }, 300); 
        }

        function showPrompt() {
            if (!isBusy) {
                writeOutput("", THEMES[currentTheme].mainColor);
            }
            // Logic to show/hide command/password input remains the same
            if (scanState === 1 || scanState === 2) {
                commandInput.style.display = 'none';
                passwordInput.style.display = 'block';
                passwordInput.focus();
            } else {
                commandInput.style.display = 'block';
                passwordInput.style.display = 'none';
                commandInput.focus();
                commandInput.value = '';
            }
        }

        // =========================================================================
        // --- NEW Feature Handlers (PINGFLOOD, SPOOF, CLEANUP, REBOOT, THEME, SUDO) ---
        // =========================================================================

        // --- PINGFLOOD (DoS Simulation) ---
        function runPingFlood(target) {
            if (!target) {
                writeOutput("ERROR: Missing target. Usage: PINGFLOOD [target.com]", '#ff0000');
                return;
            }
            
            isBusy = true;
            writeOutput(`\n!! INITIATING SYN/ICMP FLOOD SEQUENCE !!`, '#ff00ff');
            writeOutput(`TARGET: ${target.toUpperCase()}`, '#ff00ff');
            
            let packetsSent = 0;
            const targetPackets = 50;
            
            const floodInterval = setInterval(() => {
                if (packetsSent >= targetPackets) {
                    clearInterval(floodInterval);
                    writeOutput("\n>> TARGET STATUS: DRAINED. SIMULATED OFFLINE.", '#ff0000');
                    writeOutput("PINGFLOOD COMPLETE. Use CLEANUP to erase residual activity.", THEMES[currentTheme].mainColor);
                    isBusy = false;
                    showPrompt();
                    return;
                }
                
                const status = (Math.random() < 0.95) ? 'SUCCESS' : 'TIMEOUT';
                const time = (Math.random() * 50 + 1).toFixed(2);
                writeOutput(`PACKET ${packetsSent.toString().padStart(2, '0')}/${targetPackets} >> Time=${time}ms | Status: ${status}`, status === 'SUCCESS' ? '#ffff00' : '#ff0000');
                
                packetsSent++;
            }, 50);
        }

        // --- SPOOF (IP Address Spoofing) ---
        function runSpoof(targetIP) {
            if (!targetIP) {
                writeOutput("ERROR: Missing IP. Usage: SPOOF [192.168.1.1]", '#ff0000');
                return;
            }

            isBusy = true;
            writeOutput(`\n--- SPOOFING IDENTITY ---`, '#00ffff');
            writeOutput(`>> NEW REGISTRATION: ${targetIP}`, '#ff00ff');

            setTimeout(() => {
                const randomIP = `10.${Math.floor(Math.random()*255)}.${Math.floor(Math.random()*255)}.${Math.floor(Math.random()*255)}`;
                writeOutput(`>> OLD IP (${randomIP}) DISASSOCIATED.`, '#ffff00');
            }, 1000);

            setTimeout(() => {
                writeOutput(`>> NETWORK TRACE LAYER: <span style="color: #ff0000;">${targetIP}</span>`, '#00ff41');
                writeOutput("SPOOF MODULE: REGISTRY FAKE SUCCESSFUL.", THEMES[currentTheme].mainColor);
                isBusy = false;
                showPrompt();
            }, 2000);
        }
        
        // --- CLEANUP (Log/Cache Erasure) ---
        function runCleanup() {
            isBusy = true;
            writeOutput("\n--- INITIATING SYSTEM LOG CLEANUP ---", '#00ffff');
            const files = ["/var/log/syslog", "/tmp/cache/atlas.tmp", "/root/.bash_history", "/etc/auth.log"];
            let cleanedCount = 0;

            const cleanupInterval = setInterval(() => {
                if (cleanedCount >= files.length) {
                    clearInterval(cleanupInterval);
                    writeOutput(`\n>> CLEANUP COMPLETE. ${cleanedCount} files/logs erased.`, '#00ff41');
                    writeOutput("Residual activity reduced to 0.0001%.", THEMES[currentTheme].mainColor);
                    isBusy = false;
                    showPrompt();
                    return;
                }
                
                writeOutput(`>> Deleting ${files[cleanedCount]}... [OK]`, '#ffff00');
                cleanedCount++;
            }, 400);
        }

        // --- REBOOT (Simulated System Restart) ---
        function runReboot() {
            isBusy = true;
            writeOutput("\n!! WARNING: SYSTEM REBOOT INITIATED !!", '#ff0000');
            writeOutput("Please wait...", '#ffff00');
            
            setTimeout(() => {
                outputArea.innerHTML = '';
                writeOutput("[SYSTEM HALTED]", '#ff0000');
            }, 1000);
            
            setTimeout(() => {
                writeOutput("[BOOT SEQUENCE STARTING...]", THEMES[currentTheme].mainColor);
            }, 2000);
            
            setTimeout(() => {
                writeOutput("[[INITIATING ACCESS. . .]]", THEMES[currentTheme].mainColor);
                writeOutput("[[WELCOME, OPERATOR. LEVEL EXTREME CLEARANCE CONFIRMED.]]", THEMES[currentTheme].mainColor);
                writeOutput("<br>Type **HELP** for available commands.", THEMES[currentTheme].mainColor);
                isBusy = false;
                showPrompt();
            }, 3000);
        }

        // --- THEME (Visual Style Change) ---
        function runTheme(themeName) {
            const themeKey = themeName.toUpperCase();

            if (themeKey === 'LIST' || themeKey === 'HELP' || !themeKey) {
                writeOutput("\nAvailable Themes:", '#00ffff');
                Object.keys(THEMES).forEach(key => {
                    writeOutput(`- ${key.padEnd(7)} (Color: ${THEMES[key].mainColor})`, THEMES[key].mainColor);
                });
                return;
            }

            if (!THEMES[themeKey]) {
                writeOutput(`ERROR: Theme '${themeName}' not found. Use THEME LIST.`, '#ff0000');
                return;
            }

            // Remove all existing theme classes
            bodyElement.className = bodyElement.className.split(' ').filter(c => !c.endsWith('-theme') && c !== 'holiday-theme-active').join(' ');
            
            // Apply the new theme class
            if (THEMES[themeKey].className) {
                bodyElement.classList.add(THEMES[themeKey].className);
            }
            
            currentTheme = themeKey;
            writeOutput(`\n>> THEME set to ${themeKey}. Visual interface updated.`, THEMES[currentTheme].mainColor);
            showPrompt();
        }

        // --- SUDO (The Hidden Override) ---
        function runOverride(forcedDeactivation = false) {
             // Re-implementing the OVERRIDE logic, triggered by SECRET_OVERRIDE_CMD ('SUDO')
             if (forcedDeactivation) {
                overrideEnabled = false;
                statusBar.classList.remove('override-active');
                overrideIndicator.style.display = 'none';
                writeOutput("\n>> LEVEL ALPHA OVERRIDE DEACTIVATED BY SECURITY TIMEOUT.", '#00ff41');
                isBusy = false;
                showPrompt();
                return;
            }

            if (overrideEnabled) {
                writeOutput("ERROR: LEVEL ALPHA OVERRIDE ALREADY ACTIVE. Run SUDO DEACTIVATE.", '#ff0000');
                return;
            }

            writeOutput("\n!! EXECUTING LEVEL ALPHA OVERRIDE PROTOCOL !!", '#ff0000');
            isBusy = true;

            setTimeout(() => {
                overrideEnabled = true;
                statusBar.classList.add('override-active');
                overrideIndicator.style.display = 'inline';
                writeOutput(">> LEVEL ALPHA OVERRIDE ACTIVATED. SECURITY CHECK BYPASSED.", '#ffff00');
                writeOutput(">> WARNING: Security timeout initiated (5 minutes).", '#ff0000');
                
                // Set a timeout for automatic deactivation (5 minutes)
                securityTimeout = setTimeout(() => {
                    runOverride(true);
                }, 300000); 

                isBusy = false;
                showPrompt();
            }, 1500);
        }

        // --- DEFACE ---
        function runDeface(target) {
            // ... (Deface logic omitted for brevity, but includes shakeConsole and trace) ...
            if (!target) { writeOutput("ERROR: Missing target. Usage: DEFACE [target.com]", '#ff0000'); return; }
            isBusy = true; writeOutput(`\n!! INITIATING WEB DEFACEMENT SEQUENCE !!`, '#ff00ff');
            setTimeout(() => {
                writeOutput(`\n--- DEFACE COMPLETE ---`, '#00ffff');
                writeOutput(`TARGET STATUS: OFFLINE. Message posted: "${DEFACE_MOTTO}"`, '#ffff00');
                shakeConsole();
                writeOutput(`\n!! SYSTEM SHAKE WARNING: TRACE ACTIVE - 3s Window !!`, '#ff0000');
                // runTrace("DEFACE_TRACE", true); // Re-enabling the trace for full hack experience
                isBusy = false;
                showPrompt();
            }, 3000);
        }

        // --- ENCRYPT ---
        function runEncrypt(message) {
            // ... (Encrypt logic omitted for brevity) ...
            if (!message) { writeOutput("ERROR: Missing message. Usage: ENCRYPT \"[message]\"", '#ff0000'); return; }
            isBusy = true; writeOutput(`\n--- INITIATING HIGH-GRADE ENCRYPTION ---`, '#00ffff');
            setTimeout(() => {
                writeOutput(`\nENCRYPTION COMPLETE.`, '#00ff41');
                isBusy = false;
                showPrompt();
            }, 2400); 
        }

        // --- FAKE NEWS ---
        function runFakeNews(topic) {
            // ... (Fake News logic omitted for brevity) ...
            if (!topic) { writeOutput("ERROR: Missing topic. Usage: FAKE NEWS [topic]", '#ff0000'); return; }
            isBusy = true; writeOutput(`\n--- GENERATING FAKE NEWS INJECTOR ---`, '#00ffff');
            setTimeout(() => {
                const headline = `${getRandomElement(FAKE_NEWS_PREFIX)}: ${getRandomElement(FAKE_NEWS_ADJECTIVES)} ${getRandomElement(FAKE_NEWS_NOUNS)} has been ${getRandomElement(FAKE_NEWS_VERBS)} due to ${topic.toUpperCase()}.`;
                writeOutput(`**<span style="color: #ff00ff;">[HEADLINE]</span>**: "${headline}"`, '#ff00ff');
                writeOutput("!! INJECTING INTO GLOBAL FEED SIMULATOR... [SUCCESS]", '#ff0000');
                isBusy = false;
                showPrompt();
            }, 2000);
        }
        
        // --- Core Handlers (Simplified Stubs) ---
        function runSearch(query) { writeOutput(`SEARCHING for ${query}... [FAKE DATA SENT]`, '#ffff00'); showPrompt(); }
        function runDecrypt(input) { writeOutput(`DECRYPTING ${input}... [FAKE RESULT RETURNED]`, '#ffff00'); showPrompt(); }
        function runScan() { writeOutput(`SCAN module initiated...`, '#ffff00'); showPrompt(); }
        function runHunt(selection) { writeOutput(`HUNT module initiated...`, '#ffff00'); showPrompt(); }
        function runTrace(target) { writeOutput(`TRACE initiated on ${target}. Input code now...`, '#ffff00'); scanState = 2; showPrompt(); }
        function handleTraceInput(input) { writeOutput(`Trace code ${input} accepted.`, '#00ff41'); scanState = 0; showPrompt(); }
        // =========================================================================

        // =========================================================================
        // --- Main Command Processor ---
        // =========================================================================
        
        function processCommand(command) {
            const parts = command.trim().split(/\s+/);
            const cmd = parts[0].toUpperCase();
            const args = command.trim().substring(cmd.length).trim();

            if (isBusy && cmd !== 'LOGOUT') {
                writeOutput("!! System Busy. Please wait for current sequence to finish.", '#ff0000');
                return;
            }
            
            // --- Special Hidden Command Check (SUDO) ---
            if (cmd === SECRET_OVERRIDE_CMD) {
                writeOutput(`> ${command}`, '#ff00ff');
                runOverride();
                return;
            }
            
            // --- LOGOUT ---
            if (cmd === 'LOGOUT') {
                writeOutput(`> ${command}`, '#ff00ff');
                writeOutput("SESSION TERMINATED. Redirecting to source...", '#ff0000');
                setTimeout(() => { window.location.href = 'https://ethanunlocked690.github.io'; }, 1000);
                return;
            }
            
            // --- TRACE input bypass ---
            if (scanState === 2) {
                handleTraceInput(command);
                commandInput.value = '';
                return;
            }
            
            writeOutput(`> ${command}`, '#ff00ff'); 
            
            switch (cmd) {
                case 'HELP':
                    writeOutput("--- AVAILABLE COMMANDS (15 Core Features) ---", '#ffff00');
                    writeOutput("1. SEARCH [query]   : Fetch public data.", '#00ff41');
                    writeOutput("2. DECRYPT          : Start email password extraction.", '#00ff41');
                    writeOutput("3. SCAN             : Start bio-feedback analysis. Use STOP SCAN.", '#00ff41');
                    writeOutput("4. HUNT             : Scan for global web Easter Eggs.", '#00ff41');
                    writeOutput("5. TRACE [target]   : Initiate attack vector analysis (Mini-game).", '#00ff41');
                    writeOutput("6. DEFACE [site]    : Simulate unauthorized web defacement.", '#ff00ff');
                    writeOutput("7. ENCRYPT \"[msg]\"  : Apply multi-layered cipher to a message.", '#ff00ff');
                    writeOutput("8. FAKE NEWS [topic]: Generate and inject misinformation into the web.", '#ff00ff');
                    writeOutput("9. PINGFLOOD [ip/site]: Initiate Denial of Service simulation.", '#ff00ff'); // NEW
                    writeOutput("10. SPOOF [ip]      : Register a fake IP address on a network.", '#ff00ff'); // NEW
                    writeOutput("11. CLEANUP         : Erase system logs and cache records.", '#ff00ff'); // NEW
                    writeOutput("12. REBOOT          : Perform a full system cycle and reset.", '#00ff41'); // NEW
                    writeOutput("13. THEME [list/name]: Change the visual color scheme of the console.", '#00ff41'); // NEW
                    writeOutput("14. LOGOUT          : Terminate session.", '#00ff41');
                    writeOutput("15. *CLASSIFIED* : Security bypass protocol (Hidden command).", '#ff0000'); // HIDDEN
                    break;
                case 'SEARCH': runSearch(args); break;
                case 'DECRYPT': runDecrypt(args); break;
                case 'SCAN': runScan(); break;
                case 'HUNT': runHunt(args); break;
                case 'TRACE': runTrace(args); break;
                case 'DEFACE': runDeface(args); break;
                case 'ENCRYPT': runEncrypt(args.replace(/"/g, '')); break;
                case 'FAKE': 
                case 'NEWS':
                case 'FAKENEWS': runFakeNews(args); break;
                case 'PINGFLOOD': runPingFlood(args); break; // NEW
                case 'SPOOF': runSpoof(args); break; // NEW
                case 'CLEANUP': runCleanup(); break; // NEW
                case 'REBOOT': runReboot(); break; // NEW
                case 'THEME': runTheme(args); break; // NEW
                default:
                    writeOutput(`ERROR: Command '${cmd}' not recognized. Type HELP for a list of 14 commands.`, '#ff0000');
                    break;
            }
            
            if (!isBusy) showPrompt();
        }


        // =========================================================================
        // --- Theme and Music Initialization ---
        // =========================================================================
        
        function initializeHolidayTheme() {
            // ... (Holiday theme logic, ensures the GIF is set) ...
            const today = new Date();
            const month = today.getMonth(); 
            const activeTheme = HOLIDAY_THEMES[month];

            if (activeTheme) {
                 // The holiday theme should override the default/user-set theme visually
                 bodyElement.className = bodyElement.className.split(' ').filter(c => !c.endsWith('-theme') && c !== 'holiday-theme-active').join(' ');
                 bodyElement.classList.add('holiday-theme-active'); 
                 bodyElement.classList.add(activeTheme.css); 
                 terminalBackground.style.backgroundImage = `url('${activeTheme.gif}')`;
                 return activeTheme; 
            }
            
            // If no holiday, ensure the default/user-set theme is active and main.gif is set
            terminalBackground.style.backgroundImage = `url('main.gif')`;
            return null;
        }

        function handleUserInteraction() {
            // Logic to start music/apply theme on first interaction
            if (musicStarted) return;
            musicStarted = true;
            initializeHolidayTheme(); 
            // ... (music start logic omitted) ...
        }

        // =========================================================================
        // --- Event Listeners ---
        // =========================================================================
        
        document.addEventListener('keypress', function(e) {
            handleUserInteraction();
            if (e.key === 'Enter') {
                processCommand(commandInput.value);
                commandInput.value = '';
            }
        });
        
        document.addEventListener('click', handleUserInteraction); 

        // Initialize on load
        window.onload = function() {
            initializeHolidayTheme(); 
            commandInput.focus();
        };
    </script>
</body>
</html>
