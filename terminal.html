<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ATLAS: DATA FLOW CONSOLE v4.2 (HIGH-LEVEL ACCESS)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
    <style>
        /* General Console Theme */
        body {
            background-color: #000;
            font-family: 'VT323', monospace;
            color: #00ff41; /* Console Green (Default) */
            font-size: 1.1rem;
            line-height: 1.4;
        }

        /* Simulated CRT/Scanline Effect */
        body::before {
            content: "";
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            background: repeating-linear-gradient(
                #000, 
                #000 1px, 
                rgba(0, 255, 65, 0.08) 2px, 
                #000 3px
            );
            opacity: 0.8;
            z-index: -1;
        }

        .console-container {
            border: 3px solid #00ff41; /* Default Border */
            box-shadow: 0 0 10px #00ff41; /* Default Shadow */
            height: 95vh;
            display: flex;
            flex-direction: column;
            margin: 10px auto;
            max-width: 1000px;
        }

        /* Output Area */
        #output-area {
            flex-grow: 1;
            overflow-y: auto;
            padding: 1rem;
            background: rgba(0, 0, 0, 0.9);
            white-space: pre-wrap;
        }

        /* Input Area */
        #input-line {
            padding: 1rem;
            border-top: 1px solid #00ff41;
            display: flex;
        }

        #input-prefix {
            color: #ff00ff;
        }

        #command-input, #password-input {
            background: transparent;
            border: none;
            color: inherit; /* Inherit color from body/theme */
            flex-grow: 1;
            outline: none;
            margin-left: 5px;
            font-family: 'VT323', monospace;
            font-size: 1.1rem;
        }
        
        #password-input {
            display: none; 
        }

        /* Status Bar */
        #status-bar {
            background: #004d1a;
            color: #fff;
            padding: 0.5rem 1rem;
            text-align: right;
            font-size: 0.9rem;
        }
        
        /* OVERRIDE Status Bar Effect */
        .override-active {
            background: #4d0000 !important; /* Dark Red */
            box-shadow: 0 0 5px #ff0000;
        }
        
        /* TRACE Challenge Display */
        #trace-challenge-container {
            font-size: 2rem;
            font-weight: bold;
            text-align: center;
            padding: 10px;
            margin: 10px 0;
            border: 3px solid #ff0000;
            background-color: #110000;
            color: #ff0000;
        }
        #trace-code {
            color: #ffff00;
            letter-spacing: 5px;
        }
        #trace-timer {
            font-size: 1rem;
            color: #00ffff;
        }

        /* SCAN Panel Styles */
        #lie-detector-panel {
            border: 1px solid #00ffff;
            padding: 1rem;
            margin: 1rem 0;
            background: rgba(0, 0, 0, 0.8);
        }
        #video-feed {
            width: 100%;
            max-height: 200px;
            background-color: #001a0a;
            border: 1px solid #00ff41;
            display: block;
        }
        .scan-data {
            margin-top: 10px;
            line-height: 1.6;
        }
        .data-label {
            color: #00ffff;
        }
        .data-value {
            color: #ff00ff;
        }
        #lie-status {
            font-size: 1.5rem;
            font-weight: bold;
            text-align: center;
            margin-top: 10px;
        }
        
        /* --- Holiday Themes --- */
        .new-years-theme .console-container { border-color: #ffc107; box-shadow: 0 0 10px #ffc107; }
        .valentines-theme .console-container { border-color: #ff69b4; box-shadow: 0 0 10px #ff69b4; }
        .labour-theme .console-container { border-color: #dc3545; box-shadow: 0 0 10px #dc3545; }
        .april-theme .console-container { border-color: #007bff; box-shadow: 0 0 10px #007bff; }
        .anzac-theme .console-container { border-color: #6c757d; box-shadow: 0 0 10px #6c757d; }
        .mothers-theme .console-container { border-color: #6f42c1; box-shadow: 0 0 10px #6f42c1; }
        .flag-theme .console-container { border-color: #000080; box-shadow: 0 0 10px #000080; }
        .halloween-theme .console-container { border-color: #ff8c00; box-shadow: 0 0 10px #ff8c00; }
        .thanksgiving-theme .console-container { border-color: #8b4513; box-shadow: 0 0 10px #8b4513; }
        .christmas-theme .console-container { border-color: #006400; box-shadow: 0 0 10px #006400; }
        
    </style>
</head>
<body class="p-4">
    
    <audio id="main-music" loop preload="auto">
        <source src="hack.mp3" type="audio/mp3">
        Your browser does not support the audio element.
    </audio>

    <div class="console-container">
        
        <div id="status-bar">
            <span id="override-indicator" style="color: #ff0000; float: left; display: none;">[ALPHA OVERRIDE ACTIVE]</span>
            ATLAS CONSOLE v4.2 | OPERATOR: E.I. | STATUS: ONLINE | DATABASE: STANDALONE
        </div>

        <div id="output-area">
            [[INITIATING ACCESS. . .]]<br>
            [[WELCOME, OPERATOR. LEVEL DELTA CLEARANCE CONFIRMED.]]<br>
            <br>
            <span style="color: #ffff00;">**Click anywhere on the console to start the main music.**</span>
            <br>
            Type **HELP** for available commands.
            <br>
        </div>

        <div id="input-line">
            <span id="input-prefix">ATLAS ></span>
            <input type="text" id="command-input" autofocus>
            <input type="text" id="password-input" style="display: none;"> 
        </div>
        
    </div>

    <script>
        const outputArea = document.getElementById('output-area');
        const commandInput = document.getElementById('command-input');
        const passwordInput = document.getElementById('password-input'); 
        const statusBar = document.getElementById('status-bar');
        const overrideIndicator = document.getElementById('override-indicator');
        const bodyElement = document.body; // Reference to the body for decorations
        const consoleContainer = document.querySelector('.console-container');
        const mainMusic = document.getElementById('main-music'); // Reference to the audio element

        let isBusy = false; 
        let scanActive = false;
        let decryptState = 0; 
        let scanState = 0; // 0: Ready, 1: Password Input, 2: TRACE Challenge
        let huntState = 0; // 0: Ready, 1: Selection Phase
        let targetEmail = ''; 
        let scanInterval; 
        let securityTimeout; 
        
        let currentPasswordDisplay = '';
        let actualPasswordAttempt = '';
        let passwordTimeout;
        let musicStarted = false; // New flag for music

        // --- TRACE CHALLENGE DATA ---
        let traceCode = '';
        let traceTarget = '';
        let traceTimer;
        const TRACE_TIME_SECONDS = 3;

        // --- DECRYPT DATA ---
        const SECRET_EMAIL = 'secret@gmail.com';
        const SIMULATED_PASSWORD = 'p4ssw0rd!';
        const PASSWORD_DISABLED_EMAIL = 'nopass@corp.net';
        const DECRYPT_TIMER_SECONDS = 5.0; 
        const PASSWORD_LENGTH = SIMULATED_PASSWORD.length;
        
        // --- SCAN PASSWORD ---
        const SCAN_PASSWORD = 'SC4NN3R#';
        
        // --- OVERRIDE STATUS ---
        let overrideEnabled = false;

        // Security Questions 
        const SECURITY_QUESTIONS = {
            "What is EthanUnlocked's birth date?": "25 January 2013",
            "How many pets does EthanUnlocked have?": "3",
            "When did EthanUnlocked start brawl stars?": "2024",
            "How many games does EthanUnlocked play?": "Unknown",
            "What is EthanUnlocked's favourite food?": "Burger",
            "What is EthanUnlocked's favourite drink?": "Pepsi"
        };
        let currentSecurityQuestion = null;

        // --- HUNT EASTER EGG DATA ---
        const BROWSER_EASTER_EGGS = [
            {
                name: "The T-Rex Dinosaur Game",
                trigger: "Disconnect your Wi-Fi, open a new Chrome tab, and press the **Spacebar**. OR, simply type **chrome://dino** into the address bar to play it while online.",
                info: "An endless runner game built by Google's Chrome UX team. It appears when the browser detects you have **no internet connection**. The game was designed to last for about 17 million years, which is how long the T-Rex existed on Earth!",
                image: "https://www.google.com/search?tbm=isch&q=chrome+t+rex+game+pixel", 
                browser: "Chrome"
            },
            {
                name: "The Book of Mozilla",
                trigger: "In the address bar of a Firefox browser, type **about:mozilla** and hit Enter.",
                info: "One of the oldest browser secrets, dating back to Netscape. It displays a mysterious, quasi-religious verse from the fictional 'Book of Mozilla,' often referencing the battle between Mozilla and its competitors as if they were mythical beasts.",
                image: "https://www.google.com/search?tbm=isch&q=firefox+about:mozilla+easter+egg",
                browser: "Firefox"
            },
            {
                name: "The Surf Game",
                trigger: "Type **edge://surf** into the address bar of Microsoft Edge and hit Enter. It also appears when your internet is disconnected.",
                info: "A modern tribute to the classic Windows game **SkiFree**. You control a surfer, trying to avoid obstacles like a kraken and buoys. It includes multiple game modes like Endless, Time Trial, and Zigzag.",
                image: "https://www.google.com/search?tbm=isch&q=microsoft+edge+surf+game+kraken",
                browser: "Microsoft Edge"
            }
        ];

        // --- HOLIDAY THEMES (Australia-specific holidays included) ---
        const HOLIDAY_THEMES = {
            0: { name: "New Year's Eve", color: "#ffc107", music: "https://www.youtube.com/results?search_query=upbeat+new+years+music+no+vocals", emoji: "ðŸŽ‰", css: "new-years-theme" }, // January (Month 0)
            1: { name: "Valentine's Day", color: "#ff69b4", music: "https://www.youtube.com/results?search_query=romantic+lo+fi+music+no+vocals", emoji: "ðŸ’–", css: "valentines-theme" }, // February
            2: { name: "Labour Day (AU/NZ)", color: "#dc3545", music: "https://www.youtube.com/results?search_query=motivational+work+music+no+vocals", emoji: "ðŸ› ï¸", css: "labour-theme" }, // March
            3: { name: "Easter & ANZAC Day", color: "#007bff", music: "https://www.youtube.com/results?search_query=calm+easter+and+anzac+day+music", emoji: "ðŸ°", css: "april-theme" }, // April
            4: { name: "Mother's Day", color: "#6f42c1", music: "https://www.youtube.com/results?search_query=gentle+mother's+day+music", emoji: "ðŸŒ·", css: "mothers-theme" }, // May
            8: { name: "National Flag Day", color: "#000080", music: "https://www.youtube.com/results?search_query=australian+national+anthem+instrumental", emoji: "ðŸ‡¦ðŸ‡º", css: "flag-theme" }, // September (Month 8)
            9: { name: "Halloween", color: "#ff8c00", music: "https://www.youtube.com/results?search_query=spooky+halloween+lo+fi+no+vocals", emoji: "ðŸŽƒ", css: "halloween-theme" }, // October (Current Month)
            10: { name: "Thanksgiving (US/Global)", color: "#8b4513", music: "https://www.youtube.com/results?search_query=cozy+thanksgiving+lo+fi", emoji: "ðŸ¦ƒ", css: "thanksgiving-theme" }, // November
            11: { name: "Christmas", color: "#006400", music: "https://www.youtube.com/results?search_query=instrumental+christmas+carols+lo+fi", emoji: "ðŸŽ„", css: "christmas-theme" } // December
        };
        
        /** Utility functions */
        function writeOutput(text, color = '#00ff41') {
            const line = document.createElement('span');
            line.style.color = color;
            line.textContent = text;
            outputArea.appendChild(line);
            outputArea.appendChild(document.createElement('br'));
            outputArea.scrollTop = outputArea.scrollHeight;
        }

        function showPrompt() {
            if (!isBusy) {
                writeOutput("", '#00ff41');
            }
            
            // If in a special state, redirect input focus
            if (scanState === 1 || scanState === 2) {
                commandInput.style.display = 'none';
                passwordInput.style.display = 'block';
                passwordInput.focus();
                // If in password mode, set type to password
                if (scanState === 1) {
                    passwordInput.type = 'password';
                    passwordInput.value = currentPasswordDisplay;
                } else {
                    // If in TRACE mode, clear input and set to text type
                    passwordInput.type = 'text';
                    passwordInput.value = '';
                }
            } else {
                commandInput.style.display = 'block';
                passwordInput.style.display = 'none';
                commandInput.focus();
                commandInput.value = '';
            }
        }


        // --- COMMAND HANDLERS (Omitted for brevity, they are the same as before) ---

        async function runSearch(query) {
            isBusy = true;
            writeOutput(`INITIATING PUBLIC WEB SCAN FOR: "${query}"...`, '#ffff00');
            await new Promise(resolve => setTimeout(resolve, 1500));
            const normalizedQuery = query.toLowerCase();
            
            writeOutput(">> DATA RETRIEVAL SUCCESSFUL:", '#00ffff');
            
            if (normalizedQuery.includes("eiffel") || normalizedQuery.includes("paris")) {
                writeOutput("[Source 1] Title: Eiffel Tower - Official Site", '#fff');
                writeOutput("[Source 2] Status: HIGH TOURIST ALERT, heavy crowd movement.", '#ffff00');
            } else if (normalizedQuery.includes("ethan") || normalizedQuery.includes("ioannou")) {
                writeOutput(">> TARGET: ETHAN IOANNOU. DATA RETRIEVAL BLOCKED BY LEVEL DELTA OVERRIDE.", '#ff0000');
            } else if (normalizedQuery.includes("nasa") || normalizedQuery.includes("space")) {
                 writeOutput("[Source 1] Title: NASA Official Portal - Mars Missions Log", '#fff');
                 writeOutput("[Source 2] Geo-Loc: Kennedy Space Center, FL. Status: Routine Operations.", '#fff');
            } else if (normalizedQuery.includes("crypto") || normalizedQuery.includes("bitcoin")) {
                 writeOutput("[Source 1] Title: Global Market Index 2024 - Crypto Analysis", '#fff');
                 writeOutput("[Source 2] Risk Factor: EXTREME VOLATILITY. Recommendation: HOLD.", '#ff0000');
            } else {
                 writeOutput(">> NO SIGNIFICANT PUBLIC DATA FOUND. QUERY TOO VAGUE.", '#ff0000');
            }

            isBusy = false;
            showPrompt();
        }
        
        function runTrace(target) {
            if (!overrideEnabled) {
                writeOutput("ERROR: TRACE command requires LEVEL ALPHA OVERRIDE. Type HELP for official commands.", '#ff0000');
                return;
            }

            if (scanState === 2) {
                writeOutput("WARNING: TRACE already active. Complete current challenge or wait for timeout.", '#ffff00');
                return;
            }

            traceTarget = target.toUpperCase();
            if (traceTarget !== 'ETHAN' && traceTarget !== 'IOANNOU') {
                writeOutput(`WARNING: Target '${target}' not in priority list. Defaulting to high-value trace.`, '#ffff00');
                traceTarget = "HIGH-VALUE TARGET";
            }

            traceCode = Math.random().toString(36).substring(2, 8).toUpperCase(); 
            scanState = 2; 
            
            writeOutput(`\n!! INITIATING REAL-TIME TRACE ON ${traceTarget} !!`, '#ff0000');
            writeOutput("!! AUTHENTICATION REQUIRED: Type the code below IMMEDIATELY to avoid detection.", '#ffff00');

            const challengePanel = document.createElement('div');
            challengePanel.id = 'trace-challenge-container';
            challengePanel.innerHTML = `
                <div id="trace-timer">TIME REMAINING: ${TRACE_TIME_SECONDS}.0s</div>
                <div id="trace-code">${traceCode}</div>
            `;
            outputArea.appendChild(challengePanel);
            outputArea.scrollTop = outputArea.scrollHeight;

            showPrompt();
            startTraceTimer(challengePanel);
        }
        
        function startTraceTimer(panel) {
            let timeLeft = TRACE_TIME_SECONDS;
            const timerElement = document.getElementById('trace-timer');
            
            traceTimer = setInterval(() => {
                timeLeft -= 0.1;
                timerElement.textContent = `TIME REMAINING: ${timeLeft.toFixed(1)}s`;
                
                if (timeLeft <= 1.0) {
                    panel.style.borderColor = '#ff00ff';
                    timerElement.style.color = '#ff00ff';
                }

                if (timeLeft <= 0) {
                    clearInterval(traceTimer);
                    outputArea.removeChild(panel);
                    writeOutput("\n!! TRACE TIMEOUT !!", '#ff0000');
                    writeOutput("SYSTEM WARNING: Trace attempt detected. Alpha Override terminated.", '#ff0000');
                    runOverride(true); 
                    scanState = 0; 
                    showPrompt();
                }
            }, 100);
        }

        function handleTraceInput(input) {
            if (input.toUpperCase() === traceCode) {
                clearInterval(traceTimer);
                const panel = document.getElementById('trace-challenge-container');
                if (panel) outputArea.removeChild(panel);
                
                writeOutput(`\n>> TRACE SUCCESSFUL: Code ${traceCode} verified. Trace window held.`, '#00ff41');
                
                const coords = `${Math.floor(Math.random() * 90) + 1}.` + Math.random().toFixed(4).substring(2) + ' N, ' + 
                                `${Math.floor(Math.random() * 180) + 1}.` + Math.random().toFixed(4).substring(2) + ' E';
                const activity = ["Watching YT", "Playing games", "Sleeping", "Eating snacks", "School work (High Priority)"];
                const uniqueLocation = ["Terrigal, NSW (Primary Residence)", "Local Library WIFI", "Shopping Centre Food Court", "Central Coast School Network"];

                writeOutput(`\n--- HIGH-PRIORITY GEO-LOC REPORT ---`, '#00ffff');
                writeOutput(`TARGET: ${traceTarget}`, '#fff');
                writeOutput(`COORDS: ${coords}`, '#fff');
                writeOutput(`LOCATION: ${uniqueLocation[Math.floor(Math.random() * uniqueLocation.length)]}`, '#fff');
                writeOutput(`ACTIVITY: ${activity[Math.floor(Math.random() * activity.length)]}`, '#fff');
                
                scanState = 0; 
                showPrompt();
            }
        }

        function runHunt(selection) {
            if (huntState === 0) {
                isBusy = true;
                writeOutput("\n--- INITIATING HIGH-LEVEL BEHAVIORAL SCAN ---", '#00ffff');
                writeOutput("!! System is analyzing local browser configuration for known *Universal Easter Eggs*...", '#ffff00');

                setTimeout(() => {
                    writeOutput("\n>> SCAN COMPLETE. 3 Easter Eggs detected in modern browser data sets:", '#00ff41');
                    
                    BROWSER_EASTER_EGGS.forEach((egg, index) => {
                        writeOutput(`  [${index + 1}] ${egg.name} (${egg.browser})`, '#fff');
                    });

                    writeOutput("\nType the **NUMBER** of the Easter Egg you want to know more about, or **LOGOUT** to exit HUNT mode.", '#ffff00');
                    huntState = 1;
                    isBusy = false;
                    showPrompt();
                }, 1500);
                
            } 
            else if (huntState === 1) {
                const index = parseInt(selection) - 1;

                if (isNaN(index) || index < 0 || index >= BROWSER_EASTER_EGGS.length) {
                    writeOutput("ERROR: Invalid selection. Please type a number from 1 to 3, or LOGOUT.", '#ff0000');
                    return;
                }

                const egg = BROWSER_EASTER_EGGS[index];
                writeOutput(`\n--- EASTER EGG REPORT: ${egg.name.toUpperCase()} ---`, '#00ffff');
                writeOutput(`BROWSER: ${egg.browser}`, '#fff');
                writeOutput(`DESCRIPTION: ${egg.info}`, '#fff');
                writeOutput(`\nTO FIND IT: ${egg.trigger}`, '#00ff41');
                writeOutput(`\nVISUAL CONFIRMATION: Opening image search...`, '#ffff00');
                
                window.open(egg.image, '_blank');

                writeOutput(`\nType another NUMBER (1-3) to search another Easter Egg, or **LOGOUT** to return to the main console.`, '#ffff00');
            }
        }

        async function runDecrypt(input) {
            const cmd = input.trim().split(/\s+/)[0].toUpperCase();

            if (decryptState === 0) {
                writeOutput("ENCRYPTION MODULE ONLINE. Verifying Operator Clearance...", '#ffff00');
                
                if (overrideEnabled) {
                    writeOutput("!! OVERRIDE ACTIVE: Security question bypass approved. Initiating direct input.", '#ff0000');
                    writeOutput("\nEnter Target Email (e.g., secret@gmail.com or nopass@corp.net):", '#ffff00');
                    decryptState = 1;
                    showPrompt();
                } else {
                    writeOutput("Verifying Operator Clearance via Personal Query...", '#ffff00');
                    startSecurityQuestion();
                }
                
            } else if (decryptState === 1.5) {
                handleSecurityAnswer(input.trim());
                
            } else if (decryptState === 1) {
                isBusy = true; 
                const emailGuess = input.toLowerCase().trim();

                writeOutput(`Verifying email existence for ${emailGuess}...`, '#ffff00');
                await new Promise(resolve => setTimeout(resolve, 1500)); 

                if (emailGuess === SECRET_EMAIL || emailGuess === PASSWORD_DISABLED_EMAIL) {
                    targetEmail = emailGuess; 
                    writeOutput(`>> VERIFICATION SUCCESSFUL. Target exists in high-priority register.`, '#00ff41');
                    writeOutput(`Initiating Level-4 Decryption...`, '#00ffff');
                    decryptState = 2; 
                    animateDecryption();
                } else {
                    writeOutput(`>> VERIFICATION FAILED: Target email ${emailGuess} not found in global DNS/registers.`, '#ff0000');
                    writeOutput(`Try correcting your spelling and punctuation.`, '#ff0000');
                    decryptState = 0; 
                    isBusy = false;
                    showPrompt();
                }
            } else if (decryptState === 3) {
                const parts = input.trim().split(/\s+/);
                const args = input.trim().substring(cmd.length).trim();
                
                if (cmd === 'DECRYPT' && args.toUpperCase() === 'PASSWORD') {
                    handleDecryptPassword();
                } else if (cmd === 'COMPARE' && args) {
                    handleComparePassword(args);
                } else {
                    writeOutput("ERROR: Invalid option. Use DECRYPT PASSWORD or COMPARE [password].", '#ff0000');
                }
                showPrompt();
            }
        }

        function startSecurityQuestion() {
            const questions = Object.keys(SECURITY_QUESTIONS);
            const randomIndex = Math.floor(Math.random() * questions.length);
            currentSecurityQuestion = questions[randomIndex];

            writeOutput(`\nSECURITY CHALLENGE INITIATED. (10s to answer)`, '#ff00ff');
            writeOutput(`QUERY: ${currentSecurityQuestion}`, '#ffff00');
            
            decryptState = 1.5;
            isBusy = false;
            showPrompt();

            securityTimeout = setTimeout(() => {
                if (decryptState === 1.5) {
                    handleSecurityAnswer(''); 
                }
            }, 10000);
        }

        function handleSecurityAnswer(answer) { 
            clearTimeout(securityTimeout); 

            if (decryptState !== 1.5) return;
            
            if (answer.trim() === '') {
                writeOutput("!! TIMEOUT: Security challenge failed.", '#ff0000');
                writeOutput("ACCESS DENIED. Resuming standard terminal operations.", '#ff0000');
                decryptState = 0;
                showPrompt();
                return;
            }

            const expectedAnswer = SECURITY_QUESTIONS[currentSecurityQuestion];
            const normalizedAnswer = answer.toLowerCase().replace(/[^a-z0-9]/g, '');
            const normalizedExpected = expectedAnswer.toLowerCase().replace(/[^a-z0-9]/g, '');

            if (normalizedAnswer === normalizedExpected) {
                writeOutput("ACCESS GRANTED. Personal Query Verified.", '#00ff41');
                writeOutput("\nEnter Target Email (e.g., secret@gmail.com or nopass@corp.net):", '#ffff00');
                decryptState = 1; 
            } else {
                writeOutput(`!! SECURITY BREACH: Answer '${answer}' is incorrect.`, '#ff0000');
                writeOutput("ACCESS DENIED. Resuming standard terminal operations.", '#ff0000');
                decryptState = 0; 
            }
            showPrompt();
        }


        function animateDecryption() { 
            const passwordContainer = document.createElement('span');
            passwordContainer.id = 'decrypted-pass';
            writeOutput("PASSWORD HASH: ", '#fff');
            outputArea.appendChild(passwordContainer);
            outputArea.appendChild(document.createElement('br'));
            outputArea.scrollTop = outputArea.scrollHeight;
            
            let decryptedPassword = '';
            let index = 0;
            let timeRemaining = DECRYPT_TIMER_SECONDS;
            
            const timerElement = document.createElement('div');
            timerElement.style.color = '#ffff00';
            timerElement.textContent = `TIME: ${timeRemaining.toFixed(1)}s`;
            outputArea.appendChild(timerElement);

            const timerInterval = setInterval(() => {
                timeRemaining -= 0.1;
                timerElement.textContent = `TIME: ${timeRemaining.toFixed(1)}s`;
                
                if (timeRemaining <= 0 || index >= PASSWORD_LENGTH) {
                    clearInterval(timerInterval);
                    outputArea.removeChild(timerElement);
                    writeOutput("DECRYPTION PROCESS COMPLETE.", '#ffff00');
                    
                    decryptState = 3; 
                    isBusy = false;
                    
                    writeOutput(`\nTARGET: ${targetEmail} ACQUIRED. Select Action:`, '#00ffff');
                    writeOutput("  > DECRYPT PASSWORD - Retrieve the full password.", '#00ff41');
                    writeOutput("  > COMPARE [password] - Analyze a potential password's strength.", '#00ff41');
                    writeOutput("  > LOGOUT - Terminate session.", '#ff0000');
                    
                    showPrompt();
                    return;
                }

                const randomChars = Array.from({length: 5}, () => Math.random().toString(36)[2]).join('');
                const currentChar = SIMULATED_PASSWORD[index];
                
                passwordContainer.innerHTML = `<span style='color:#00ff41;'>${decryptedPassword}</span>` + 
                                              `<span style='color:#ff00ff;'>${randomChars.substring(0, 1)}</span>`;
                
                setTimeout(() => {
                    if (index < PASSWORD_LENGTH) {
                        decryptedPassword += currentChar;
                        passwordContainer.innerHTML = `<span style='color:#00ff41;'>${decryptedPassword}</span>`;
                        index++;
                    }
                }, 100); 

            }, 500);
        }

        function handleDecryptPassword() { 
             if (targetEmail === PASSWORD_DISABLED_EMAIL) {
                writeOutput("!! AUTHENTICATION POLICY: PASSWORD DISABLED (Key Fob/Biometric Only)", '#ff0000');
            } else {
                writeOutput(`DECRYPT SUCCESS. PASSWORD FOR ${targetEmail}:`, '#ffff00');
                writeOutput(`  >> ${SIMULATED_PASSWORD}`, '#00ff41');
            }
        }

        function handleComparePassword(inputPassword) { 
            const correctPassword = SIMULATED_PASSWORD;
            let accuracy = 0;
            let suggestion = "Password strength is HIGH.";
            
            for (let i = 0; i < Math.min(inputPassword.length, correctPassword.length); i++) {
                if (inputPassword[i] === correctPassword[i]) {
                    accuracy += 100 / correctPassword.length;
                }
            }
            accuracy = Math.round(accuracy);
            
            if (accuracy < 30) {
                suggestion = "SUGGESTION: Needs major changes. Ensure it uses numbers, symbols, and a different length.";
            } else if (accuracy < 60) {
                suggestion = `SUGGESTION: Length is close, but needs better complexity. Try changing the middle ${Math.round(correctPassword.length / 3)} characters.`;
            } else if (accuracy < 99) {
                suggestion = "SUGGESTION: Extremely close. Check casing and special characters at the end.";
            } else if (accuracy >= 100) {
                accuracy = 100;
                suggestion = "MATCH: The password is correct.";
            }

            writeOutput(`\n-- PASSWORD COMPARISON REPORT --`, '#00ffff');
            writeOutput(`INPUT: ${inputPassword}`, '#fff');
            writeOutput(`ACCURACY RATING: ${accuracy}%`, accuracy >= 90 ? '#00ff41' : '#ffff00');
            writeOutput(`ADVICE: ${suggestion}`, '#00ff41');
        }


        function handleScanPassword(password) { 
            writeOutput(`> ${currentPasswordDisplay}`, '#ff00ff'); 
            
            if (password === SCAN_PASSWORD) {
                writeOutput("SCAN MODULE: ACCESS GRANTED. Initializing Polygraph...", '#00ff41');
                scanState = 0; 
                runScan(true); 
            } else {
                writeOutput("ERROR: Invalid SCAN password. Access denied.", '#ff0000');
                scanState = 0; 
            }
            actualPasswordAttempt = '';
            currentPasswordDisplay = '';
            showPrompt();
        }

        function startScanPasswordInput() { 
            writeOutput("SCAN MODULE: Authentication required.", '#ffff00');
            writeOutput("PASSWORD:", '#ffff00');
            scanState = 1;
            showPrompt();
        }
        
        function runScan(passwordSuccess = false) { 
            
            if (overrideEnabled) {
                 writeOutput("!! OVERRIDE ACTIVE: Scan password bypass approved. Initializing Polygraph...", '#ff0000');
                 passwordSuccess = true;
            }
            
            if (!passwordSuccess && scanState === 0) {
                startScanPasswordInput();
                return;
            }

            if (!scanActive) {
                writeOutput("ATLAS POLYGRAPH INITIATED. Requires Camera/Mic access for bio-feedback scan.", '#ffff00');
                
                const panel = document.createElement('div');
                panel.id = 'lie-detector-panel';
                panel.innerHTML = `
                    <video id="video-feed" autoplay playsinline muted></video>
                    <div class="scan-data">
                        <span class="data-label">Heart Rate:</span> <span id="hr-data" class="data-value">-- bpm</span><br>
                        <span class="data-label">Skin Conductivity:</span> <span id="sc-data" class="data-value">-- Î¼S</span><br>
                        <div id="lie-status">ANALYZING...</div>
                    </div>
                `;
                outputArea.appendChild(panel);
                outputArea.scrollTop = outputArea.scrollHeight;
                
                navigator.mediaDevices.getUserMedia({ video: true, audio: false })
                    .then(stream => {
                        const videoFeed = document.getElementById('video-feed');
                        videoFeed.srcObject = stream;
                    })
                    .catch(err => {
                        writeOutput("WARNING: Camera access denied. Bio-feedback will use simulated data only.", '#ffff00');
                    });
                
                let heartRate = 70;
                let conductivity = 1.0;
                const hrData = document.getElementById('hr-data');
                const scData = document.getElementById('sc-data');
                const lieStatus = document.getElementById('lie-status');
                
                scanInterval = setInterval(() => {
                    heartRate = Math.round(70 + (Math.random() * 10) * (Math.random() > 0.5 ? 1 : -1));
                    conductivity = (1.0 + (Math.random() * 0.2) * (Math.random() > 0.5 ? 1 : -1)).toFixed(2);
                    
                    hrData.textContent = `${heartRate} bpm`;
                    scData.textContent = `${conductivity} Î¼S`;
                    
                    let stressLevel = (heartRate - 65) + (conductivity - 1.0) * 100;
                    
                    if (stressLevel > 10) {
                        lieStatus.textContent = "STRESS DETECTED! (High) ðŸ”´";
                        lieStatus.style.color = '#ff0000';
                    } else if (stressLevel > 5) {
                        lieStatus.textContent = "ELEVATED CONDUCTIVITY (Medium) ðŸŸ ";
                        lieStatus.style.color = '#ffa500';
                    } else {
                        lieStatus.textContent = "BASELINE CONFIRMED (Low) ðŸŸ¢";
                        lieStatus.style.color = '#00ff41';
                    }
                    
                }, 500); 

                scanActive = true;
                writeOutput("POLYGRAPH ACTIVE. Type 'STOP SCAN' to terminate.", '#00ff41');

            } else {
                writeOutput("POLYGRAPH ALREADY ACTIVE. Type 'STOP SCAN' to terminate.", '#ff0000');
            }
            showPrompt();
        }

        function endLieDetection() { 
            clearInterval(scanInterval); 
            scanActive = false;
            
            const videoFeed = document.getElementById('video-feed');
            if (videoFeed && videoFeed.srcObject) {
                videoFeed.srcObject.getTracks().forEach(track => track.stop());
            }

            const panel = document.getElementById('lie-detector-panel');
            if (panel) {
                outputArea.removeChild(panel);
            }

            writeOutput(`SCAN TERMINATED.`, '#ffff00');
            showPrompt();
        }
        
        function runOverride(forcedDeactivation = false) {
            if (overrideEnabled || forcedDeactivation) {
                overrideEnabled = false;
                statusBar.classList.remove('override-active');
                overrideIndicator.style.display = 'none';

                writeOutput("!! OVERRIDE DEACTIVATED: Returning to Level Delta Clearance.", '#00ff41');
                writeOutput("!! STATUS: Security checks are now MANDATORY. TRACE command is disabled.", '#00ff41');
                scanState = 0; 
                
                if (forcedDeactivation) {
                    passwordInput.value = '';
                    commandInput.value = '';
                }

            } else {
                overrideEnabled = true;
                statusBar.classList.add('override-active');
                overrideIndicator.style.display = 'inline';

                writeOutput("!! EMERGENCY PROTOCOL: LEVEL ALPHA OVERRIDE INITIATED.", '#ff0000');
                writeOutput("!! SECURITY WARNING: ALL USER LOGGING IS TEMPORARILY SUSPENDED.", '#ff0000');
                writeOutput("!! STATUS: OPERATIONAL MODE SET TO 'UNTRACED'.", '#ff0000');
                writeOutput("!! UTILITY GRANTED: You can now use the high-risk command 'TRACE [Target Name]'.", '#ffff00');
            }
        }


        // --- MAIN COMMAND PROCESSOR (Omitted for brevity, it is the same as before) ---
        
        function processCommand(command) {
            const parts = command.trim().split(/\s+/);
            const cmd = parts[0].toUpperCase();
            const args = command.trim().substring(cmd.length).trim();

            if (isBusy && cmd !== 'LOGOUT' && cmd !== 'OVERRIDE' && cmd !== 'TRACE') {
                writeOutput("!! System Busy. Please wait for current sequence to finish.", '#ff0000');
                return;
            }
            
            if (cmd === 'STOP' && args.toUpperCase() === 'SCAN' && scanActive) {
                writeOutput(`> ${command}`, '#ff00ff');
                endLieDetection(); 
                return;
            }
            
            if (cmd === 'LOGOUT') {
                writeOutput(`> ${command}`, '#ff00ff');
                if (huntState === 1) {
                    writeOutput("HUNT MODE TERMINATED. Returning to main console.", '#00ff41');
                    huntState = 0;
                    isBusy = false;
                    showPrompt();
                    return;
                }
                
                writeOutput("SESSION TERMINATED. Redirecting to source...", '#ff0000');
                if (scanActive) endLieDetection();
                setTimeout(() => {
                    window.location.href = 'https://ethanunlocked690.github.io'; 
                }, 1000);
                return;
            }
            
            if (cmd === 'TRACE') {
                 writeOutput(`> ${command}`, '#ff00ff');
                 runTrace(args);
                 return;
            }

            if (huntState === 1 && !isNaN(parseInt(command.trim()))) {
                writeOutput(`> ${command}`, '#ff00ff');
                runHunt(command.trim());
                return;
            }
            
            if (decryptState === 1.5) {
                handleSecurityAnswer(command);
                commandInput.value = '';
                return;
            }
            
            if (decryptState === 3) {
                if (cmd === 'DECRYPT' || cmd === 'COMPARE') {
                    writeOutput(`> ${command}`, '#ff00ff');
                    runDecrypt(command);
                    return;
                }
                writeOutput("ERROR: Invalid command in DECRYPT menu. Use DECRYPT PASSWORD or COMPARE [password].", '#ff0000');
                showPrompt();
                return;
            }

            if (decryptState === 1 && command.trim().includes('@')) {
                 writeOutput(`> ${command}`, '#ff00ff');
                 runDecrypt(command);
                 commandInput.value = '';
                 return;
            }

            writeOutput(`> ${command}`, '#ff00ff'); 
            
            switch (cmd) {
                case 'HELP':
                    writeOutput("--- AVAILABLE COMMANDS (6 Core Features) ---", '#ffff00');
                    writeOutput("1. SEARCH [query] : Fetch public data (e.g., NASA, Eiffel).", '#00ff41');
                    writeOutput("2. DECRYPT        : Start email password extraction module (Requires Security Check).", '#00ff41');
                    writeOutput("3. SCAN           : Start bio-feedback analysis (Requires Password).", '#00ff41');
                    writeOutput("4. HUNT           : Scan your current browser for embedded Easter Eggs. ðŸ‡", '#00ff41');
                    writeOutput("5. LOGOUT         : Terminate session.", '#00ff41');
                    writeOutput("6. [HIDDEN]       : A powerful, unlisted command for system control.", '#ff00ff');
                    break;
                case 'SEARCH':
                    if (args.length > 2) {
                        runSearch(args);
                        return;
                    } else {
                        writeOutput("ERROR: SEARCH requires a query (e.g., SEARCH Eiffel Tower).", '#ff0000');
                    }
                    break;
                case 'DECRYPT':
                    if (decryptState !== 1) decryptState = 0; 
                    runDecrypt(args);
                    break;
                case 'SCAN':
                    scanState = 0; 
                    runScan();
                    break;
                case 'OVERRIDE':
                    runOverride();
                    break;
                case 'HUNT':
                    huntState = 0; 
                    runHunt(args);
                    break;
                default:
                    writeOutput(`ERROR: Command '${cmd}' not recognized. Try HELP.`, '#ff0000');
                    break;
            }
            showPrompt();
        }

        // --- HOLIDAY INITIALIZER ---
        function initializeHolidayTheme() {
            const today = new Date();
            const month = today.getMonth(); // 0 (Jan) to 11 (Dec)
            const day = today.getDate(); // Day of the month

            let currentTheme = HOLIDAY_THEMES[month];

            // Specific day checks (Australian holidays and US Thanksgiving)
            if (month === 2 && day > 7 && day < 15) { 
                currentTheme = HOLIDAY_THEMES[2]; 
            } else if (month === 3 && day === 25) { 
                currentTheme = { name: "ANZAC Day", color: "#6c757d", music: "https://www.youtube.com/results?search_query=the+last+post+instrumental", emoji: "ðŸŒ¹", css: "anzac-theme" };
            } else if (month === 4 && day > 7 && day < 15) { 
                 currentTheme = HOLIDAY_THEMES[4];
            } else if (month === 8 && day === 3) { 
                 currentTheme = HOLIDAY_THEMES[8];
            }
            
            if (currentTheme) {
                 const message = `\n${currentTheme.emoji} [SEASONAL UPDATE] ${currentTheme.name} Theme Active ${currentTheme.emoji}`;
                 writeOutput(message, currentTheme.color);
                 writeOutput(`STATUS: Console environment optimized for festive operation.`, currentTheme.color);
                 writeOutput(`MUSIC: Play this ${currentTheme.name} background music: (Open in new tab)`, '#ffff00');
                 
                 const musicLink = document.createElement('a');
                 musicLink.href = currentTheme.music;
                 musicLink.target = '_blank';
                 musicLink.textContent = currentTheme.music;
                 musicLink.style.color = currentTheme.color;
                 musicLink.style.textDecoration = 'underline';
                 outputArea.appendChild(document.createElement('span')).textContent = '  >> ';
                 outputArea.appendChild(musicLink);
                 outputArea.appendChild(document.createElement('br'));
                 
                 bodyElement.classList.add(currentTheme.css); 
            }
        }
        
        // --- Music Starter Function ---
        function startMusic() {
            if (!musicStarted) {
                mainMusic.play().catch(error => {
                    // This error is expected if the user hasn't interacted with the page yet.
                    console.log("Music play blocked, waiting for user interaction...");
                });
                musicStarted = true;
            }
            // Remove the event listener once music attempts to start
            document.removeEventListener('click', startMusic);
        }

        // --- Event Listeners ---

        document.addEventListener('keypress', function(e) {
            
            if (scanState === 2) {
                if (e.key === 'Enter') {
                    e.preventDefault(); 
                    handleTraceInput(passwordInput.value);
                    passwordInput.value = '';
                }
                return;
            }

            if (e.key === 'Enter' && commandInput.style.display !== 'none') {
                processCommand(commandInput.value);
                commandInput.value = '';
            }
        });
        
        document.addEventListener('click', startMusic); // Listen for the first click to start audio

        passwordInput.addEventListener('keydown', function(e) {
            clearTimeout(passwordTimeout);
            
            if (scanState === 2) {
                return;
            }

            if (e.key === 'Enter') {
                e.preventDefault(); 
                handleScanPassword(actualPasswordAttempt);
                return;
            }
            
            if (e.key === 'Backspace' || e.key === 'Delete') {
                actualPasswordAttempt = actualPasswordAttempt.slice(0, -1);
                currentPasswordDisplay = currentPasswordDisplay.slice(0, -1);
                passwordInput.value = currentPasswordDisplay;
                e.preventDefault(); 
                return;
            }

            if (e.key.length === 1 && !e.ctrlKey && !e.altKey && !e.metaKey) {
                e.preventDefault(); 
                
                const char = e.key;
                actualPasswordAttempt += char;
                
                currentPasswordDisplay += char;
                passwordInput.value = currentPasswordDisplay;

                passwordTimeout = setTimeout(() => {
                    if (currentPasswordDisplay.length > 0) {
                        if (currentPasswordDisplay.slice(-1) !== '*') {
                            currentPasswordDisplay = currentPasswordDisplay.slice(0, -1) + '*';
                            passwordInput.value = currentPasswordDisplay;
                        }
                    }
                }, 2000); 
            }
        });


        // Initialize on load
        window.onload = function() {
            initializeHolidayTheme(); 
            commandInput.focus();
        };
    </script>
</body>
</html>
