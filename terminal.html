<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TITAN_OS // OMEGA_BUILD_V11 - Command Center</title>
    <style>
        :root {
            --primary: #00ff41;
            --primary-dim: rgba(0, 255, 65, 0.15);
            --bg: #020202;
            --error: #ff3131;
            --warn: #ffcc00;
            --info: #00d4ff;
            --font: 'Consolas', 'Courier New', monospace;
        }

        body, html {
            margin: 0; padding: 0;
            background: #000;
            color: var(--primary);
            font-family: var(--font);
            height: 100vh; width: 100vw;
            overflow: hidden;
        }

        /* --- CRT GLASS EFFECT --- */
        #container {
            position: relative;
            width: 100%; height: 100%;
            background: var(--bg);
            display: flex; flex-direction: column;
            overflow: hidden;
        }

        #container::after {
            content: " ";
            position: absolute; top: 0; left: 0; bottom: 0; right: 0;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.3) 50%), 
                        linear-gradient(90deg, rgba(255, 0, 0, 0.05), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.05));
            background-size: 100% 2px, 3px 100%;
            z-index: 100; pointer-events: none;
        }

        /* Scanline Animation */
        .scanline {
            width: 100%; height: 100px;
            background: linear-gradient(0deg, transparent 0%, rgba(0, 255, 65, 0.05) 50%, transparent 100%);
            position: absolute; top: -100px; z-index: 101;
            animation: moveScanline 8s linear infinite;
        }

        @keyframes moveScanline {
            0% { top: -100px; }
            100% { top: 100%; }
        }

        /* --- UI ELEMENTS --- */
        #header {
            padding: 10px 20px;
            background: rgba(0, 255, 65, 0.05);
            border-bottom: 1px solid var(--primary-dim);
            display: flex; justify-content: space-between;
            font-size: 0.85rem; letter-spacing: 2px;
            z-index: 10;
        }

        #terminal {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            position: relative;
            z-index: 5;
            scrollbar-width: thin;
            scrollbar-color: var(--primary-dim) transparent;
        }
        #terminal::-webkit-scrollbar { width: 6px; }
        #terminal::-webkit-scrollbar-thumb { background: var(--primary-dim); }

        .line { margin-bottom: 6px; line-height: 1.4; white-space: pre-wrap; }
        .prompt-symbol { color: #fff; font-weight: bold; margin-right: 10px; }
        .success { color: var(--primary); }
        .error { color: var(--error); text-shadow: 0 0 5px var(--error); }
        .info { color: var(--info); }
        .warning { color: var(--warn); }
        .blink { animation: blink 1s steps(2, start) infinite; }

        @keyframes blink { to { visibility: hidden; } }

        .input-area {
            display: flex;
            padding: 15px 20px;
            background: #050505;
            border-top: 1px solid var(--primary-dim);
            z-index: 10;
        }

        #cli-input {
            background: transparent; border: none; outline: none;
            color: var(--primary); font-family: var(--font);
            font-size: 1.1rem; width: 100%;
        }

        #matrix-bg {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            opacity: 0.05; z-index: 1; pointer-events: none;
        }

        /* GLITCH STATE */
        .glitch { animation: glitchSkew 0.2s infinite; filter: hue-rotate(90deg); }
        @keyframes glitchSkew {
            0% { transform: skew(0deg); }
            20% { transform: skew(5deg); }
            40% { transform: skew(-5deg); }
            60% { transform: skew(2deg); }
            100% { transform: skew(0deg); }
        }
    </style>
</head>
<body class="theme-matrix">

<div id="container">
    <canvas id="matrix-bg"></canvas>
    <div class="scanline"></div>

    <header id="header">
        <div>CORE: TITAN_NODE_V11</div>
        <div id="status-tag">STATUS: [READY]</div>
        <div id="clock">00:00:00</div>
    </header>

    <div id="terminal">
        <div class="line info">TITAN MULTI-USER KERNEL LOADED...</div>
        <div class="line">Current User: <span class="success">root</span></div>
        <div class="line">Type <span class="warning">'HELP'</span> for a breakdown of commands.</div>
        <div class="line">Type <span class="error">'STOP'</span> to abort any running process.</div>
        <br>
    </div>

    <div class="input-area">
        <span class="prompt-symbol">root@titan:~#</span>
        <input type="text" id="cli-input" autofocus autocomplete="off" spellcheck="false">
    </div>
</div>

<script>
/** * GLOBALS & STATE 
 */
let ACTIVE_PROCESS = false;
let STOP_SIGNAL = false;
const term = document.getElementById('terminal');
const input = document.getElementById('cli-input');
const statusTag = document.getElementById('status-tag');
const container = document.getElementById('container');

/**
 * MATRIX BACKGROUND
 */
const canvas = document.getElementById('matrix-bg');
const ctx = canvas.getContext('2d');
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;
const alphabet = "ｦｱｳｴｵｶｷｸｹｺｻｼｽｾｿﾀﾁﾂﾃﾄ0123456789";
const fontSize = 16;
const columns = canvas.width / fontSize;
const rainDrops = Array.from({ length: columns }).fill(1);

function drawMatrix() {
    ctx.fillStyle = "rgba(0, 0, 0, 0.05)";
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    ctx.fillStyle = "#0F0";
    ctx.font = fontSize + "px monospace";
    for (let i = 0; i < rainDrops.length; i++) {
        const text = alphabet.charAt(Math.floor(Math.random() * alphabet.length));
        ctx.fillText(text, i * fontSize, rainDrops[i] * fontSize);
        if (rainDrops[i] * fontSize > canvas.height && Math.random() > 0.975) rainDrops[i] = 0;
        rainDrops[i]++;
    }
}
setInterval(drawMatrix, 30);

/**
 * COMMAND LOGIC
 */
const sleep = (ms) => new Promise(res => setTimeout(res, ms));

async function processCommand(raw) {
    const args = raw.toLowerCase().split(' ');
    const cmd = args[0];

    // Special case for 'stop' - though it's handled in the event listener too
    if (cmd === 'stop') return;

    ACTIVE_PROCESS = true;
    statusTag.innerText = `STATUS: [RUNNING - ${cmd.toUpperCase()}]`;

    switch(cmd) {
        case 'help':
            return `MASTER COMMAND LIST:
--------------------------------------------------
HELP        : Show this list
STOP        : Kills any active command / Abort loops
CLEAR       : Wipe screen buffer
GLITCH      : Toggle visual signal noise
MAP         : Initialize geo-tracking
DOWNLOAD    : Simulate remote file extraction
PING [host] : Test network connectivity
BRUTE       : Execute password cracking logic
CRYPTO      : Live Bitcoin/Ethereum/Solana prices
WHOAMI      : Display user credentials
LOGS        : Read system security logs
IP          : Reveal local node address`;

        case 'whoami':
            return `USER: root\nUID: 0\nGID: 0\nSHELL: /bin/titan_sh\nACCESS: GLOBAL_ADMIN`;

        case 'ip':
            printLine("Pinging local gateway...", "info");
            const ipData = await fetch('https://api.ipify.org?format=json').then(r => r.json());
            return `LOCAL_NODE_ID: 0x${Math.random().toString(16).slice(2,8)}\nPUBLIC_IP: ${ipData.ip}`;

        case 'logs':
            return `[19:22:01] INTRUSION ATTEMPT BLOCKED - IP: 182.11.0.4\n[19:45:30] KERNEL UPDATE COMPLETED\n[20:01:12] ENCRYPTION KEYS ROTATED`;

        case 'glitch':
            container.classList.toggle('glitch');
            return "Visual signal stability toggled.";

        case 'ping':
            const host = args[1] || "127.0.0.1";
            for(let i=0; i<100; i++) {
                if (STOP_SIGNAL) break;
                printLine(`64 bytes from ${host}: icmp_seq=${i} ttl=64 time=${(Math.random()*20+5).toFixed(2)}ms`);
                await sleep(500);
            }
            return STOP_SIGNAL ? "PING ABORTED BY USER." : "";

        case 'download':
            const file = args[1] || "classified_data.db";
            printLine(`INITIATING DOWNLOAD: ${file}`, "warning");
            for(let i=0; i<=100; i+=5) {
                if (STOP_SIGNAL) break;
                let bar = "=".repeat(i/5) + ">" + ".".repeat(20 - i/5);
                printLine(`Downloading [${bar}] ${i}%`, "info");
                await sleep(400);
            }
            return STOP_SIGNAL ? "DOWNLOAD TERMINATED. CACHE PURGED." : `SUCCESS: ${file} saved to /root/downloads/`;

        case 'brute':
            printLine("STARTING NEURAL CRACKER...", "error");
            for(let i=0; i<20; i++) {
                if (STOP_SIGNAL) break;
                const hex = Math.random().toString(16).slice(2, 10).toUpperCase();
                printLine(`ATTEMPTING HASH: ${hex}... [DENIED]`);
                await sleep(200);
            }
            return STOP_SIGNAL ? "BRUTE FORCE ABORTED." : "CRITICAL FAILURE: Firewall too strong.";

        case 'crypto':
            printLine("Connecting to Coinbase API...", "info");
            const cRes = await fetch('https://api.coingecko.com/api/v3/simple/price?ids=bitcoin,ethereum,solana&vs_currencies=usd');
            const cData = await cRes.json();
            return `BTC: $${cData.bitcoin.usd} | ETH: $${cData.ethereum.usd} | SOL: $${cData.solana.usd}`;

        case 'map':
            return `TRACKING NODES:\n[N.AMERICA] - ACTIVE\n[EUROPE] - ACTIVE\n[ASIA] - OFFLINE\n[ANTARCTICA] - ACTIVE`;

        case 'clear':
            term.innerHTML = '';
            return "";

        default:
            return `<span class="error">COMMAND NOT RECOGNIZED: ${cmd}</span>`;
    }
}

/**
 * UI HELPERS
 */
function printLine(text, type = "") {
    const div = document.createElement('div');
    div.className = `line ${type}`;
    div.innerHTML = text;
    term.appendChild(div);
    term.scrollTop = term.scrollHeight;
}

input.addEventListener('keydown', async (e) => {
    if (e.key === 'Enter') {
        const val = input.value.trim();
        if (!val) return;

        // If command is STOP, trigger the signal immediately
        if (val.toLowerCase() === 'stop') {
            STOP_SIGNAL = true;
            printLine(`<span class="prompt-symbol">root@titan:~#</span> ${val}`, "error");
            input.value = '';
            return;
        }

        printLine(`<span class="prompt-symbol">root@titan:~#</span> ${val}`);
        input.value = '';
        
        STOP_SIGNAL = false;
        const result = await processCommand(val);
        
        if (result) printLine(result);
        
        ACTIVE_PROCESS = false;
        statusTag.innerText = "STATUS: [READY]";
    }
});

// Focus handling
window.addEventListener('click', () => input.focus());

// Clock Update
setInterval(() => {
    document.getElementById('clock').innerText = new Date().toLocaleTimeString();
}, 1000);
</script>
</body>
</html>
