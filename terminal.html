<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ATLAS: DATA FLOW CONSOLE v5.2 (LOCKDOWN READY)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
    <style>
        /* General Console Theme */
        body {
            background-color: #000;
            font-family: 'VT323', monospace;
            color: #00ff41; /* Console Green (Default) */
            font-size: 1.1rem;
            line-height: 1.4;
            height: 100vh;
            margin: 0;
            overflow: hidden; 
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative; 
            transition: color 0.5s, border-color 0.5s, background-color 0.1s; 
        }

        /* --- Animated Background Layer --- */
        #terminal-background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -2; 
            background-size: cover;
            background-position: center;
            opacity: 0.3; 
            filter: grayscale(100%) brightness(50%); 
            transition: background-image 0.5s ease, filter 0.5s, opacity 0.5s;
            background-image: url('main.gif'); /* Placeholder image */
        }

        /* Simulated CRT/Scanline Effect */
        body::before {
            content: "";
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            background: repeating-linear-gradient(
                #000, 
                #000 1px, 
                rgba(0, 255, 65, 0.08) 2px, 
                #000 3px
            );
            opacity: 0.8;
            z-index: -1;
            transition: background 0.5s;
        }

        /* --- LOCKDOWN EFFECT CSS --- */
        .lockdown-active {
            background-color: #500000 !important; 
            color: #ff0000 !important; 
        }
        .lockdown-active .console-container {
            border-color: #ff0000 !important;
            box-shadow: 0 0 15px #ff0000 !important;
            animation: lockdown-flash 0.1s infinite alternate; 
        }
        .lockdown-active body::before {
            background: repeating-linear-gradient(#500000, #500000 1px, rgba(255, 0, 0, 0.15) 2px, #500000 3px);
            opacity: 1;
        }
        @keyframes lockdown-flash {
            from { opacity: 1; }
            to { opacity: 0.8; }
        }
        /* --- End LOCKDOWN EFFECT CSS --- */


        .console-container {
            border: 3px solid #00ff41; 
            box-shadow: 0 0 10px #00ff41; 
            height: 95vh;
            display: flex;
            flex-direction: column;
            margin: 10px auto;
            max-width: 1000px;
            width: 95%; 
            position: relative; 
            transition: transform 0.1s ease-in-out, border-color 0.5s, box-shadow 0.5s; 
        }

        /* Output Area */
        #output-area {
            flex-grow: 1;
            overflow-y: auto;
            padding: 1rem;
            background: rgba(0, 0, 0, 0.9);
            white-space: pre-wrap;
        }

        /* Input Area */
        #input-line {
            padding: 1rem;
            border-top: 1px solid #00ff41;
            display: flex;
            transition: border-top 0.5s;
        }

        #input-prefix {
            color: #ff00ff; 
        }

        #command-input {
            background: transparent;
            border: none;
            color: inherit; 
            flex-grow: 1;
            outline: none;
            margin-left: 5px;
            font-family: 'VT323', monospace;
            font-size: 1.1rem;
        }
        
        /* Status Bar */
        #status-bar {
            background: #004d1a;
            color: #fff;
            padding: 0.5rem 1rem;
            text-align: right;
            font-size: 0.9rem;
            transition: background 0.5s;
        }
        
        /* THEME & Holiday Styles (Simplified) */
        .blue-theme { color: #00d0ff; }
        .red-theme { color: #ff3030; }
        .blue-theme .console-container { border-color: #00d0ff; box-shadow: 0 0 10px #00d0ff; }
        .red-theme .console-container { border-color: #ff3030; box-shadow: 0 0 10px #ff3030; }
        
    </style>
</head>
<body>
    
    <audio id="main-music" loop preload="auto" volume="1.0">
        <source src="hack.mp3" type="audio/mp3">
    </audio>
    <audio id="siren-audio" preload="auto">
        <source src="siren.mp3" type="audio/mp3">
    </audio>
    
    <div id="terminal-background"></div>

    <div class="console-container">
        
        <div id="status-bar">
            <span id="lockdown-indicator" style="color: #ff0000; float: left; display: none;">[LOCKDOWN ACTIVE]</span>
            ATLAS CONSOLE v5.2 | OPERATOR: E.I. | STATUS: ONLINE | DATABASE: STANDALONE
        </div>

        <div id="output-area">
            [[INITIATING ACCESS. . .]]<br>
            [[WELCOME, OPERATOR. LEVEL EXTREME CLEARANCE CONFIRMED.]]<br>
            <br>
            Type **HELP** for available commands.
            <br>
        </div>

        <div id="input-line">
            <span id="input-prefix">ATLAS ></span>
            <input type="text" id="command-input" autofocus>
        </div>
        
    </div>

    <script>
        const outputArea = document.getElementById('output-area');
        const commandInput = document.getElementById('command-input');
        const consoleContainer = document.querySelector('.console-container');
        const bodyElement = document.body; 
        const lockdownIndicator = document.getElementById('lockdown-indicator');
        const sirenAudio = document.getElementById('siren-audio'); 

        let isBusy = false; 
        let isLockedDown = false; 
        
        // --- CONSTANTS ---
        const LOCKOUT_DURATION_MS = 30 * 60 * 1000; // 30 minutes
        const LOCKOUT_STORAGE_KEY = 'terminalLockoutTime';
        const USERNAME_COOKIE_KEY = 'username'; 
        const VISITOR_LOG_KEY = 'atlasVisitorLog'; // New key for the ACTIVE command
        const ADMIN_USERNAME = "EthanUnlocked"; 
        
        // --- THEME DATA (Simplified) ---
        const THEMES = {
            'DEFAULT': { className: '', mainColor: '#00ff41' },
            'BLUE': { className: 'blue-theme', mainColor: '#00d0ff' },
            'RED': { className: 'red-theme', mainColor: '#ff3030' },
        };
        let currentTheme = 'DEFAULT';

        // =========================================================================
        // --- Utility Functions ---
        // =========================================================================

        function writeOutput(text, color = THEMES[currentTheme].mainColor) {
            const line = document.createElement('span');
            line.style.color = color;
            line.innerHTML = text; 
            outputArea.appendChild(line);
            outputArea.appendChild(document.createElement('br'));
            outputArea.scrollTop = outputArea.scrollHeight;
        }

        function showPrompt() {
            if (isLockedDown) return; 
            if (!isBusy) {
                writeOutput("", THEMES[currentTheme].mainColor);
            }
            commandInput.focus();
            commandInput.value = '';
        }

        function getCookie(cname) {
            let name = cname + "=";
            let decodedCookie = decodeURIComponent(document.cookie);
            let ca = decodedCookie.split(';');
            for(let i = 0; i <ca.length; i++) {
                let c = ca[i];
                while (c.charAt(0) === ' ') {
                    c = c.substring(1);
                }
                if (c.indexOf(name) === 0) {
                    return c.substring(name.length, c.length);
                }
            }
            return "";
        }
        
        function getUsername() {
            return getCookie(USERNAME_COOKIE_KEY).trim();
        }
        
        function isAdmin() {
            return getUsername().toLowerCase() === ADMIN_USERNAME.toLowerCase();
        }
        
        // New: Track and log the current user
        function logCurrentUser() {
            const username = getUsername();
            if (!username) return; 

            let log = JSON.parse(localStorage.getItem(VISITOR_LOG_KEY) || '[]');
            const userIndex = log.findIndex(u => u.name.toLowerCase() === username.toLowerCase());
            
            const timestamp = new Date().toLocaleString();

            if (userIndex === -1) {
                log.push({ name: username, firstVisit: timestamp, lastActive: timestamp });
            } else {
                log[userIndex].lastActive = timestamp;
            }

            localStorage.setItem(VISITOR_LOG_KEY, JSON.stringify(log));
        }


        // =========================================================================
        // --- LOCKDOWN Logic ---
        // =========================================================================

        function checkInitialLockdown() {
            const lockoutEndTime = localStorage.getItem(LOCKOUT_STORAGE_KEY);
            const currentTime = new Date().getTime();

            if (lockoutEndTime && currentTime < parseInt(lockoutEndTime)) {
                isLockedDown = true;
                
                bodyElement.classList.add('lockdown-active');
                lockdownIndicator.style.display = 'inline';
                commandInput.disabled = true;

                if (isAdmin()) {
                    commandInput.disabled = false;
                    writeOutput("\n!! WARNING: SYSTEM IS IN GLOBAL LOCKDOWN MODE (30 MIN) !!", '#ffff00');
                    writeOutput(`!! ACCESS GRANTED TO ADMIN: ${ADMIN_USERNAME.toUpperCase()} !!`, '#ff00ff');
                    writeOutput("!! TYPE '?DISABLE' TO END LOCKDOWN !!", '#ff00ff');
                } else {
                    kickUserDueToLockdown(false); 
                    return; 
                }
            } else if (lockoutEndTime) {
                localStorage.removeItem(LOCKOUT_STORAGE_KEY);
            }
        }

        function startLockdown() {
            if (isLockedDown) return;
            isLockedDown = true;
            isBusy = true;
            commandInput.disabled = true;

            const lockoutEndTime = new Date().getTime() + LOCKOUT_DURATION_MS;
            localStorage.setItem(LOCKOUT_STORAGE_KEY, lockoutEndTime);

            writeOutput("\n>>> INITIATING LOCKDOWN! <<<", '#ff0000');
            
            if (!isAdmin()) {
                 setTimeout(() => kickUserDueToLockdown(true), 1500);
            } else {
                 setTimeout(() => {
                    bodyElement.classList.add('lockdown-active');
                    lockdownIndicator.style.display = 'inline';
                    commandInput.disabled = false;
                    writeOutput("\nADMIN PROTOCOL ACCEPTED. TYPE '?DISABLE' TO END LOCKDOWN.", '#ff00ff');
                    isBusy = false;
                    showPrompt();
                 }, 1500);
            }
        }
        
        function kickUserDueToLockdown(isNewLockdown) {
            outputArea.innerHTML = '';
            bodyElement.classList.add('lockdown-active');
            commandInput.disabled = true;

            if (isNewLockdown) {
                writeOutput("!!! CRITICAL ALERT !!! INITIATING LOCKDOWN!", '#ff0000');
                writeOutput("!!! SYSTEM ACCESS REVOKED !!!", '#ff0000');
            } else {
                writeOutput("!!! ATLAS TERMINAL ACCESS DENIED !!!", '#ff0000');
                writeOutput("!!! SYSTEM IS IN GLOBAL LOCKDOWN (30 MIN) !!!", '#ff0000');
            }
            
            if (sirenAudio) {
                sirenAudio.loop = true;
                sirenAudio.play().catch(e => console.log("Siren failed to auto-play:", e));
            }
            
            setTimeout(() => {
                window.location.href = 'index.html'; 
            }, 3000); 
        }
        
        function disableLockdown() {
            if (!isAdmin()) {
                writeOutput("ERROR: Authorization denied. Only 'EthanUnlocked' can disable lockdown.", '#ff0000');
                return;
            }

            localStorage.removeItem(LOCKOUT_STORAGE_KEY);
            isLockedDown = false;
            bodyElement.classList.remove('lockdown-active');
            lockdownIndicator.style.display = 'none';
            if (sirenAudio) sirenAudio.pause();
            
            writeOutput("\n>> LOCKDOWN PROTOCOL DISABLED BY ADMIN ACCESS.", '#00ff41');
            writeOutput(">> ATLAS CONSOLE RESTORED TO NORMAL OPERATION.", '#00ff41');
            isBusy = false;
            showPrompt();
        }

        // =========================================================================
        // --- Feature Commands ---
        // =========================================================================

        function runActiveCommand() {
            const log = JSON.parse(localStorage.getItem(VISITOR_LOG_KEY) || '[]');
            
            if (log.length === 0) {
                writeOutput("LOG: No historical visitor data found for ethanunlocked690.github.io.", '#ffff00');
                return;
            }

            writeOutput(`\n--- ACTIVE SESSION LOG: ${log.length} TOTAL VISITOR(S) LOGGED ---`, '#00ff41');
            
            // Current User is assumed "active"
            const activeUsers = log.filter(u => u.name.toLowerCase() === getUsername().toLowerCase());
            
            if (activeUsers.length > 0) {
                 writeOutput(`\n[01] >>> CURRENT OPERATOR: ${activeUsers[0].name.toUpperCase()} (LAST CHECK: ${activeUsers[0].lastActive})`, '#ff00ff');
            }
            
            // List other logged users (historical visitors)
            writeOutput("\n-- HISTORICAL VISITORS (NAME / LAST ACTIVE) --", '#ffff00');
            log.sort((a, b) => new Date(b.lastActive) - new Date(a.lastActive)); // Sort by most recent
            
            log.forEach((user, index) => {
                // Skip the current operator for the historical list (already at the top)
                if (user.name.toLowerCase() !== getUsername().toLowerCase()) {
                    const statusColor = (new Date().getTime() - new Date(user.lastActive).getTime() < 3600000) ? '#00ffff' : '#ffaa00'; // Active within 1 hour = Cyan
                    writeOutput(`[${String(index + 1).padStart(2, '0')}] ${user.name} (Last Active: ${user.lastActive})`, statusColor);
                }
            });
            writeOutput("--------------------------------------------", '#00ff41');
        }

        // =========================================================================
        // --- Main Command Processor ---
        // =========================================================================
        
        function processCommand(command) {
            const parts = command.trim().split(/\s+/);
            const cmd = parts[0].toUpperCase();
            
            // --- Lockdown Check (Admin Bypass/Disable) ---
            if (isLockedDown) {
                if (isAdmin() && cmd === '?DISABLE') {
                    writeOutput(`> ${command}`, '#ff00ff');
                    disableLockdown();
                    return;
                }
                writeOutput(`> ${command}`, '#ff0000'); 
                writeOutput("!! ERROR: TERMINAL IS IN LOCKDOWN. COMMANDS BLOCKED. !!", '#ff0000');
                return;
            }
            
            if (isBusy && cmd !== 'LOGOUT' && cmd !== '?LOCKDOWN' && cmd !== 'LOCKDOWN') {
                writeOutput("!! System Busy. Please wait for current sequence to finish.", '#ff0000');
                return;
            }
            
            // --- LOCKDOWN Command Check (Initiation) ---
            if (cmd === '?LOCKDOWN' || cmd === 'LOCKDOWN') {
                writeOutput(`> ${command}`, '#ff00ff');
                startLockdown();
                return;
            }
            
            // --- All other commands ---
            writeOutput(`> ${command}`, '#ff00ff'); 
            
            switch (cmd) {
                case 'HELP':
                    writeOutput("--- AVAILABLE ATLAS CONSOLE FEATURES (v5.2) ---", '#ffff00');
                    writeOutput("1. SEARCH [target] : Query the deep web data stream.", '#00ff41');
                    writeOutput("2. DECRYPT [file] : Attempt to break 256-bit encryption.", '#00ff41');
                    writeOutput("3. SCAN [ip/domain] : Perform port analysis and vulnerability scan.", '#00ff41');
                    writeOutput("4. HUNT [target] : Initiate autonomous data package retrieval.", '#00ff41');
                    writeOutput("5. TRACE [ip] : Initiate geographical location trace.", '#00ff41');
                    writeOutput("6. DEFACE [url] : Execute front-end injection protocol.", '#ff00ff');
                    writeOutput("7. ENCRYPT [file] : Apply high-level security to files.", '#ff00ff');
                    writeOutput("8. FAKE NEWS [topic] : Fabricate and deploy disinformation packets.", '#ff00ff');
                    writeOutput("9. PINGFLOOD [ip] : Execute Denial-of-Service test payload.", '#ff00ff');
                    writeOutput("10. SPOOF [target] : Mask identity and reroute origin point.", '#ff00ff');
                    writeOutput("11. CLEANUP : Purge local console logs and session cache.", '#00ffff');
                    writeOutput("12. REBOOT : Soft reboot the console OS.", '#00ffff');
                    writeOutput("13. THEME [color] : Change console display color (BLUE/RED/DEFAULT).", '#00ffff');
                    writeOutput("14. **ACTIVE** : See the log of unique visitors on the site (New!)", '#00ffff');
                    writeOutput("15. LOGOUT: Terminates session and redirects to main page.", '#ff0000');
                    writeOutput("16. **?LOCKDOWN**: Initiates the 30-minute global security lockdown.", '#ff0000');
                    writeOutput("17. SUDO: (Hidden Command) Admin Alpha Override Protocol.", '#ffff00'); 
                    break;
                
                case 'ACTIVE':
                    runActiveCommand();
                    break;

                case 'LOGOUT':
                    writeOutput("SESSION TERMINATED. Redirecting to source...", '#ff0000');
                    setTimeout(() => { window.location.href = 'https://ethanunlocked690.github.io'; }, 1000);
                    return;
                case 'SUDO':
                    writeOutput(">> LEVEL ALPHA OVERRIDE ACTIVATED. Welcome, Admin.", '#ffff00');
                    break;
                // --- Placeholder for other commands ---
                case 'REBOOT':
                case 'CLEANUP':
                case 'THEME':
                case 'SEARCH':
                case 'DECRYPT':
                case 'SCAN':
                case 'HUNT':
                case 'TRACE':
                case 'DEFACE':
                case 'ENCRYPT':
                case 'FAKE': // Catch FAKE NEWS short form
                case 'PINGFLOOD':
                case 'SPOOF':
                    writeOutput(`Running Command: ${cmd}... [PLACEHOLDER EXECUTION]`, '#00ff41');
                    break;
                case 'NEWS': // Catch FAKE NEWS part 2
                    if (parts.length > 1 && parts[0].toUpperCase() === 'FAKE') {
                         writeOutput(`Running Command: FAKE NEWS... [PLACEHOLDER EXECUTION]`, '#00ff41');
                         break;
                    }
                default:
                    writeOutput(`ERROR: Command '${cmd}' not recognized. Type HELP for a list of features.`, '#ff0000');
                    break;
            }
            
            if (!isBusy && !isLockedDown) showPrompt();
        }

        // =========================================================================
        // --- Initialization and Events ---
        // =========================================================================
        
        document.addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && !commandInput.disabled) {
                processCommand(commandInput.value);
                commandInput.value = '';
            }
        });
        
        window.onload = function() {
            // 1. Log the current user's visit
            logCurrentUser();
            
            // 2. Check lockdown status
            checkInitialLockdown(); 
            
            // 3. Focus input
            commandInput.focus();
        };
    </script>
</body>
</html>
