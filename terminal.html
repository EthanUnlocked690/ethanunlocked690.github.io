<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ATLAS: DATA FLOW CONSOLE v4.5 (HIGH-LEVEL ACCESS)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
    <style>
        /* General Console Theme */
        body {
            background-color: #000;
            font-family: 'VT323', monospace;
            color: #00ff41; /* Console Green (Default) */
            font-size: 1.1rem;
            line-height: 1.4;
        }

        /* Simulated CRT/Scanline Effect */
        body::before {
            content: "";
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            background: repeating-linear-gradient(
                #000, 
                #000 1px, 
                rgba(0, 255, 65, 0.08) 2px, 
                #000 3px
            );
            opacity: 0.8;
            z-index: -1;
        }

        .console-container {
            border: 3px solid #00ff41; /* Default Border */
            box-shadow: 0 0 10px #00ff41; /* Default Shadow */
            height: 95vh;
            display: flex;
            flex-direction: column;
            margin: 10px auto;
            max-width: 1000px;
        }

        /* Output Area */
        #output-area {
            flex-grow: 1;
            overflow-y: auto;
            padding: 1rem;
            background: rgba(0, 0, 0, 0.9);
            white-space: pre-wrap;
        }

        /* Input Area */
        #input-line {
            padding: 1rem;
            border-top: 1px solid #00ff41;
            display: flex;
        }

        #input-prefix {
            color: #ff00ff;
        }

        #command-input, #password-input {
            background: transparent;
            border: none;
            color: inherit; /* Inherit color from body/theme */
            flex-grow: 1;
            outline: none;
            margin-left: 5px;
            font-family: 'VT323', monospace;
            font-size: 1.1rem;
        }
        
        #password-input {
            display: none; 
        }

        /* Status Bar */
        #status-bar {
            background: #004d1a;
            color: #fff;
            padding: 0.5rem 1rem;
            text-align: right;
            font-size: 0.9rem;
        }
        
        /* OVERRIDE Status Bar Effect */
        .override-active {
            background: #4d0000 !important; /* Dark Red */
            box-shadow: 0 0 5px #ff0000;
        }
        
        /* TRACE Challenge Display */
        #trace-challenge-container {
            font-size: 2rem;
            font-weight: bold;
            text-align: center;
            padding: 10px;
            margin: 10px 0;
            border: 3px solid #ff0000;
            background-color: #110000;
            color: #ff0000;
        }
        #trace-code {
            color: #ffff00;
            letter-spacing: 5px;
        }
        #trace-timer {
            font-size: 1rem;
            color: #00ffff;
        }

        /* SCAN Panel Styles */
        #lie-detector-panel {
            border: 1px solid #00ffff;
            padding: 1rem;
            margin: 1rem 0;
            background: rgba(0, 0, 0, 0.8);
        }
        #video-feed {
            width: 100%;
            max-height: 200px;
            background-color: #001a0a;
            border: 1px solid #00ff41;
            display: block;
        }
        .scan-data {
            margin-top: 10px;
            line-height: 1.6;
        }
        .data-label {
            color: #00ffff;
        }
        .data-value {
            color: #ff00ff;
        }
        #lie-status {
            font-size: 1.5rem;
            font-weight: bold;
            text-align: center;
            margin-top: 10px;
        }
        
        /* --- Holiday Themes --- */
        /* NOTE: You need to ensure the 'hack.mp3', 'new.mp3', 'v.mp3', 'labor.mp3', 'easter.mp3', 'mother.mp3', 'scary.mp3', 'thank.mp3', and 'bells.mp3' files exist in the same directory for the audio to work. */
        .new-years-theme .console-container { border-color: #ffc107; box-shadow: 0 0 10px #ffc107; }
        .valentines-theme .console-container { border-color: #ff69b4; box-shadow: 0 0 10px #ff69b4; }
        .labour-theme .console-container { border-color: #dc3545; box-shadow: 0 0 10px #dc3545; }
        .april-theme .console-container { border-color: #007bff; box-shadow: 0 0 10px #007bff; }
        .anzac-theme .console-container { border-color: #6c757d; box-shadow: 0 0 10px #6c757d; }
        .mothers-theme .console-container { border-color: #6f42c1; box-shadow: 0 0 10px #6f42c1; }
        .flag-theme .console-container { border-color: #000080; box-shadow: 0 0 10px #000080; }
        .halloween-theme .console-container { border-color: #ff8c00; box-shadow: 0 0 10px #ff8c00; }
        .thanksgiving-theme .console-container { border-color: #8b4513; box-shadow: 0 0 10px #8b4513; }
        .christmas-theme .console-container { border-color: #006400; box-shadow: 0 0 10px #006400; }
        
    </style>
</head>
<body class="p-4">
    
    <audio id="main-music" loop preload="auto" volume="1.0">
        <source src="hack.mp3" type="audio/mp3">
        Your browser does not support the audio element.
    </audio>
    
    <div id="holiday-music-container"></div>

    <div class="console-container">
        
        <div id="status-bar">
            <span id="override-indicator" style="color: #ff0000; float: left; display: none;">[ALPHA OVERRIDE ACTIVE]</span>
            ATLAS CONSOLE v4.5 | OPERATOR: E.I. | STATUS: ONLINE | DATABASE: STANDALONE
        </div>

        <div id="output-area">
            [[INITIATING ACCESS. . .]]<br>
            [[WELCOME, OPERATOR. LEVEL DELTA CLEARANCE CONFIRMED.]]<br>
            <br>
            Type **HELP** for available commands.
            <br>
        </div>

        <div id="input-line">
            <span id="input-prefix">ATLAS ></span>
            <input type="text" id="command-input" autofocus>
            <input type="text" id="password-input" style="display: none;"> 
        </div>
        
    </div>

    <script>
        const outputArea = document.getElementById('output-area');
        const commandInput = document.getElementById('command-input');
        const passwordInput = document.getElementById('password-input'); 
        const statusBar = document.getElementById('status-bar');
        const overrideIndicator = document.getElementById('override-indicator');
        const bodyElement = document.body; 
        const consoleContainer = document.querySelector('.console-container');
        const mainMusic = document.getElementById('main-music'); 
        const holidayMusicContainer = document.getElementById('holiday-music-container');

        let isBusy = false; 
        let scanActive = false;
        let decryptState = 0; 
        let scanState = 0; 
        let huntState = 0; 
        let targetEmail = ''; 
        let scanInterval; 
        let securityTimeout; 
        
        let currentPasswordDisplay = '';
        let actualPasswordAttempt = '';
        let passwordTimeout;
        let musicStarted = false; 
        let currentHolidayAudio = null; 

        // --- TRACE CHALLENGE DATA ---
        let traceCode = '';
        let traceTarget = '';
        let traceTimer;
        const TRACE_TIME_SECONDS = 3;

        // --- DECRYPT DATA ---
        const SECRET_EMAIL = 'secret@gmail.com';
        const SIMULATED_PASSWORD = 'p4ssw0rd!';
        const PASSWORD_DISABLED_EMAIL = 'nopass@corp.net';
        const DECRYPT_TIMER_SECONDS = 5.0; 
        const PASSWORD_LENGTH = SIMULATED_PASSWORD.length;
        
        // --- SCAN PASSWORD ---
        const SCAN_PASSWORD = 'SC4NN3R#';
        
        // --- OVERRIDE STATUS ---
        let overrideEnabled = false;

        // Security Questions
        const SECURITY_QUESTIONS = {
            "What is EthanUnlocked's birth date?": "25 January 2013",
            "How many pets does EthanUnlocked have?": "3",
            "When did EthanUnlocked start brawl stars?": "2024",
            "How many games does EthanUnlocked play?": "Unknown",
            "What is EthanUnlocked's favourite food?": "Burger",
            "What is EthanUnlocked's favourite drink?": "Pepsi"
        };
        let currentSecurityQuestion = null;

        // --- NEW HUNT EASTER EGG DATA (Google/Universal Web Focus) ---
        const BROWSER_EASTER_EGGS = [
            {
                id: 1,
                name: "Do a Barrel Roll",
                trigger_cmd: "Do a Barrel Roll",
                info: "Causes the entire browser window to perform a 360-degree spin, a reference to the Star Fox video game series.",
                image_url: "https://i.imgur.com/G5Zf7vL.gif",
                action_url: "https://www.google.com/search?q=do+a+barrel+roll",
            },
            {
                id: 2,
                name: "Askew / Tilt",
                trigger_cmd: "Askew",
                info: "Tilts the search results page slightly to the right, creating a jarring, 'askew' effect.",
                image_url: "https://i.imgur.com/x0H4s7i.png",
                action_url: "https://www.google.com/search?q=askew",
            },
            {
                id: 3,
                name: "The Answer to Life...",
                trigger_cmd: "The answer to the ultimate question of life the universe and everything",
                info: "A calculator card displays the number 42, a famous reference to the science fiction book 'The Hitchhiker's Guide to the Galaxy'.",
                image_url: "https://i.imgur.com/4X7uV2z.png",
                action_url: "https://www.google.com/search?q=the+answer+to+life+the+universe+and+everything",
            }
        ];

        // --- HOLIDAY THEMES (Local MP3 files) ---
        const HOLIDAY_THEMES = {
            // Month (0-indexed) : { Name, Color, Music_File, CSS_Class }
            0: { name: "New Year's Eve", color: "#ffc107", music: "new.mp3", css: "new-years-theme" }, 
            1: { name: "Valentine's Day", color: "#ff69b4", music: "v.mp3", css: "valentines-theme" }, 
            2: { name: "Labour Day (AU/NZ)", color: "#dc3545", music: "labor.mp3", css: "labour-theme" }, 
            3: { name: "Easter & April Fools", color: "#007bff", music: "easter.mp3", css: "april-theme" }, 
            4: { name: "Mother's Day", color: "#6f42c1", music: "mother.mp3", css: "mothers-theme" }, 
            8: { name: "National Flag Day", color: "#000080", music: "labor.mp3", css: "flag-theme" }, 
            9: { name: "Halloween", color: "#ff8c00", music: "scary.mp3", css: "halloween-theme" }, 
            10: { name: "Thanksgiving", color: "#8b4513", music: "thank.mp3", css: "thanksgiving-theme" }, 
            11: { name: "Christmas", color: "#006400", music: "bells.mp3", css: "christmas-theme" } 
        };
        
        // =========================================================================
        // --- Utility Functions ---
        // =========================================================================

        function writeOutput(text, color = '#00ff41') {
            const line = document.createElement('span');
            line.style.color = color;
            line.textContent = text;
            outputArea.appendChild(line);
            outputArea.appendChild(document.createElement('br'));
            outputArea.scrollTop = outputArea.scrollHeight;
        }

        function showPrompt() {
            if (!isBusy) {
                writeOutput("", '#00ff41');
            }
            
            if (scanState === 1 || scanState === 2) {
                // Password input for SCAN or TRACE challenge
                commandInput.style.display = 'none';
                passwordInput.style.display = 'block';
                passwordInput.focus();
                if (scanState === 1) {
                    passwordInput.type = 'password';
                    passwordInput.value = currentPasswordDisplay;
                } else {
                    // TRACE challenge input is text
                    passwordInput.type = 'text';
                    passwordInput.value = '';
                }
            } else {
                // Regular command input
                commandInput.style.display = 'block';
                passwordInput.style.display = 'none';
                commandInput.focus();
                commandInput.value = '';
            }
        }

        function getRandomElement(array) {
            return array[Math.floor(Math.random() * array.length)];
        }

        // =========================================================================
        // --- Core Command Handlers (Includes Stubs for Context) ---
        // =========================================================================

        // --- SEARCH ---
        function runSearch(query) {
            isBusy = true;
            writeOutput(`INITIATING PUBLIC WEB SCAN FOR: "${query}"...`, '#ffff00');
            new Promise(resolve => setTimeout(resolve, 1500)).then(() => {
                writeOutput(">> DATA RETRIEVAL SUCCESSFUL:", '#00ffff');
                const normalizedQuery = query.toLowerCase();
                if (normalizedQuery.includes("eiffel") || normalizedQuery.includes("paris")) {
                    writeOutput("[Source 1] Title: Eiffel Tower - Official Site", '#fff');
                    writeOutput("[Source 2] Status: HIGH TOURIST ALERT, heavy crowd movement.", '#ffff00');
                } else if (normalizedQuery.includes("ethan") || normalizedQuery.includes("ioannou")) {
                    writeOutput(">> TARGET: ETHAN IOANNOU. DATA RETRIEVAL BLOCKED BY LEVEL DELTA OVERRIDE.", '#ff0000');
                } else {
                    writeOutput(">> NO SIGNIFICANT PUBLIC DATA FOUND. QUERY TOO VAGUE.", '#ff0000');
                }
                isBusy = false;
                showPrompt();
            });
        }
        
        // --- DECRYPT (Simplified Security Check Flow) ---
        function startSecurityCheck() {
            currentSecurityQuestion = getRandomElement(Object.keys(SECURITY_QUESTIONS));
            decryptState = 1.5;
            writeOutput(`\n--- SECURITY CHECK REQUIRED (LEVEL 2) ---`, '#ff00ff');
            writeOutput(`>> QUESTION: ${currentSecurityQuestion}`, '#ffff00');
            writeOutput(`(Please type the exact answer and press Enter)`, '#ffff00');
        }

        function handleSecurityAnswer(answer) {
            if (answer.trim().toLowerCase() === SECURITY_QUESTIONS[currentSecurityQuestion].toLowerCase()) {
                writeOutput(`>> ACCESS GRANTED. SECURITY KEY ACCEPTED.`, '#00ff41');
                decryptState = 2; // Security passed
                runDecrypt('init');
            } else {
                writeOutput(`>> ACCESS DENIED. SECURITY PROTOCOL VIOLATION.`, '#ff0000');
                decryptState = 0; // Restart
                isBusy = false;
                showPrompt();
            }
        }

        function runDecrypt(input) {
            if (decryptState === 0) {
                // Initial DECRYPT command
                isBusy = true;
                writeOutput("\nINITIATING DECRYPTION MODULE.", '#00ffff');
                writeOutput("Please enter the target email address to begin a 2-step security check.", '#ffff00');
                decryptState = 1;
                isBusy = false;
                showPrompt();
            } else if (decryptState === 1) {
                // Target email input
                targetEmail = input.trim();
                writeOutput(`>> TARGET: ${targetEmail}. ENCRYPTION LEVEL: HIGH.`, '#00ff41');
                startSecurityCheck();
            } else if (decryptState === 2) {
                // Start decryption after security check
                isBusy = true;
                writeOutput(`\n--- DECRYPTING HASH FOR ${targetEmail} ---`, '#00ffff');
                
                let timer = DECRYPT_TIMER_SECONDS;
                const decryptInterval = setInterval(() => {
                    timer -= 0.5;
                    const status = (Math.random() > 0.3) ? 'OK' : 'FAIL';
                    const hash = Array(Math.floor(Math.random() * 5) + 10).fill().map(() => (Math.random() > 0.5 ? '0' : '1')).join('');
                    const progress = Math.min(100, (DECRYPT_TIMER_SECONDS - timer) / DECRYPT_TIMER_SECONDS * 100);
                    writeOutput(`[ ${Math.ceil(progress)}% ] ${hash} | STATUS: ${status}`, status === 'OK' ? '#ffff00' : '#ff0000');
                    
                    if (timer <= 0) {
                        clearInterval(decryptInterval);
                        writeOutput(`\nDECRYPTION COMPLETE. HASH GENERATED.`, '#00ff41');
                        if (targetEmail === SECRET_EMAIL) {
                            writeOutput(`TARGET HASH: 81b7e403d159a60c042d385f03a58e`, '#ff00ff');
                            writeOutput(`**USE COMPARE [hash/password] to test decryption against database.**`, '#ffff00');
                            decryptState = 3; // Ready for COMPARE
                        } else if (targetEmail === PASSWORD_DISABLED_EMAIL) {
                             writeOutput(`TARGET HASH: NULL-H6. Note: Password/Security Check Disabled on this target.`, '#ff00ff');
                             decryptState = 0; // Session ended
                        } else {
                            writeOutput(`TARGET HASH: 09c2d1b8f4e7c3a9d0e1f2b4c5d6e7f8`, '#ff00ff');
                            writeOutput(`**USE COMPARE [hash/password] to test decryption against database.**`, '#ffff00');
                            decryptState = 3;
                        }
                        isBusy = false;
                        showPrompt();
                    }
                }, 500);

            } else if (decryptState === 3) {
                // Handle COMPARE command
                const parts = input.trim().split(/\s+/);
                const compareCmd = parts[0].toUpperCase();
                const compareArg = parts[1];
                
                if (compareCmd === 'COMPARE') {
                    if (compareArg === SIMULATED_PASSWORD || compareArg === '81b7e403d159a60c042d385f03a58e') {
                        writeOutput(`\n!! MATCH FOUND !!`, '#ff00ff');
                        writeOutput(`TARGET: ${targetEmail}`, '#ff00ff');
                        writeOutput(`PASSWORD: ${SIMULATED_PASSWORD}`, '#00ff41');
                        writeOutput(`DECRYPT MODULE: SESSION COMPLETE.`, '#00ff41');
                        decryptState = 0;
                    } else {
                        writeOutput(`\n!! COMPARISON FAILURE. NO MATCH FOUND. !!`, '#ff0000');
                    }
                    showPrompt();
                } else if (compareCmd === 'DECRYPT' && parts.length > 1) {
                    writeOutput(`\nERROR: DECRYPT is not needed now. Use COMPARE [hash/password].`, '#ff0000');
                    showPrompt();
                } else {
                    writeOutput(`\nERROR: Invalid DECRYPT option. Use COMPARE [hash/password].`, '#ff0000');
                    showPrompt();
                }
            } else {
                writeOutput(`ERROR: Invalid DECRYPT state. Try LOGOUT to reset.`, '#ff0000');
                showPrompt();
            }
        }
        
        // --- SCAN ---
        function runScan(passwordSuccess = false) {
            if (scanState === 0) {
                writeOutput("\nINITIATING BIO-FEEDBACK SCAN MODULE (Level Gamma Clearance Required).", '#00ffff');
                writeOutput("Enter SCAN Password:", '#ffff00');
                scanState = 1;
                actualPasswordAttempt = '';
                currentPasswordDisplay = '';
                showPrompt();
            } else if (scanState === 1) {
                // Password check handled by handleScanPassword
            } else if (scanState === 2) {
                // TRACE challenge is active
                writeOutput("\nERROR: TRACE CHALLENGE ACTIVE. Enter the code shown above.", '#ff0000');
                showPrompt();
            } else if (scanState === 3) {
                // Scan is starting
                isBusy = true;
                writeOutput("\n--- BIO-FEEDBACK SCAN IN PROGRESS ---", '#00ff41');
                
                const panel = document.createElement('div');
                panel.id = 'lie-detector-panel';
                panel.innerHTML = `
                    <div id="video-feed">[[ Simulating Live Video Feed... ]]</div>
                    <div class="scan-data">
                        <span class="data-label">PULSE:</span> <span class="data-value" id="pulse-data">--</span> bpm<br>
                        <span class="data-label">GSR:</span> <span class="data-value" id="gsr-data">--</span> kOhm<br>
                        <span class="data-label">RESP:</span> <span class="data-value" id="resp-data">--</span> br/min
                    </div>
                    <div id="lie-status">ANALYZING...</div>
                `;
                outputArea.appendChild(panel);

                scanActive = true;
                scanInterval = setInterval(updateLieDetection, 1000);
            }
        }

        function handleScanPassword(attempt) {
            writeOutput(`> ${'*'.repeat(attempt.length)}`, '#ff00ff');
            if (attempt === SCAN_PASSWORD) {
                writeOutput(`\n>> ACCESS GRANTED. WELCOME, ${SCAN_PASSWORD.toUpperCase()}.`, '#00ff41');
                scanState = 3;
                actualPasswordAttempt = '';
                currentPasswordDisplay = '';
                runScan(true);
            } else {
                writeOutput(`\n>> ACCESS DENIED. INCORRECT PASSWORD.`, '#ff0000');
                scanState = 0;
                actualPasswordAttempt = '';
                currentPasswordDisplay = '';
                showPrompt();
            }
        }

        function updateLieDetection() {
            if (!scanActive) return;

            const pulse = Math.floor(Math.random() * (120 - 60 + 1) + 60);
            const gsr = (Math.random() * (15 - 5) + 5).toFixed(2);
            const resp = Math.floor(Math.random() * (25 - 12 + 1) + 12);
            
            document.getElementById('pulse-data').textContent = pulse;
            document.getElementById('gsr-data').textContent = gsr;
            document.getElementById('resp-data').textContent = resp;
            
            const lieChance = Math.random();
            const lieStatusElement = document.getElementById('lie-status');
            
            if (lieChance < 0.1) {
                lieStatusElement.textContent = "LIE DETECTED! (High Deviation)";
                lieStatusElement.style.color = '#ff0000';
            } else if (lieChance < 0.4) {
                lieStatusElement.textContent = "STRESS PEAK (Anxiety)";
                lieStatusElement.style.color = '#ffff00';
            } else {
                lieStatusElement.textContent = "BASELINE CONFIRMED (Nominal)";
                lieStatusElement.style.color = '#00ff41';
            }
        }

        function endLieDetection() {
            if (scanInterval) clearInterval(scanInterval);
            scanActive = false;
            scanState = 0;
            const panel = document.getElementById('lie-detector-panel');
            if (panel) panel.remove();
            writeOutput("\nBIO-FEEDBACK SCAN TERMINATED.", '#00ff41');
            isBusy = false;
            showPrompt();
        }

        // --- TRACE ---
        function generateTraceCode() {
            const characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
            let result = '';
            for (let i = 0; i < 4; i++) {
                result += characters.charAt(Math.floor(Math.random() * characters.length));
            }
            return result;
        }

        function runTrace(target) {
            if (scanState === 2) {
                writeOutput("ERROR: TRACE CHALLENGE ALREADY ACTIVE.", '#ff0000');
                return;
            }

            if (target.toUpperCase() === 'CANCEL') {
                endTrace();
                return;
            }

            isBusy = true;
            traceTarget = target.trim() || 'GLOBAL_NETWORK';
            traceCode = generateTraceCode();
            scanState = 2; // TRACE challenge mode

            const traceContainer = document.createElement('div');
            traceContainer.id = 'trace-challenge-container';
            traceContainer.innerHTML = `
                !! TRACE PROTOCOL ACTIVATED !!<br>
                TARGET: ${traceTarget}<br>
                ENTRY CODE: <span id="trace-code">${traceCode}</span><br>
                TIME REMAINING: <span id="trace-timer">${TRACE_TIME_SECONDS.toFixed(1)}s</span>
            `;
            outputArea.appendChild(traceContainer);

            let timeLeft = TRACE_TIME_SECONDS;
            const timerDisplay = document.getElementById('trace-timer');

            traceTimer = setInterval(() => {
                timeLeft -= 0.1;
                timerDisplay.textContent = timeLeft.toFixed(1) + 's';

                if (timeLeft <= 0) {
                    clearInterval(traceTimer);
                    endTrace(false); // Failure
                }
            }, 100);

            // Re-show prompt to get input into passwordInput field
            showPrompt();
            passwordInput.type = 'text'; // Ensure it's not password type
        }

        function handleTraceInput(input) {
            const traceContainer = document.getElementById('trace-challenge-container');
            if (!traceContainer) return; // Not in TRACE mode

            writeOutput(`> ${input}`, '#ff00ff');

            if (input.toUpperCase().trim() === traceCode) {
                endTrace(true); // Success
            } else {
                // No immediate failure, let the timer run down
                writeOutput("!! INCORRECT CODE. RE-ENTER BEFORE TIMEOUT.", '#ff0000');
            }
        }

        function endTrace(success = false) {
            clearInterval(traceTimer);
            const traceContainer = document.getElementById('trace-challenge-container');
            if (traceContainer) traceContainer.remove();
            
            if (success) {
                writeOutput(`\n>> TRACE SUCCESSFUL for ${traceTarget}!`, '#00ff41');
                writeOutput(">> ATTACK VECTOR ACQUIRED. (Data Omitted for Security)", '#ff00ff');
            } else {
                writeOutput(`\n!! TRACE FAILURE !! PROTOCOL ABORTED.`, '#ff0000');
            }
            
            scanState = 0;
            isBusy = false;
            showPrompt();
        }

        // --- OVERRIDE ---
        function runOverride(forcedDeactivation = false) {
            if (forcedDeactivation) {
                overrideEnabled = false;
                statusBar.classList.remove('override-active');
                overrideIndicator.style.display = 'none';
                writeOutput("\n>> LEVEL ALPHA OVERRIDE DEACTIVATED BY SECURITY TIMEOUT.", '#00ff41');
                isBusy = false;
                showPrompt();
                return;
            }

            if (overrideEnabled) {
                writeOutput("ERROR: LEVEL ALPHA OVERRIDE ALREADY ACTIVE. Run OVERRIDE DEACTIVATE.", '#ff0000');
                return;
            }

            writeOutput("\n!! EXECUTING LEVEL ALPHA OVERRIDE PROTOCOL !!", '#ff0000');
            isBusy = true;

            setTimeout(() => {
                overrideEnabled = true;
                statusBar.classList.add('override-active');
                overrideIndicator.style.display = 'inline';
                writeOutput(">> LEVEL ALPHA OVERRIDE ACTIVATED. SECURITY CHECK BYPASSED.", '#ffff00');
                writeOutput(">> WARNING: Security timeout initiated (5 minutes).", '#ff0000');
                
                // Set a timeout for automatic deactivation (5 minutes)
                securityTimeout = setTimeout(() => {
                    runOverride(true);
                }, 300000); // 300,000 milliseconds = 5 minutes

                isBusy = false;
                showPrompt();
            }, 1500);
        }

        // --- HUNT (The new/updated module) ---
        function runHunt(selection) {
            if (huntState === 0) {
                isBusy = true;
                writeOutput("\n--- INITIATING HIGH-LEVEL BEHAVIORAL SCAN ---", '#00ffff');
                writeOutput("!! System is analyzing global search configurations for known *Web Easter Eggs*...", '#ffff00');

                setTimeout(() => {
                    writeOutput("\n>> SCAN COMPLETE. 3 Universal Web Easter Eggs detected:", '#00ff41');
                    
                    BROWSER_EASTER_EGGS.forEach((egg) => {
                        writeOutput(`  [${egg.id}] ${egg.name} (Trigger: '${egg.trigger_cmd}')`, '#fff');
                    });

                    writeOutput("\nType the **NUMBER** for more info, or **SEND [number]** to trigger the effect now.", '#ffff00');
                    writeOutput("Type **LOGOUT** to exit HUNT mode.", '#ffff00');
                    huntState = 1;
                    isBusy = false;
                    showPrompt();
                }, 1500);
                
            } 
            else if (huntState === 1) {
                const index = parseInt(selection) - 1;

                if (isNaN(index) || index < 0 || index >= BROWSER_EASTER_EGGS.length) {
                    writeOutput("ERROR: Invalid selection. Please type a number from 1 to 3, or SEND [number] or LOGOUT.", '#ff0000');
                    return;
                }

                const egg = BROWSER_EASTER_EGGS[index];
                writeOutput(`\n--- EASTER EGG REPORT: ${egg.name.toUpperCase()} ---`, '#00ffff');
                writeOutput(`TYPE: Global Web Search Feature (Universal)`, '#fff');
                writeOutput(`TRIGGER COMMAND: ${egg.trigger_cmd}`, '#fff');
                writeOutput(`DESCRIPTION: ${egg.info}`, '#fff');
                writeOutput(`\nACTION OPTIONS:`, '#ffff00');
                writeOutput(`  > SEND ${egg.id}    - Execute the trigger command to see the effect on your screen.`, '#00ff41');
                writeOutput(`  > IMAGE ${egg.id}   - Open a direct image link for visual confirmation.`, '#00ff41');

                writeOutput(`\nType another NUMBER (1-3) or an ACTION (SEND/IMAGE), or **LOGOUT** to return to the main console.`, '#ffff00');
            }
        }
        
        function runSendImage(selection) {
            const index = parseInt(selection) - 1;

            if (isNaN(index) || index < 0 || index >= BROWSER_EASTER_EGGS.length) {
                writeOutput("ERROR: Invalid image selection. Please use IMAGE [1-3].", '#ff0000');
                return;
            }
            
            const egg = BROWSER_EASTER_EGGS[index];
            writeOutput(`\n>> OPENING VISUAL CONFIRMATION: ${egg.name.toUpperCase()}...`, '#ffff00');
            window.open(egg.image_url, '_blank');
        }

        function runSendCommand(selection) {
            const index = parseInt(selection) - 1;

            if (isNaN(index) || index < 0 || index >= BROWSER_EASTER_EGGS.length) {
                writeOutput("ERROR: Invalid SEND selection. Please use SEND [1-3].", '#ff0000');
                return;
            }
            
            const egg = BROWSER_EASTER_EGGS[index];
            
            writeOutput(`\n!! INITIATING WEB TRIGGER: ${egg.trigger_cmd.toUpperCase()} !!`, '#ff0000');
            writeOutput(">> Redirecting your primary browser window to Google Search...", '#ffff00');
            
            // This is the core action: open the search result in the current window to show the effect
            window.open(egg.action_url, '_self'); 
        }

        // =========================================================================
        // --- Main Command Processor ---
        // =========================================================================
        
        function processCommand(command) {
            const parts = command.trim().split(/\s+/);
            const cmd = parts[0].toUpperCase();
            const args = command.trim().substring(cmd.length).trim();

            if (isBusy && cmd !== 'LOGOUT' && cmd !== 'OVERRIDE' && cmd !== 'TRACE' && cmd !== 'STOP') {
                writeOutput("!! System Busy. Please wait for current sequence to finish.", '#ff0000');
                return;
            }
            
            // --- Special Exit/Stop Commands ---
            if (cmd === 'STOP' && args.toUpperCase() === 'SCAN' && scanActive) {
                writeOutput(`> ${command}`, '#ff00ff');
                endLieDetection(); 
                return;
            }
            
            if (cmd === 'LOGOUT') {
                writeOutput(`> ${command}`, '#ff00ff');
                if (huntState === 1) {
                    writeOutput("HUNT MODE TERMINATED. Returning to main console.", '#00ff41');
                    huntState = 0;
                    isBusy = false;
                    showPrompt();
                    return;
                }
                
                writeOutput("SESSION TERMINATED. Redirecting to source...", '#ff0000');
                if (scanActive) endLieDetection();
                if (securityTimeout) clearTimeout(securityTimeout);
                
                setTimeout(() => {
                    window.location.href = 'https://ethanunlocked690.github.io'; 
                }, 1000);
                return;
            }
            
            // --- Trace Command (Special Priority) ---
            if (cmd === 'TRACE') {
                 writeOutput(`> ${command}`, '#ff00ff');
                 runTrace(args);
                 return;
            }

            // --- HUNT MODE SPECIFIC COMMANDS ---
            if (huntState === 1) {
                if (!isNaN(parseInt(command.trim())) && command.trim().length < 3) {
                    // It's a number selection for more info
                    writeOutput(`> ${command}`, '#ff00ff');
                    runHunt(command.trim());
                    return;
                }
                if (cmd === 'SEND' && args.length > 0) {
                    writeOutput(`> ${command}`, '#ff00ff');
                    runSendCommand(args); // args should be the number
                    return;
                }
                if (cmd === 'IMAGE' && args.length > 0) {
                    writeOutput(`> ${command}`, '#ff00ff');
                    runSendImage(args); // args should be the number
                    return;
                }
            }
            // --- END HUNT MODE SPECIFIC COMMANDS ---

            // --- DECRYPT State-Specific Commands ---
            if (decryptState === 1.5) {
                // Security question answer
                handleSecurityAnswer(command);
                commandInput.value = '';
                return;
            }
            
            if (decryptState === 3) {
                // COMPARE or DECRYPT (while in COMPARE state)
                if (cmd === 'DECRYPT' || cmd === 'COMPARE') {
                    writeOutput(`> ${command}`, '#ff00ff');
                    runDecrypt(command);
                    return;
                }
                writeOutput("ERROR: Invalid command in DECRYPT menu. Use COMPARE [password] or LOGOUT.", '#ff0000');
                showPrompt();
                return;
            }

            if (decryptState === 1 && command.trim().includes('@')) {
                // Email input for DECRYPT
                 writeOutput(`> ${command}`, '#ff00ff');
                 runDecrypt(command);
                 commandInput.value = '';
                 return;
            }
            // --- End DECRYPT State-Specific Commands ---

            writeOutput(`> ${command}`, '#ff00ff'); 
            
            switch (cmd) {
                case 'HELP':
                    writeOutput("--- AVAILABLE COMMANDS (6 Core Features) ---", '#ffff00');
                    writeOutput("1. SEARCH [query] : Fetch public data (e.g., NASA, Eiffel).", '#00ff41');
                    writeOutput("2. DECRYPT        : Start email password extraction module (Requires Security Check).", '#00ff41');
                    writeOutput("3. SCAN           : Start bio-feedback analysis (Requires Password). Use STOP SCAN to end.", '#00ff41');
                    writeOutput("4. HUNT           : Scan for global web Easter Eggs. ðŸ‡", '#00ff41');
                    writeOutput("5. LOGOUT         : Terminate session.", '#00ff41');
                    writeOutput("6. OVERRIDE       : A powerful, unlisted command for system control.", '#ff00ff');
                    break;
                case 'SEARCH':
                    if (args.length > 2) {
                        runSearch(args);
                        return;
                    } else {
                        writeOutput("ERROR: SEARCH requires a query (e.g., SEARCH Eiffel Tower).", '#ff0000');
                    }
                    break;
                case 'DECRYPT':
                    if (decryptState !== 1) decryptState = 0; 
                    runDecrypt(args);
                    break;
                case 'SCAN':
                    scanState = 0; 
                    runScan();
                    break;
                case 'OVERRIDE':
                    runOverride();
                    break;
                case 'HUNT':
                    huntState = 0; 
                    runHunt(args);
                    break;
                default:
                    writeOutput(`ERROR: Command '${cmd}' not recognized. Try HELP.`, '#ff0000');
                    break;
            }
            showPrompt();
        }

        // =========================================================================
        // --- Music and Theme Initialization ---
        // =========================================================================

        function stopAllMusic() {
            mainMusic.pause();
            if (currentHolidayAudio) {
                currentHolidayAudio.pause();
                currentHolidayAudio.remove(); 
                currentHolidayAudio = null;
            }
        }

        function startMainMusic() {
            stopAllMusic();
            if (!bodyElement.classList.contains('holiday-theme-active')) {
                mainMusic.volume = 1.0;
                mainMusic.currentTime = 0;
                mainMusic.play().catch(error => {
                    console.log("Main music start attempted (Requires user gesture).");
                });
            }
        }

        function startHolidayMusic(theme) {
            stopAllMusic();
            
            const audio = document.createElement('audio');
            audio.id = 'holiday-music';
            audio.loop = true;
            audio.autoplay = true;
            audio.volume = 1.0; 
            audio.innerHTML = `<source src="${theme.music}" type="audio/mp3">`;
            
            holidayMusicContainer.innerHTML = '';
            holidayMusicContainer.appendChild(audio);
            currentHolidayAudio = audio; 
            
            audio.play().catch(error => {
                console.log(`Holiday music (${theme.name}) start attempted (Requires user gesture).`);
            });
        }
        
        function initializeHolidayTheme() {
            const today = new Date();
            const month = today.getMonth(); 
            const day = today.getDate(); 

            let activeTheme = HOLIDAY_THEMES[month];

            // Specific Australian/Floating date checks (ANZAC Day)
            if (month === 3 && day === 25) { 
                activeTheme = { name: "ANZAC Day", color: "#6c757d", music: "labor.mp3", css: "anzac-theme" };
            }
            
            if (activeTheme) {
                 // 1. Set the visual theme silently
                 bodyElement.className = bodyElement.className.split(' ').filter(c => !c.endsWith('-theme')).join(' ');
                 bodyElement.classList.add('holiday-theme-active'); 
                 bodyElement.classList.add(activeTheme.css); 
                 
                 return activeTheme; // Return the theme object
            }
            
            return null; // No holiday theme found
        }
        
        // --- Single Function to Start All Audio on First User Interaction ---
        function handleUserInteraction() {
            if (musicStarted) return;
            
            musicStarted = true;
            
            const activeTheme = initializeHolidayTheme();
            
            if (activeTheme) {
                startHolidayMusic(activeTheme);
            } else {
                startMainMusic();
            }

            // Remove all event listeners after the audio is initiated to prevent re-triggering
            document.removeEventListener('click', handleUserInteraction);
            document.removeEventListener('keypress', handleUserInteraction);
            document.removeEventListener('mousedown', handleUserInteraction);
        }

        // =========================================================================
        // --- Event Listeners ---
        // =========================================================================
        
        document.addEventListener('keypress', function(e) {
            handleUserInteraction(); // Check for music start
            
            if (scanState === 2) {
                // TRACE mode: handles input via the hidden passwordInput field
                if (e.key === 'Enter') {
                    e.preventDefault(); 
                    handleTraceInput(passwordInput.value);
                    passwordInput.value = '';
                }
                return;
            }

            if (e.key === 'Enter' && commandInput.style.display !== 'none') {
                processCommand(commandInput.value);
                commandInput.value = '';
            }
        });
        
        // Listen for ANY mouse click or keypress to trigger the silent "autoplay"
        document.addEventListener('click', handleUserInteraction); 
        document.addEventListener('mousedown', handleUserInteraction);

        passwordInput.addEventListener('keydown', function(e) {
            clearTimeout(passwordTimeout);
            
            if (scanState === 2) {
                // TRACE challenge mode, standard input handling
                return;
            }

            if (e.key === 'Enter') {
                e.preventDefault(); 
                handleScanPassword(actualPasswordAttempt);
                return;
            }
            
            // Custom password masking logic for SCAN module (scanState === 1)
            if (e.key === 'Backspace' || e.key === 'Delete') {
                actualPasswordAttempt = actualPasswordAttempt.slice(0, -1);
                currentPasswordDisplay = currentPasswordDisplay.slice(0, -1);
                passwordInput.value = currentPasswordDisplay;
                e.preventDefault(); 
                return;
            }

            if (e.key.length === 1 && !e.ctrlKey && !e.altKey && !e.metaKey) {
                e.preventDefault(); 
                
                const char = e.key;
                actualPasswordAttempt += char;
                
                // Add the character to the displayed string
                currentPasswordDisplay += char;
                passwordInput.value = currentPasswordDisplay;

                // Set a timeout to replace the last character with '*'
                passwordTimeout = setTimeout(() => {
                    if (currentPasswordDisplay.length > 0) {
                        // Only mask if it hasn't been masked yet
                        if (currentPasswordDisplay.slice(-1) !== '*') {
                            currentPasswordDisplay = currentPasswordDisplay.slice(0, -1) + '*';
                            passwordInput.value = currentPasswordDisplay;
                        }
                    }
                }, 2000); 
            }
        });


        // Initialize on load
        window.onload = function() {
            // Apply the appropriate theme visuals immediately
            initializeHolidayTheme(); 
            commandInput.focus();
        };
    </script>
</body>
</html>
