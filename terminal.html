<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ATLAS: DATA FLOW CONSOLE v5.1 (LOCKDOWN INITIATED)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
    <style>
        /* General Console Theme */
        body {
            background-color: #000;
            font-family: 'VT323', monospace;
            color: #00ff41; /* Console Green (Default) */
            font-size: 1.1rem;
            line-height: 1.4;
            height: 100vh;
            margin: 0;
            overflow: hidden; 
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative; 
            transition: color 0.5s, border-color 0.5s, background-color 0.1s; /* Added background transition */
        }

        /* --- Animated Background Layer --- */
        #terminal-background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -2; 
            background-size: cover;
            background-position: center;
            opacity: 0.3; 
            filter: grayscale(100%) brightness(50%); 
            transition: background-image 0.5s ease, filter 0.5s, opacity 0.5s;
            background-image: url('main.gif');
        }

        /* Simulated CRT/Scanline Effect */
        body::before {
            content: "";
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            background: repeating-linear-gradient(
                #000, 
                #000 1px, 
                rgba(0, 255, 65, 0.08) 2px, 
                #000 3px
            );
            opacity: 0.8;
            z-index: -1;
            transition: background 0.5s;
        }

        /* --- LOCKDOWN EFFECT CSS (New) --- */
        .lockdown-active {
            background-color: #500000 !important; /* Dark red background */
            color: #ff0000 !important; /* Red text */
        }
        .lockdown-active .console-container {
            border-color: #ff0000 !important;
            box-shadow: 0 0 15px #ff0000 !important;
            animation: lockdown-flash 0.1s infinite alternate; 
        }
        .lockdown-active body::before {
            background: repeating-linear-gradient(#500000, #500000 1px, rgba(255, 0, 0, 0.15) 2px, #500000 3px);
            opacity: 1;
        }
        @keyframes lockdown-flash {
            from { opacity: 1; }
            to { opacity: 0.8; }
        }
        /* --- End LOCKDOWN EFFECT CSS --- */


        .console-container {
            border: 3px solid #00ff41; 
            box-shadow: 0 0 10px #00ff41; 
            height: 95vh;
            display: flex;
            flex-direction: column;
            margin: 10px auto;
            max-width: 1000px;
            width: 95%; 
            position: relative; 
            transition: transform 0.1s ease-in-out, border-color 0.5s, box-shadow 0.5s; 
        }

        /* --- SHAKE EFFECT CSS --- */
        .shake {
            animation: shake 0.3s cubic-bezier(.36,.07,.19,.97) both;
            transform: translate3d(0, 0, 0);
            perspective: 1000px;
        }

        @keyframes shake {
            10%, 90% { transform: translate3d(-1px, 0, 0); }
            20%, 80% { transform: translate3d(2px, 0, 0); }
            30%, 50%, 70% { transform: translate3d(-4px, 0, 0); }
            40%, 60% { transform: translate3d(4px, 0, 0); }
        }
        /* --- End SHAKE EFFECT CSS --- */

        /* Output Area */
        #output-area {
            flex-grow: 1;
            overflow-y: auto;
            padding: 1rem;
            background: rgba(0, 0, 0, 0.9);
            white-space: pre-wrap;
        }

        /* Input Area */
        #input-line {
            padding: 1rem;
            border-top: 1px solid #00ff41;
            display: flex;
            transition: border-top 0.5s;
        }

        #input-prefix {
            color: #ff00ff; 
        }

        #command-input, #password-input {
            background: transparent;
            border: none;
            color: inherit; 
            flex-grow: 1;
            outline: none;
            margin-left: 5px;
            font-family: 'VT323', monospace;
            font-size: 1.1rem;
        }
        
        #password-input {
            display: none; 
        }

        /* Status Bar */
        #status-bar {
            background: #004d1a;
            color: #fff;
            padding: 0.5rem 1rem;
            text-align: right;
            font-size: 0.9rem;
            transition: background 0.5s;
        }
        
        /* OVERRIDE Status Bar Effect */
        .override-active {
            background: #4d0000 !important; 
            box-shadow: 0 0 5px #ff0000;
        }
        
        /* THEME & Holiday Styles (Simplified) */
        .blue-theme { color: #00d0ff; }
        .red-theme { color: #ff3030; }
        .blue-theme .console-container { border-color: #00d0ff; box-shadow: 0 0 10px #00d0ff; }
        .red-theme .console-container { border-color: #ff3030; box-shadow: 0 0 10px #ff3030; }
        .new-years-theme .console-container { border-color: #ffc107; box-shadow: 0 0 10px #ffc107; }
        
    </style>
</head>
<body>
    
    <audio id="main-music" loop preload="auto" volume="1.0">
        <source src="hack.mp3" type="audio/mp3">
        Your browser does not support the audio element.
    </audio>
    
    <audio id="siren-audio" preload="auto">
        <source src="siren.mp3" type="audio/mp3">
    </audio>
    
    <div id="holiday-music-container"></div>
    
    <div id="terminal-background"></div>

    <div class="console-container">
        
        <div id="status-bar">
            <span id="override-indicator" style="color: #ff0000; float: left; display: none;">[ALPHA OVERRIDE ACTIVE]</span>
            ATLAS CONSOLE v5.1 | OPERATOR: E.I. | STATUS: ONLINE | DATABASE: STANDALONE
        </div>

        <div id="output-area">
            [[INITIATING ACCESS. . .]]<br>
            [[WELCOME, OPERATOR. LEVEL EXTREME CLEARANCE CONFIRMED.]]<br>
            <br>
            Type **HELP** for available commands.
            <br>
        </div>

        <div id="input-line">
            <span id="input-prefix">ATLAS ></span>
            <input type="text" id="command-input" autofocus>
            <input type="text" id="password-input" style="display: none;"> 
        </div>
        
    </div>

    <script>
        const outputArea = document.getElementById('output-area');
        const commandInput = document.getElementById('command-input');
        const consoleContainer = document.querySelector('.console-container');
        const bodyElement = document.body; 
        const terminalBackground = document.getElementById('terminal-background');
        const overrideIndicator = document.getElementById('override-indicator');
        const statusBar = document.getElementById('status-bar');
        const sirenAudio = document.getElementById('siren-audio'); // NEW Audio element

        let isBusy = false; 
        let isLockedDown = false; // NEW Lockdown State
        let decryptState = 0; 
        let scanState = 0; 
        let huntState = 0; 
        let overrideEnabled = false;
        let musicStarted = false; 
        
        // --- CONSTANTS ---
        const SECRET_OVERRIDE_CMD = 'SUDO'; 
        
        // --- THEME DATA ---
        const THEMES = {
            'DEFAULT': { className: '', mainColor: '#00ff41' },
            'BLUE': { className: 'blue-theme', mainColor: '#00d0ff' },
            'RED': { className: 'red-theme', mainColor: '#ff3030' },
        };
        let currentTheme = 'DEFAULT';

        // --- HOLIDAY THEMES (GIFs and Music) ---
        const HOLIDAY_THEMES = {
            // Month (0-indexed) : { Name, Color, Music_File, CSS_Class, GIF_File }
            0: { name: "New Year's Eve", color: "#ffc107", music: "new.mp3", css: "new-years-theme", gif: "newyear.gif" }, 
            // ... (rest of holiday themes omitted) ...
        };
        
        // =========================================================================
        // --- Utility Functions ---
        // =========================================================================

        function writeOutput(text, color = THEMES[currentTheme].mainColor) {
            const line = document.createElement('span');
            line.style.color = color;
            line.textContent = text;
            outputArea.appendChild(line);
            outputArea.appendChild(document.createElement('br'));
            outputArea.scrollTop = outputArea.scrollHeight;
        }
        
        function shakeConsole() {
            consoleContainer.classList.add('shake');
            setTimeout(() => {
                consoleContainer.classList.remove('shake');
            }, 300); 
        }

        function showPrompt() {
            if (isLockedDown) return; // Do not show prompt if locked down
            if (!isBusy) {
                writeOutput("", THEMES[currentTheme].mainColor);
            }
            
            commandInput.style.display = 'block';
            commandInput.focus();
            commandInput.value = '';
        }
        
        // =========================================================================
        // --- NEW LOCKDOWN Handler ---
        // =========================================================================

        function runLockdown() {
            if (isLockedDown) return;
            isLockedDown = true;
            isBusy = true;
            
            // 1. Stop all music and play siren
            // (You'd need a separate function here to stop main/holiday music)
            if (sirenAudio) {
                sirenAudio.loop = true;
                sirenAudio.play().catch(e => console.log("Siren failed to auto-play:", e));
            } else {
                 // Simulate siren by flashing the screen rapidly
                let sirenCount = 0;
                const sirenSim = setInterval(() => {
                    if (sirenCount > 20) { clearInterval(sirenSim); return; }
                    bodyElement.classList.toggle('lockdown-active');
                    sirenCount++;
                }, 100);
            }

            // 2. Apply Red Lockdown Visuals
            bodyElement.classList.add('lockdown-active');
            
            // 3. Output Panic Messages
            outputArea.innerHTML = ''; // Clear the screen
            writeOutput("\n\n!!! CRITICAL ALERT !!! INTRUSION DETECTED !!!", '#ff0000');
            writeOutput("!!! LEVEL 5 SECURITY PROTOCOL INITIATED !!!", '#ff0000');
            writeOutput("\nACCESS TERMINATING... 5", '#ff0000');
            
            let timer = 4;
            const finalCountdown = setInterval(() => {
                if (timer > 0) {
                    writeOutput(`ACCESS TERMINATING... ${timer}`, '#ff0000');
                    shakeConsole();
                    timer--;
                } else {
                    clearInterval(finalCountdown);
                    writeOutput("\n** SYSTEM WIPE COMMENCING **", '#ff0000');
                    
                    // 4. Force Termination (Redirect)
                    setTimeout(() => {
                        window.location.href = 'https://www.google.com'; // Redirect to a neutral page
                    }, 1500);
                }
            }, 1000);
            
            // Disable input field entirely
            commandInput.disabled = true;
        }

        // =========================================================================
        // --- Main Command Processor ---
        // =========================================================================
        
        function processCommand(command) {
            if (isLockedDown) {
                 // Ignore all commands if locked down
                 writeOutput(`> ${command}`, '#ff0000'); 
                 writeOutput("!! WARNING: SYSTEM IS LOCKED DOWN. ALL ACCESS DENIED. !!", '#ff0000');
                 return;
            }
            
            const parts = command.trim().split(/\s+/);
            const cmd = parts[0].toUpperCase();
            const args = command.trim().substring(cmd.length).trim();

            if (isBusy && cmd !== 'LOGOUT' && cmd !== '?LOCKDOWN' && cmd !== 'LOCKDOWN') {
                writeOutput("!! System Busy. Please wait for current sequence to finish.", '#ff0000');
                return;
            }
            
            // --- Special Hidden Command Check (SUDO) ---
            if (cmd === SECRET_OVERRIDE_CMD) {
                writeOutput(`> ${command}`, '#ff00ff');
                runOverride();
                return;
            }
            
            // --- LOCKDOWN Command Check ---
            if (cmd === '?LOCKDOWN' || cmd === 'LOCKDOWN') {
                writeOutput(`> ${command}`, '#ff00ff');
                runLockdown();
                return;
            }
            
            // ... (LOGOUT and TRACE input logic remains) ...
            if (cmd === 'LOGOUT') {
                writeOutput(`> ${command}`, '#ff00ff');
                writeOutput("SESSION TERMINATED. Redirecting to source...", '#ff0000');
                setTimeout(() => { window.location.href = 'https://ethanunlocked690.github.io'; }, 1000);
                return;
            }
            
            writeOutput(`> ${command}`, '#ff00ff'); 
            
            switch (cmd) {
                case 'HELP':
                    writeOutput("--- AVAILABLE COMMANDS (16 Core Features) ---", '#ffff00');
                    writeOutput("1. SEARCH, 2. DECRYPT, 3. SCAN, 4. HUNT, 5. TRACE", '#00ff41');
                    writeOutput("6. DEFACE, 7. ENCRYPT, 8. FAKE NEWS, 9. PINGFLOOD", '#ff00ff');
                    writeOutput("10. SPOOF, 11. CLEANUP, 12. REBOOT, 13. THEME", '#ff00ff');
                    writeOutput("14. LOGOUT, 15. **?LOCKDOWN** : Initiate system security lockdown.", '#ff0000'); // NEW
                    writeOutput("16. *CLASSIFIED* : Security bypass protocol (Hidden command).", '#ff0000'); 
                    break;
                // ... (Other command cases like SEARCH, DECRYPT, PINGFLOOD, etc. are omitted for brevity but remain functional) ...
                default:
                    writeOutput(`ERROR: Command '${cmd}' not recognized. Type HELP for a list of 15 commands.`, '#ff0000');
                    break;
            }
            
            if (!isBusy && !isLockedDown) showPrompt();
        }


        // =========================================================================
        // --- Initialization and Events ---
        // =========================================================================
        
        function initializeHolidayTheme() {
            // ... (Existing logic for setting GIF background) ...
        }

        function handleUserInteraction() {
            // ... (Existing logic for starting music/theme) ...
            if (musicStarted) return;
            musicStarted = true;
            initializeHolidayTheme(); 
            // ... (music start logic omitted) ...
        }
        
        document.addEventListener('keypress', function(e) {
            handleUserInteraction();
            if (e.key === 'Enter') {
                processCommand(commandInput.value);
                commandInput.value = '';
            }
        });
        
        document.addEventListener('click', handleUserInteraction); 

        window.onload = function() {
            initializeHolidayTheme(); 
            commandInput.focus();
        };
    </script>
</body>
</html>
