<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Logo Designer Studio</title>
    <style>
        /* Logo Designer Specific Styles */
        body {
            display: flex;
            margin: 0;
            background-color: #1c1c1c;
            color: #fff;
            font-family: Arial, sans-serif;
            min-height: 100vh;
        }
        #logo-tools {
            width: 200px;
            padding: 15px;
            background: #2a2a2a;
            box-shadow: 2px 0 5px rgba(0, 0, 0, 0.5);
            flex-shrink: 0;
        }
        #designer-viewport {
            flex-grow: 1;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        #logo-canvas-container {
            width: 500px;
            height: 500px;
            border: 5px dashed #555;
            position: relative;
            background-color: #ffffff; 
        }
        #logo-svg {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            z-index: 2;
        }
        .logo-text {
            font-size: 80px;
            font-family: 'Montserrat', sans-serif;
            fill: #ff0077;
            cursor: grab;
            user-select: none;
            text-shadow: 0 0 5px rgba(0, 0, 0, 0.5);
        }
    </style>
</head>
<body>

    <aside id="logo-tools">
        <h3>Logo Tools</h3>
        <button data-tool="text">Add Text (Title)</button>
        <button data-tool="shape">Add Shape (Star)</button>

        <h4 style="margin-top: 20px;">Text Properties</h4>
        <input type="color" id="text-color" value="#ff0077"><label for="text-color">Color</label><br>
        <input type="range" id="text-size" min="20" max="150" value="80" style="width: 90%;"><label>Size</label>
        
        <button id="save-logo-btn" style="background-color: #00bfff; margin-top: 20px;">
            **Save & Return to Club**
        </button>
    </aside>

    <main id="designer-viewport">
        <div id="logo-canvas-container">
            <svg id="logo-svg" viewBox="0 0 500 500"></svg>
        </div>
    </main>

    <script>
        // --- LOGO DESIGNER JS LOGIC ---
        const logoSVG = document.getElementById('logo-svg');
        const saveBtn = document.getElementById('save-logo-btn');
        const logoTools = document.getElementById('logo-tools');
        
        let logoConfig = []; 
        let selectedElement = null;
        let isDragging = false;
        let offset = { x: 0, y: 0 };
        
        // --- A. Core Utilities ---
        function getSvgPoint(e) {
            const pt = logoSVG.createSVGPoint();
            pt.x = e.clientX;
            pt.y = e.clientY;
            return pt.matrixTransform(logoSVG.getScreenCTM().inverse());
        }

        // --- B. Logo Rendering ---
        function renderLogo() {
            logoSVG.innerHTML = ''; 
            logoConfig.forEach(cfg => {
                if (cfg.type === 'text') {
                    const textEl = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                    textEl.setAttribute('class', 'logo-element logo-text');
                    textEl.setAttribute('data-id', cfg.id);
                    textEl.setAttribute('x', cfg.x);
                    textEl.setAttribute('y', cfg.y);
                    textEl.setAttribute('font-size', cfg.size);
                    textEl.setAttribute('fill', cfg.color);
                    textEl.textContent = cfg.content;
                    logoSVG.appendChild(textEl);
                }
            });
        }

        // --- C. Interactivity (Drag and Drop) ---

        logoSVG.addEventListener('mousedown', (e) => {
            const target = e.target;
            const elementTarget = target.closest('.logo-element');
            
            if (elementTarget) {
                selectedElement = elementTarget;
                isDragging = true;
                
                const svgPos = getSvgPoint(e);
                const currentX = parseFloat(selectedElement.getAttribute('x') || 0);
                const currentY = parseFloat(selectedElement.getAttribute('y') || 0);
                
                offset.x = svgPos.x - currentX;
                offset.y = svgPos.y - currentY;
                selectedElement.style.cursor = 'grabbing';
            } else {
                selectedElement = null;
            }
        });

        window.addEventListener('mousemove', (e) => {
            if (!isDragging || !selectedElement) return;

            const svgPos = getSvgPoint(e);
            const newX = svgPos.x - offset.x;
            const newY = svgPos.y - offset.y;
            
            selectedElement.setAttribute('x', newX);
            selectedElement.setAttribute('y', newY);
            
            const id = selectedElement.getAttribute('data-id');
            const cfg = logoConfig.find(c => c.id === id);
            if (cfg) {
                cfg.x = newX;
                cfg.y = newY;
            }
        });

        window.addEventListener('mouseup', () => {
            isDragging = false;
            if (selectedElement) {
                selectedElement.style.cursor = 'grab';
            }
        });

        // --- D. Toolbar Actions ---

        logoTools.addEventListener('click', (e) => {
            const tool = e.target.getAttribute('data-tool');
            if (tool === 'text') {
                const newTextConfig = {
                    id: `text-${Date.now()}`,
                    type: 'text',
                    content: 'CLUB NAME',
                    x: 100,
                    y: 250,
                    size: 80,
                    color: document.getElementById('text-color').value
                };
                logoConfig.push(newTextConfig);
                renderLogo();
            }
        });

        // Handle color/size changes
        document.getElementById('text-color').addEventListener('input', (e) => {
            if (selectedElement && selectedElement.classList.contains('logo-text')) {
                selectedElement.setAttribute('fill', e.target.value);
                const id = selectedElement.getAttribute('data-id');
                const cfg = logoConfig.find(c => c.id === id);
                if (cfg) cfg.color = e.target.value;
            }
        });
        document.getElementById('text-size').addEventListener('input', (e) => {
            if (selectedElement && selectedElement.classList.contains('logo-text')) {
                selectedElement.setAttribute('font-size', e.target.value);
                const id = selectedElement.getAttribute('data-id');
                const cfg = logoConfig.find(c => c.id === id);
                if (cfg) cfg.size = parseFloat(e.target.value);
            }
        });
        
        // --- E. Save and Communication ---

        saveBtn.addEventListener('click', () => {
            // Serialize SVG to XML/Text
            const svgData = (new XMLSerializer()).serializeToString(logoSVG);
            // Base64 encode the SVG string to create a Data URL (image source)
            const svgDataUrl = 'data:image/svg+xml;base64,' + btoa(unescape(encodeURIComponent(svgData)));

            // Communicate back to the main window using the opener object
            if (window.opener && window.opener.receiveLogoData) {
                window.opener.receiveLogoData(svgDataUrl, logoConfig);
                window.close(); // Close the designer window
            } else {
                alert("Cannot communicate with main club designer window. Please save this file as 'logo-designer.html' and ensure it's in the same directory as the main club designer file.");
            }
        });
        
        // --- F. Initialization ---
        // Listen for messages from the opener window to load existing data
        window.addEventListener('message', (event) => {
            if (event.data.type === 'LOAD_CONFIG' && event.data.config) {
                logoConfig = event.data.config;
                renderLogo();
            }
        });
        
        document.addEventListener('DOMContentLoaded', renderLogo);
    </script>
</body>
</html>
