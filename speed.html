<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Speedometer</title>
    <style>
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            background-color: #1a237e; /* Deep blue background */
            font-family: Arial, sans-serif;
            flex-direction: column;
            color: white;
        }

        .status-message {
            margin-bottom: 20px;
            font-size: 1.2em;
            color: #ffeb3b; /* Yellow for visibility */
        }

        .speedometer-container {
            width: 300px;
            height: 150px;
            position: relative;
            overflow: hidden;
            border-radius: 150px 150px 0 0;
            background-color: #2c387e;
            box-shadow: 0 4px 25px rgba(0, 0, 0, 0.4);
        }

        .gauge {
            width: 300px;
            height: 300px;
            border-radius: 50%;
            border: 20px solid rgba(255, 255, 255, 0.15);
            border-bottom: 20px solid transparent;
            border-right: 20px solid transparent;
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translate(-50%, -50%) rotate(135deg);
            box-sizing: border-box;
        }

        .needle-pivot {
            width: 16px;
            height: 16px;
            background-color: #e53935; /* Red center */
            border: 3px solid #f9f9f9;
            border-radius: 50%;
            position: absolute;
            bottom: -8px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 10;
        }

        .needle {
            width: 3px;
            height: 140px;
            background-color: #e53935;
            position: absolute;
            bottom: 0;
            left: 50%;
            transform-origin: bottom center;
            transform: translateX(-50%) rotate(135deg); /* Initial position (0 speed) */
            transition: transform 0.2s ease-out; /* Smooth but fast movement */
            z-index: 9;
        }

        .speed-display {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            text-align: center;
            font-size: 3.5em;
            font-weight: bold;
            color: #00e676; /* Bright green display */
        }
        
        .unit {
            font-size: 0.3em;
            font-weight: normal;
            display: block;
            color: #b3e5fc;
        }
    </style>
</head>
<body>

    <div id="status" class="status-message">Awaiting location permission...</div>

    <div class="speedometer-container">
        <div class="gauge"></div>
        <div class="needle"></div>
        <div class="needle-pivot"></div>
        <div id="speedDisplay" class="speed-display">0<span class="unit">KM/H</span></div>
    </div>

    <script>
        // --- Configuration & Elements ---
        const needle = document.querySelector('.needle');
        const speedDisplay = document.getElementById('speedDisplay');
        const statusMessage = document.getElementById('status');

        const MAX_SPEED_KMH = 150; // Max speed for the gauge display (e.g., 150 KM/H)
        const MIN_DEGREE = 135; // Start rotation of the needle
        const MAX_DEGREE = 405; // End rotation of the needle (135 + 270)

        // Conversion factor from m/s (GPS default) to KM/H
        const MS_TO_KMH = 3.6; 

        // --- Helper Function ---
        /**
         * Maps a value from one range to a rotation degree.
         */
        function mapValue(value, min1, max1, min2, max2) {
            return min2 + (max2 - min2) * (Math.max(0, Math.min(1, (value - min1) / (max1 - min1))));
        }

        /**
         * Updates the speedometer display based on the raw speed in m/s.
         * @param {number} speedMS - The speed from the Geolocation API in meters/second.
         */
        function updateSpeedometer(speedMS) {
            // Convert m/s to KM/H
            const speedKMH = speedMS * MS_TO_KMH;
            
            // 1. Calculate the rotation degree for the needle
            const degree = mapValue(speedKMH, 0, MAX_SPEED_KMH, MIN_DEGREE, MAX_DEGREE);
            
            // Apply the rotation to the needle element
            needle.style.transform = `translateX(-50%) rotate(${degree}deg)`;

            // 2. Update the digital speed display (rounded)
            const displaySpeed = Math.round(speedKMH);
            speedDisplay.innerHTML = `${displaySpeed}<span class="unit">KM/H</span>`;
            
            // 3. Update status
            statusMessage.textContent = `Accuracy: ${Math.round(position.coords.accuracy)}m`;
        }

        // --- Geolocation Handlers ---

        function success(position) {
            // position.coords.speed is the key property, gives speed in m/s
            const speedMS = position.coords.speed;

            if (speedMS !== null && speedMS !== undefined) {
                // If the device can provide speed directly
                updateSpeedometer(speedMS);
            } else {
                // If speed is null, the device/browser cannot measure it (e.g., in a desktop browser)
                statusMessage.textContent = "Speed unavailable. Ensure GPS is active and you are moving.";
                updateSpeedometer(0); // Reset needle to 0
            }
        }

        function error(err) {
            let msg = '';
            switch(err.code) {
                case err.PERMISSION_DENIED:
                    msg = "Permission denied. Please allow location access to use the speedometer.";
                    break;
                case err.POSITION_UNAVAILABLE:
                    msg = "Location unavailable. Check device settings and try again.";
                    break;
                case err.TIMEOUT:
                    msg = "Location request timed out.";
                    break;
                default:
                    msg = `An unknown error occurred: ${err.message}`;
            }
            statusMessage.textContent = msg;
            updateSpeedometer(0); // Reset needle to 0
        }

        // --- Initialization ---

        if ("geolocation" in navigator) {
            statusMessage.textContent = "Location services available. Requesting position...";

            // Start watching position changes with high accuracy
            navigator.geolocation.watchPosition(
                success, 
                error, 
                {
                    enableHighAccuracy: true,
                    maximumAge: 0, // Request fresh data every time
                    timeout: 5000 // Stop trying after 5 seconds
                }
            );
        } else {
            statusMessage.textContent = "Geolocation is NOT supported by your browser.";
            updateSpeedometer(0); 
        }

    </script>
</body>
</html>
