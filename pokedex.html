<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pokédex - The Ultimate Version</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* General Body Styles */
        body {
            font-family: 'Roboto Mono', monospace;
            background-color: #f0f0f0;
            color: #333;
            margin: 0;
            padding: 20px;
            text-align: center;
        }

        h1 {
            color: #e4000f;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        #loadingMessage {
            font-size: 1.2rem;
            color: #555;
        }

        /* Navigation Bar */
        .nav-container {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            margin-bottom: 20px;
            gap: 10px;
        }

        .nav-button {
            background-color: #333;
            color: #fff;
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            font-family: 'Roboto Mono', monospace;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .nav-button:hover,
        .nav-button.active {
            background-color: #e4000f;
        }

        /* Search Bar */
        .search-container {
            margin-bottom: 20px;
        }

        #searchInput {
            width: 80%;
            max-width: 400px;
            padding: 10px 15px;
            border: 2px solid #ccc;
            border-radius: 25px;
            font-size: 16px;
            font-family: 'Roboto Mono', monospace;
            outline: none;
            transition: border-color 0.3s;
        }

        #searchInput:focus {
            border-color: #e4000f;
        }

        /* Pokédex Container (Grid) */
        .pokedex-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }

        /* Pokémon Card */
        .pokemon-card {
            background-color: #fff;
            border-radius: 15px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            padding: 20px;
            text-align: center;
            transition: transform 0.2s, box-shadow 0.2s;
            cursor: pointer;
        }

        .pokemon-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 16px rgba(0,0,0,0.2);
        }

        .pokemon-card .pokemon-id {
            font-size: 14px;
            color: #888;
            font-weight: bold;
        }

        .pokemon-card img {
            width: 150px;
            height: 150px;
            margin: 10px auto;
            display: block;
            image-rendering: pixelated;
        }

        .pokemon-card .pokemon-name {
            margin: 15px 0 10px;
            font-size: 22px;
            font-weight: bold;
            text-transform: capitalize;
        }

        /* Types Container */
        .pokemon-types {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 10px;
        }

        .type {
            padding: 5px 15px;
            border-radius: 15px;
            color: white;
            font-size: 14px;
            text-transform: uppercase;
            font-weight: bold;
        }

        /* Pokémon Type Colors */
        .type.normal { background-color: #A8A77A; }
        .type.fire { background-color: #EE8130; }
        .type.water { background-color: #6390F0; }
        .type.electric { background-color: #F7D02C; }
        .type.grass { background-color: #7AC74C; }
        .type.ice { background-color: #96D9D6; }
        .type.fighting { background-color: #C22E28; }
        .type.poison { background-color: #A33EA1; }
        .type.ground { background-color: #E2BF65; }
        .type.flying { background-color: #A98FF3; }
        .type.psychic { background-color: #F95587; }
        .type.bug { background-color: #A6B91A; }
        .type.rock { background-color: #B6A136; }
        .type.ghost { background-color: #735797; }
        .type.dragon { background-color: #6F35FC; }
        .type.dark { background-color: #705746; }
        .type.steel { background-color: #B7B7CE; }
        .type.fairy { background-color: #D685AD; }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.4);
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background-color: #fff;
            margin: 10% auto;
            padding: 30px;
            border: 1px solid #888;
            width: 80%;
            max-width: 600px;
            border-radius: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            position: relative;
            animation-name: animatetop;
            animation-duration: 0.4s;
            text-align: left;
        }

        @keyframes animatetop {
            from {top: -300px; opacity: 0}
            to {top: 0; opacity: 1}
        }

        .close-button {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .close-button:hover,
        .close-button:focus {
            color: black;
            text-decoration: none;
        }

        .modal-info h2 {
            text-align: center;
            text-transform: capitalize;
            font-size: 2.5rem;
            margin-top: 0;
        }

        .modal-info .modal-id {
            font-size: 1.5rem;
            color: #888;
            text-align: center;
        }

        .modal-info .modal-image {
            display: block;
            margin: 0 auto 20px;
            width: 200px;
            height: 200px;
            image-rendering: pixelated; 
        }

        .modal-info .modal-types {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
        }

        .modal-info .details p {
            margin: 5px 0;
        }
        
        .modal-info .description {
            margin-top: 20px;
            font-style: italic;
            text-align: justify;
        }

        .modal-info .stats-list {
            list-style-type: none;
            padding: 0;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .modal-info .stats-list li {
            background-color: #f5f5f5;
            padding: 10px;
            border-radius: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-info .stats-list span:first-child {
            font-weight: bold;
            text-transform: uppercase;
        }
    </style>
</head>
<body>

    <h1>Pokédex</h1>

    <div class="nav-container">
        <button class="nav-button active" data-category="all">All</button>
        <button class="nav-button" data-category="kanto">Kanto</button>
        <button class="nav-button" data-category="johto">Johto</button>
        <button class="nav-button" data-category="hoenn">Hoenn</button>
        <button class="nav-button" data-category="sinnoh">Sinnoh</button>
        <button class="nav-button" data-category="unova">Unova</button>
        <button class="nav-button" data-category="kalos">Kalos</button>
        <button class="nav-button" data-category="alola">Alola</button>
        <button class="nav-button" data-category="galar">Galar</button>
        <button class="nav-button" data-category="paldea">Paldea</button>
        <button class="nav-button" data-category="hisui">Hisui</button>
        <button class="nav-button" data-category="mega">Mega</button>
        <button class="nav-button" data-category="shiny">Shiny</button>
        <button class="nav-button" data-category="legendary">Legendary</button>
        <button class="nav-button" data-category="mythical">Mythical</button>
        <button class="nav-button" data-category="gmax">G-Max</button>
    </div>

    <div class="search-container">
        <input type="text" id="searchInput" placeholder="Search for a Pokémon...">
    </div>

    <p id="loadingMessage">Loading Pokédex...</p>

    <div id="pokedex-container" class="pokedex-container">
        </div>

    <div id="pokemonModal" class="modal">
        <div class="modal-content">
            <span class="close-button">&times;</span>
            <div id="modal-body">
                </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const pokedexContainer = document.getElementById('pokedex-container');
            const searchInput = document.getElementById('searchInput');
            const loadingMessage = document.getElementById('loadingMessage');
            const pokemonModal = document.getElementById('pokemonModal');
            const modalBody = document.getElementById('modal-body');
            const closeModal = document.querySelector('.close-button');
            const navButtons = document.querySelectorAll('.nav-button');

            let allPokemon = [];
            let allSpeciesData = [];
            const cachedSpeciesData = {};

            const gmaxPokemonList = [
                "charizard-gmax", "butterfree-gmax", "pikachu-gmax", "meowth-gmax", "machamp-gmax",
                "gengar-gmax", "kingler-gmax", "lapras-gmax", "eevee-gmax", "snorlax-gmax",
                "garbodor-gmax", "melmetal-gmax", "corviknight-gmax", "orbeetle-gmax", "drednaw-gmax",
                "coalossal-gmax", "flapple-gmax", "appletun-gmax", "sandaconda-gmax", "toxtricity-amped-gmax",
                "centiskorch-gmax", "hatterene-gmax", "grimmsnarl-gmax", "alcremie-gmax", "copperajah-gmax",
                "duraludon-gmax", "venusaur-gmax", "blastoise-gmax", "rillaboom-gmax", "cinderace-gmax",
                "inteleon-gmax", "urshifu-single-strike-gmax", "urshifu-rapid-strike-gmax"
            ];
            
            const regionalGenerations = {
                'kanto': 'generation-i',
                'johto': 'generation-ii',
                'hoenn': 'generation-iii',
                'sinnoh': 'generation-iv',
                'unova': 'generation-v',
                'kalos': 'generation-vi',
                'alola': 'generation-vii',
                'galar': 'generation-viii',
                'paldea': 'generation-ix',
                'hisui': 'generation-viii'
            };

            const getSpeciesData = async (pokemonId) => {
                if (cachedSpeciesData[pokemonId]) {
                    return cachedSpeciesData[pokemonId];
                }
                try {
                    const url = `https://pokeapi.co/api/v2/pokemon-species/${pokemonId}`;
                    const response = await fetch(url);
                    const speciesData = await response.json();
                    cachedSpeciesData[pokemonId] = speciesData;
                    return speciesData;
                } catch (error) {
                    console.error(`Failed to fetch species data for ID ${pokemonId}:`, error);
                    return null;
                }
            };
            
            const fetchAllPokemon = async () => {
                try {
                    const response = await fetch('https://pokeapi.co/api/v2/pokemon?limit=10000');
                    const data = await response.json();
                    const pokemonList = data.results;

                    const allPokemonPromises = pokemonList.map(async (pokemon) => {
                        const detailedResponse = await fetch(pokemon.url);
                        return detailedResponse.json();
                    });

                    allPokemon = await Promise.all(allPokemonPromises);

                    // Fetch all species data to enable regional and special filtering
                    const allSpeciesPromises = allPokemon.map(p => getSpeciesData(p.id));
                    allSpeciesData = await Promise.all(allSpeciesPromises);
                    
                    loadingMessage.style.display = 'none';
                    filterAndDisplayPokemon('all');

                } catch (error) {
                    console.error('Failed to fetch Pokémon data:', error);
                    loadingMessage.textContent = 'Failed to load Pokédex. Please try again later.';
                }
            };

            const filterAndDisplayPokemon = (category) => {
                let filteredList = [];
                let imageType = 'default';
                let currentPokemonToDisplay;

                switch (category) {
                    case 'all':
                        currentPokemonToDisplay = allPokemon.filter(p => !p.name.includes('-mega') && !p.name.includes('-gmax'));
                        break;
                    case 'mega':
                        currentPokemonToDisplay = allPokemon.filter(p => p.name.includes('-mega'));
                        break;
                    case 'shiny':
                        currentPokemonToDisplay = allPokemon.filter(p => !p.name.includes('-mega') && !p.name.includes('-gmax'));
                        imageType = 'shiny';
                        break;
                    case 'legendary':
                        currentPokemonToDisplay = allPokemon.filter(p => {
                            const species = cachedSpeciesData[p.id];
                            return species && species.is_legendary && !species.is_mythical;
                        });
                        break;
                    case 'mythical':
                        currentPokemonToDisplay = allPokemon.filter(p => {
                            const species = cachedSpeciesData[p.id];
                            return species && species.is_mythical;
                        });
                        break;
                    case 'gmax':
                        currentPokemonToDisplay = allPokemon.filter(p => gmaxPokemonList.includes(p.name));
                        break;
                    default:
                        // Regional filter
                        const targetGenUrl = `https://pokeapi.co/api/v2/generation/${regionalGenerations[category].split('-')[1]}/`;
                        currentPokemonToDisplay = allPokemon.filter(p => {
                            const species = cachedSpeciesData[p.id];
                            return species && species.generation.url === targetGenUrl && !p.name.includes('-mega') && !p.name.includes('-gmax');
                        });
                        break;
                }
                
                searchInput.style.display = (category === 'all' || category === 'shiny' || category.includes('kanto') || category.includes('johto') || category.includes('hoenn')) ? 'block' : 'none';
                displayPokemon(currentPokemonToDisplay, imageType);
            };

            const displayPokemon = (pokemonList, imageType) => {
                pokedexContainer.innerHTML = '';
                pokemonList.forEach(pokemon => {
                    const pokemonCard = document.createElement('div');
                    pokemonCard.classList.add('pokemon-card');
                    pokemonCard.setAttribute('data-id', pokemon.id);

                    const name = pokemon.name;
                    const id = pokemon.id.toString().padStart(3, '0');
                    let imageUrl;

                    if (imageType === 'shiny') {
                        const shinyUrl = pokemon.sprites.versions['generation-v']['black-white'].animated.front_shiny;
                        imageUrl = shinyUrl || pokemon.sprites.front_shiny || pokemon.sprites.front_default;
                    } else {
                        const animatedUrl = pokemon.sprites.versions['generation-v']['black-white'].animated.front_default;
                        imageUrl = animatedUrl || pokemon.sprites.front_default;
                    }
                    
                    pokemonCard.innerHTML = `
                        <div class="pokemon-id">#${id}</div>
                        <img src="${imageUrl}" alt="${name}">
                        <h2 class="pokemon-name">${name.replace('-gmax', '').replace('-amped', '').replace('-mega', '')}</h2>
                        <div class="pokemon-types">
                            ${pokemon.types.map(typeInfo => `<span class="type ${typeInfo.type.name}">${typeInfo.type.name}</span>`).join('')}
                        </div>
                    `;
                    pokedexContainer.appendChild(pokemonCard);
                });
            };

            const showPokemonDetails = async (pokemon) => {
                const speciesData = await getSpeciesData(pokemon.id);

                const id = pokemon.id.toString().padStart(3, '0');
                const name = pokemon.name;
                const animatedUrl = pokemon.sprites.versions['generation-v']['black-white'].animated.front_default;
                const imageUrl = animatedUrl || pokemon.sprites.front_default;
                const types = pokemon.types.map(typeInfo => typeInfo.type.name);
                const height = (pokemon.height / 10).toFixed(1); // Decimeters to meters
                const weight = (pokemon.weight / 10).toFixed(1); // Hectograms to kilograms
                const abilities = pokemon.abilities.map(abilityInfo => abilityInfo.ability.name).join(', ');
                const stats = pokemon.stats.map(statInfo => ({
                    name: statInfo.stat.name.replace('-', ' '),
                    value: statInfo.base_stat
                }));

                const descriptionEntry = speciesData.flavor_text_entries.find(entry => entry.language.name === 'en' && entry.version.name === 'omega-ruby');
                const description = descriptionEntry ? descriptionEntry.flavor_text.replace(/\n/g, ' ') : 'No description available.';

                const origin = speciesData.generation ? speciesData.generation.name.replace('generation-', '') : 'Unknown';
                
                modalBody.innerHTML = `
                    <div class="modal-info">
                        <img src="${imageUrl}" alt="${name}" class="modal-image">
                        <h2 class="modal-name">${name}</h2>
                        <div class="modal-id">#${id}</div>
                        <div class="modal-types">
                            ${types.map(type => `<span class="type ${type}">${type}</span>`).join('')}
                        </div>
                        <p class="description">"${description}"</p>
                        <div class="details">
                            <p><strong>Origin:</strong> ${origin.toUpperCase()}</p>
                            <p><strong>Height:</strong> ${height} m</p>
                            <p><strong>Weight:</strong> ${weight} kg</p>
                            <p><strong>Abilities:</strong> ${abilities}</p>
                        </div>
                        <h3>Base Stats</h3>
                        <ul class="stats-list">
                            ${stats.map(stat => `<li><span>${stat.name}</span><span>${stat.value}</span></li>`).join('')}
                        </ul>
                    </div>
                `;
                pokemonModal.style.display = 'block';
            };

            pokedexContainer.addEventListener('click', (e) => {
                const card = e.target.closest('.pokemon-card');
                if (card) {
                    const pokemonId = parseInt(card.getAttribute('data-id'));
                    const selectedPokemon = allPokemon.find(p => p.id === pokemonId);
                    if (selectedPokemon) {
                        showPokemonDetails(selectedPokemon);
                    }
                }
            });

            closeModal.addEventListener('click', () => {
                pokemonModal.style.display = 'none';
            });

            window.addEventListener('click', (e) => {
                if (e.target === pokemonModal) {
                    pokemonModal.style.display = 'none';
                }
            });

            searchInput.addEventListener('input', (e) => {
                const searchTerm = e.target.value.toLowerCase();
                const filteredPokemon = allPokemon.filter(pokemon => {
                    const isAllOrShiny = document.querySelector('.nav-button.active').dataset.category === 'all' || document.querySelector('.nav-button.active').dataset.category === 'shiny';
                    const isNameMatch = pokemon.name.toLowerCase().includes(searchTerm);
                    const isIdMatch = pokemon.id.toString().includes(searchTerm);
                    return (isNameMatch || isIdMatch) && (isAllOrShiny || true); 
                });
                displayPokemon(filteredPokemon);
            });

            navButtons.forEach(button => {
                button.addEventListener('click', () => {
                    navButtons.forEach(btn => btn.classList.remove('active'));
                    button.classList.add('active');
                    const category = button.getAttribute('data-category');
                    filterAndDisplayPokemon(category);
                });
            });

            fetchAllPokemon();
        });
    </script>
</body>
</html>
