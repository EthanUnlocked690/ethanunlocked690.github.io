<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pokédex - The Ultimate Version</title>
    <link rel="preconnect" href="https://fonts.googleapis.com/">
    <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin="">
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        /* ===================================================================
           NOTE: This CSS is based on your original file's structure.
           You may need to add more styles for .modal-sections, .chain-diagram,
           .form-item, and .shiny-toggle-button for perfect visual alignment!
           =================================================================== */

        /* General Body Styles */
        body {
            font-family: 'Roboto Mono', monospace;
            background-color: #f0f0f0;
            color: #333;
            margin: 0;
            padding: 20px;
            text-align: center;
            /* Placeholder background images if they are local */
            /* background-image: url('pokedex-top.png'), url('pokedex-bottom.png');
            background-position: top center, bottom center;
            background-repeat: no-repeat;
            background-size: contain; */
        }

        h1 {
            color: #e4000f;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        #loadingMessage {
            font-size: 1.2rem;
            color: #555;
            display: none;
        }

        #loadingMessage.error {
            color: #e4000f;
        }

        /* Profile/Logout Area */
        #profile {
            position: absolute;
            top: 10px;
            right: 20px;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: #333;
            background-size: cover;
            cursor: pointer;
            display: none; /* Hidden by default, shown on login */
            border: 3px solid #e4000f;
        }

        /* Search and Controls */
        #controls {
            margin-bottom: 20px;
            display: flex;
            justify-content: center;
            gap: 10px;
        }

        #searchInput {
            padding: 10px;
            border: 2px solid #ccc;
            border-radius: 5px;
            font-size: 1rem;
            width: 300px;
        }

        /* Pokédex Grid */
        .pokedex-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .pokemon-card {
            background-color: #fff;
            border: 3px solid #333;
            border-radius: 10px;
            padding: 10px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            text-transform: capitalize;
            box-shadow: 4px 4px 0 #888;
        }

        .pokemon-card:hover {
            transform: translateY(-5px);
            box-shadow: 6px 6px 0 #e4000f;
        }

        .pokemon-card img {
            width: 100px;
            height: 100px;
            object-fit: contain;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.6);
        }

        .modal-content {
            background-color: #fff;
            margin: 5% auto;
            padding: 30px;
            border: 5px solid #e4000f;
            border-radius: 15px;
            width: 80%;
            max-width: 900px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
            text-align: left;
            position: relative;
        }

        .close-button {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            position: absolute;
            top: 10px;
            right: 20px;
            cursor: pointer;
        }

        .modal-info {
            display: flex;
            gap: 30px;
            flex-wrap: wrap;
        }

        .modal-info img {
            width: 200px;
            height: 200px;
            object-fit: contain;
            background-color: #f7f7f7;
            border-radius: 10px;
            padding: 10px;
        }

        .modal-details {
            flex-grow: 1;
        }

        .modal-id {
            color: #888;
            font-size: 1.2rem;
        }

        /* Types Styling */
        .modal-types {
            margin: 10px 0;
        }

        .type {
            display: inline-block;
            padding: 5px 10px;
            margin-right: 5px;
            border-radius: 5px;
            color: white;
            font-weight: bold;
            text-transform: uppercase;
            font-size: 0.8rem;
        }

        /* Type Colors (Add more as needed) */
        .normal { background-color: #A8A77A; }
        .fire { background-color: #EE8130; }
        .water { background-color: #6390F0; }
        .grass { background-color: #7AC74C; }
        .electric { background-color: #F7D02C; }
        .ice { background-color: #96D9D6; }
        .fighting { background-color: #C22E28; }
        .poison { background-color: #A33EA1; }
        .ground { background-color: #E2BF65; }
        .flying { background-color: #A98FF3; }
        .psychic { background-color: #F95587; }
        .bug { background-color: #A6B91A; }
        .rock { background-color: #B6A136; }
        .ghost { background-color: #735797; }
        .dragon { background-color: #6F35FC; }
        .steel { background-color: #B7B7CE; }
        .fairy { background-color: #D685AD; }
        .dark { background-color: #705746; }

        /* Stats List */
        .stats-list {
            list-style: none;
            padding: 0;
            margin-top: 15px;
        }

        .stats-list li {
            display: flex;
            justify-content: space-between;
            border-bottom: 1px solid #eee;
            padding: 5px 0;
        }

        /* Variety Buttons */
        .variety-buttons {
            margin: 15px 0;
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .variety-button {
            padding: 5px 10px;
            border: 2px solid #888;
            border-radius: 5px;
            cursor: pointer;
            background-color: #f0f0f0;
            font-weight: bold;
            text-transform: capitalize;
        }

        .variety-button.active {
            background-color: #e4000f;
            color: white;
            border-color: #e4000f;
        }

        /* New: Shiny Toggle Button */
        .modal-controls {
            text-align: center;
            margin-bottom: 15px;
            width: 100%;
        }
        
        .shiny-toggle-button {
            padding: 8px 15px;
            background-color: #f7d02c; /* Gold/Yellow color for shiny */
            color: #333;
            border: 2px solid #b6a136;
            border-radius: 5px;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        /* New: Evolution and Forms Sections */
        .modal-sections {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 2px dashed #ccc;
        }
        
        .evolution-chain-container, .other-forms-container {
            margin-bottom: 25px;
        }
        
        .evolution-chain-container h3, .other-forms-container h3 {
            border-bottom: 2px solid #e4000f;
            padding-bottom: 5px;
            margin-bottom: 15px;
            color: #e4000f;
            text-transform: uppercase;
            font-size: 1.2rem;
        }
        
        .chain-diagram {
            display: flex;
            justify-content: center;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .chain-item {
            text-align: center;
            text-transform: capitalize;
            font-size: 0.9rem;
        }
        
        .chain-item img {
            width: 80px;
            height: 80px;
            border: 1px solid #ddd;
            border-radius: 50%;
            padding: 5px;
            background-color: #fff;
            cursor: default;
        }
        
        .chain-arrow {
            font-size: 2rem;
            color: #333;
        }

        .forms-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            justify-content: center;
        }
        
        .form-item {
            text-align: center;
            text-transform: capitalize;
            font-size: 0.8rem;
            cursor: pointer;
        }
        
        .form-item img {
            width: 60px;
            height: 60px;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 5px;
            background-color: #fff;
        }

        /* Login Modal (Placeholder styles) */
        #loginModal .modal-content {
            text-align: center;
            margin-top: 15%;
            max-width: 400px;
        }
        
        #loginModal input {
            width: 80%;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
        
        #loginModal button {
            padding: 10px 20px;
            background-color: #e4000f;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 10px;
        }

    </style>
</head>
<body>

    <div id="profile" title="User Profile / Logout"></div>

    <h1>The Ultimate Pokédex</h1>

    <div id="controls">
        <input type="text" id="searchInput" placeholder="Search by name or ID...">
    </div>

    <div id="loadingMessage"></div>
    <button id="retryButton" style="display:none; margin-top: 10px;">Retry Loading</button>

    <div class="pokedex-container">
        </div>

    <div id="loginModal" class="modal">
        <div class="modal-content">
            <h2>Welcome Trainer!</h2>
            <p>Please log in to start catching Pokémon.</p>
            <input type="text" placeholder="Username" id="loginUsername">
            <input type="password" placeholder="Password" id="loginPassword">
            <button id="loginButton">Login</button>
            <p style="margin-top: 20px;">*The full login logic is skipped in the script, but the modal is displayed/hidden.</p>
        </div>
    </div>

    <div id="pokemonModal" class="modal">
        <div class="modal-content">
            <span class="close-button">×</span>
            
            <div class="modal-controls">
                <button id="shinyToggle" class="shiny-toggle-button">Toggle Shiny</button>
            </div>
            
            <div class="modal-info">
                <img class="modal-image" src="" alt="Pokémon Image">

                <div class="modal-details">
                    <h2 style="margin-top: 0;">Pokémon Name</h2>
                    <p class="modal-id">#000</p>
                    
                    <div class="variety-buttons">
                        </div>

                    <div class="modal-types">
                        </div>

                    <h3>Base Stats</h3>
                    <ul class="stats-list">
                        </ul>
                </div>
            </div>

            <div class="modal-sections">
                <div class="evolution-chain-container">
                    <h3>Evolution Chain</h3>
                    <div id="evolutionChain" class="chain-diagram">
                        </div>
                </div>
                
                <div class="other-forms-container">
                    <h3>Other Forms & Varieties</h3>
                    <div id="otherForms" class="forms-grid">
                        </div>
                </div>
            </div>

        </div>
    </div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    // --- Global Variables and Constants ---
    const BASE_API_URL = 'https://pokeapi.co/api/v2/pokemon?limit=1017';
    // High-quality PNGs for the main modal image (supports most Mega forms)
    const IMAGE_BASE_URL = 'https://raw.githubusercontent.com/HybridShivam/Pokemon/master/assets/images/';
    // PokeAPI sprites for evolution chain/forms (supports shiny reliably)
    const SPRITE_BASE_URL = 'https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/';
    
    // Core Pokédex Elements
    const pokedexContainer = document.querySelector('.pokedex-container');
    const searchInput = document.getElementById('searchInput');
    const loadingMessage = document.getElementById('loadingMessage');
    const retryButton = document.getElementById('retryButton');
    
    // Modal Elements
    const modal = document.getElementById('pokemonModal');
    const modalImage = document.querySelector('.modal-info .modal-image');
    const varietyButtonsDiv = document.querySelector('.variety-buttons');
    const closeButton = document.querySelector('.close-button');
    const evolutionChainContainer = document.getElementById('evolutionChain');
    const otherFormsContainer = document.getElementById('otherForms');
    const SHINY_TOGGLE = document.getElementById('shinyToggle');
    
    // LOGIN/USER Elements
    const loginModal = document.getElementById('loginModal');
    const profile = document.getElementById('profile');
    
    // State Variables
    let allPokemon = [];
    let detailedPokemonData = new Map();
    let varietiesData = new Map();
    let evolutionChains = new Map();
    let isShiny = false;
    let user = null; 
    let isPremium = false; 
    let loginTimestamp = 0; 

    // --- Utility Functions ---

    function formatFormName(apiName) {
        if (apiName === 'standard') return 'Standard';
        if (apiName.includes('-mega')) {
            if (apiName.endsWith('-x')) return 'Mega-X';
            if (apiName.endsWith('-y')) return 'Mega-Y';
            return 'Mega';
        }
        return apiName.split('-').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join('-');
    }

    function getPokemonImageUrl(pokemonId, formName = 'Standard') {
        const paddedId = String(pokemonId).padStart(3, '0');
        let imageFileName;

        if (formName === 'Standard') {
            imageFileName = `${paddedId}.png`;
        } else {
            const cleanedFormName = formName.replace(/-/g, ''); 
            imageFileName = `${paddedId}-${cleanedFormName}.png`;
        }
        
        return `${IMAGE_BASE_URL}${imageFileName}`;
    }

    function getPokemonSpriteUrl(pokemonId, isShiny = false) {
        let path = isShiny ? 'shiny/' : '';
        return `${SPRITE_BASE_URL}${path}${pokemonId}.png`;
    }

    // --- Core Pokédex Data Fetching ---

    async function fetchAllPokemon() {
        loadingMessage.textContent = 'Loading Pokédex...';
        loadingMessage.classList.remove('error');
        loadingMessage.style.display = 'block';
        retryButton.style.display = 'none';

        try {
            const response = await fetch(BASE_API_URL);
            if (!response.ok) throw new Error('Network response was not ok');
            const data = await response.json();
            
            allPokemon = data.results.map((p, index) => ({
                id: index + 1,
                name: p.name,
                url: p.url,
            }));

            const speciesCandidates = allPokemon.filter(p => p.id < 10000); 

            await fetchSpeciesData(speciesCandidates);
            displayPokemon(allPokemon);
            loadingMessage.style.display = 'none';

        } catch (error) {
            console.error('Error fetching Pokémon list:', error);
            loadingMessage.textContent = 'Error: Could not load Pokémon data. Please try again.';
            loadingMessage.classList.add('error');
            retryButton.style.display = 'block';
        }
    }

    async function fetchSpeciesData(pokemonArray) {
        loadingMessage.textContent = `Fetching variety and evolution data...`;

        const speciesPromises = pokemonArray.map(async (pokemon) => {
            if (pokemon.id > 1017 && pokemon.id < 10000) return;

            try {
                const speciesUrl = `https://pokeapi.co/api/v2/pokemon-species/${pokemon.id}/`;
                const response = await fetch(speciesUrl);
                if (!response.ok) return;
                const speciesData = await response.json();
                
                if (speciesData.evolution_chain && speciesData.evolution_chain.url) {
                    evolutionChains.set(pokemon.id, speciesData.evolution_chain.url);
                }

                const varieties = speciesData.varieties.map(v => {
                    const nameParts = v.pokemon.url.split('/');
                    const varietyId = parseInt(nameParts[nameParts.length - 2]);
                    const apiName = v.pokemon.name;

                    if (apiName.includes('female')) return null;

                    return {
                        id: varietyId,
                        name: v.is_default ? 'Standard' : formatFormName(apiName),
                        apiName: apiName,
                        isMega: apiName.includes('-mega'),
                        isDefault: v.is_default
                    };
                }).filter(v => v);
                
                varietiesData.set(pokemon.id, varieties);

            } catch (error) {
                console.warn(`Could not fetch species data for ${pokemon.name}:`, error);
            }
        });
        await Promise.all(speciesPromises);
    }
    
    // --- Evolution & Forms Rendering ---

    function parseEvolutionChain(chain, evoChain = []) {
        const speciesName = chain.species.name;
        const pokeEntry = allPokemon.find(p => p.name === speciesName);
        const pokemonId = pokeEntry ? pokeEntry.id : null;

        if (pokemonId) {
            evoChain.push({ id: pokemonId, name: speciesName });
        }

        if (chain.evolves_to.length > 0) {
            chain.evolves_to.forEach(nextStage => {
                parseEvolutionChain(nextStage, evoChain);
            });
        }
        return evoChain;
    }

    async function renderEvolutionChain(speciesId) {
        evolutionChainContainer.innerHTML = 'Loading chain...';
        const chainUrl = evolutionChains.get(speciesId);
        
        if (!chainUrl) {
            evolutionChainContainer.innerHTML = '<p>No evolution chain data available.</p>';
            return;
        }

        try {
            const response = await fetch(chainUrl);
            const data = await response.json();
            const chain = parseEvolutionChain(data.chain);

            let html = '';
            for (let i = 0; i < chain.length; i++) {
                const poke = chain[i];
                const spriteUrl = getPokemonSpriteUrl(poke.id, isShiny);

                html += `
                    <div class="chain-item" data-id="${poke.id}">
                        <img src="${spriteUrl}" alt="${poke.name}" onerror="this.src='${getPokemonSpriteUrl(poke.id, false)}'">
                        <span>${poke.name}</span>
                    </div>
                `;
                if (i < chain.length - 1) {
                    html += `<div class="chain-arrow">→</div>`;
                }
            }
            evolutionChainContainer.innerHTML = html;
        } catch (error) {
            evolutionChainContainer.innerHTML = '<p>Failed to load evolution chain.</p>';
            console.error('Error fetching evolution chain:', error);
        }
    }

    function renderOtherForms(pokemonId) {
        otherFormsContainer.innerHTML = '';
        const allVarieties = varietiesData.get(pokemonId) || [];
        
        const otherForms = allVarieties.filter(v => !v.isMega && !v.isDefault && v.name !== 'Standard');
        
        if (otherForms.length === 0) {
            otherFormsContainer.innerHTML = '<p>No other special forms available.</p>';
            return;
        }

        otherForms.forEach(v => {
            const spriteUrl = getPokemonSpriteUrl(v.id, isShiny);
            
            const formDiv = document.createElement('div');
            formDiv.classList.add('form-item');
            formDiv.innerHTML = `
                <img src="${spriteUrl}" alt="${v.name}" onerror="this.src='${getPokemonSpriteUrl(v.id, false)}'">
                <span>${v.name}</span>
            `;
            formDiv.addEventListener('click', () => {
                const mainPoke = allPokemon.find(p => p.name === v.apiName.split('-')[0]);
                if (mainPoke) showPokemonDetails(mainPoke.id, mainPoke.name, v.apiName);
            });

            otherFormsContainer.appendChild(formDiv);
        });
    }

    // --- Pokedex Grid and Modal Display ---

    function displayPokemon(pokemonArray) {
        pokedexContainer.innerHTML = '';
        if (pokemonArray.length === 0) {
            pokedexContainer.innerHTML = '<p>No Pokémon found matching your search.</p>';
            return;
        }

        pokemonArray.forEach(pokemon => {
            if (pokemon.id >= 10000) return; 

            const card = document.createElement('div');
            card.classList.add('pokemon-card');
            const imageUrl = getPokemonImageUrl(pokemon.id);

            card.innerHTML = `
                <p class="pokemon-id">#${String(pokemon.id).padStart(3, '0')}</p>
                <img src="${imageUrl}" alt="${pokemon.name}" onerror="this.onerror=null;this.src='${getPokemonSpriteUrl(pokemon.id, false)}';">
                <p class="pokemon-name">${pokemon.name}</p>
                <div class="pokemon-types"></div>
            `;
            
            card.addEventListener('click', () => {
                isShiny = false; 
                SHINY_TOGGLE.textContent = 'Toggle Shiny'; 
                showPokemonDetails(pokemon.id, pokemon.name);
            });
            pokedexContainer.appendChild(card);
        });
    }

    async function showPokemonDetails(pokemonId, pokemonName, formApiName = null) {
        let detailedPoke;
        const fetchName = formApiName || pokemonName;

        if (detailedPokemonData.get(fetchName)) {
            detailedPoke = detailedPokemonData.get(fetchName);
        } else {
            loadingMessage.textContent = `Fetching details for ${fetchName}...`;
            loadingMessage.style.display = 'block';

            try {
                const response = await fetch(`https://pokeapi.co/api/v2/pokemon/${fetchName}`);
                if (!response.ok) throw new Error('Failed to fetch detailed data');
                detailedPoke = await response.json();
                detailedPokemonData.set(fetchName, detailedPoke);
            } catch (error) {
                loadingMessage.textContent = 'Error fetching Pokémon details.';
                loadingMessage.classList.add('error');
                console.error(error);
                return;
            } finally {
                loadingMessage.style.display = 'none';
            }
        }
        
        const speciesId = allPokemon.find(p => p.name === pokemonName)?.id || pokemonId;
        const varieties = varietiesData.get(speciesId) || [];
        
        const currentVariety = varieties.find(v => v.apiName === fetchName);
        const currentFormName = currentVariety ? currentVariety.name : 'Standard';
        const imageUrl = getPokemonImageUrl(speciesId, currentFormName);
        
        document.querySelector('.modal-info h2').textContent = currentFormName === 'Standard' ? detailedPoke.name : detailedPoke.name + ` (${currentFormName})`;
        document.querySelector('.modal-info .modal-id').textContent = `#${String(speciesId).padStart(3, '0')}`;
        
        const mainImageUpdate = () => {
             modalImage.src = isShiny ? getPokemonSpriteUrl(speciesId, true) : imageUrl;
             modalImage.alt = `${detailedPoke.name} - ${currentFormName} ${isShiny ? '(Shiny)' : ''}`;
        };
        mainImageUpdate();

        // Variety Buttons (Standard and Megas)
        varietyButtonsDiv.innerHTML = '';
        const primaryForms = varieties.filter(v => v.isDefault || v.isMega);

        primaryForms.forEach(v => {
            const varietyButton = document.createElement('button');
            varietyButton.classList.add('variety-button');
            varietyButton.textContent = v.name;
            if (v.apiName === fetchName) {
                varietyButton.classList.add('active');
            }
            if (v.isMega) {
                varietyButton.style.backgroundColor = '#6F35FC'; 
            }

            varietyButton.addEventListener('click', () => {
                showPokemonDetails(speciesId, pokemonName, v.apiName);
            });

            varietyButtonsDiv.appendChild(varietyButton);
        });

        // Types and Stats rendering
        const modalTypes = document.querySelector('.modal-info .modal-types');
        modalTypes.innerHTML = '';
        detailedPoke.types.forEach(typeInfo => {
            const typeSpan = document.createElement('span');
            typeSpan.classList.add('type', typeInfo.type.name);
            typeSpan.textContent = typeInfo.type.name;
            modalTypes.appendChild(typeSpan);
        });

        const statsList = document.querySelector('.modal-info .stats-list');
        statsList.innerHTML = '';
        detailedPoke.stats.forEach(statInfo => {
            const statLi = document.createElement('li');
            statLi.innerHTML = `<span>${statInfo.stat.name.toUpperCase()}</span><span>${statInfo.base_stat}</span>`;
            statsList.appendChild(statLi);
        });
        
        await renderEvolutionChain(speciesId);
        renderOtherForms(speciesId);

        modal.style.display = 'block';

        // Update shiny toggle logic
        SHINY_TOGGLE.onclick = () => {
            isShiny = !isShiny;
            SHINY_TOGGLE.textContent = isShiny ? 'Toggle Standard' : 'Toggle Shiny';
            
            mainImageUpdate();
            renderEvolutionChain(speciesId);
            renderOtherForms(speciesId);
        };
    }

    // --- Login/User Session Logic (Restored) ---

    function checkPremiumExpiry() {
        const PREMIUM_DURATION_MS = 24 * 60 * 60 * 1000; // 24 hours
        if (isPremium && Date.now() - loginTimestamp > PREMIUM_DURATION_MS) {
            isPremium = false;
            user.isPremium = false;
            localStorage.setItem('currentUser', JSON.stringify(user));
            alert('Your premium subscription has expired!');
        }
    }

    function init() {
        // Try to restore session
        const loggedInUser = localStorage.getItem('currentUser');
        if (loggedInUser) {
            user = JSON.parse(loggedInUser);
            isPremium = user.isPremium;
            profile.style.backgroundImage = `url(${user.profilePic})`; 
            profile.style.display = 'block';
            loginTimestamp = parseInt(localStorage.getItem('loginTimestamp'), 10) || Date.now();
            checkPremiumExpiry();
            loginModal.style.display = 'none';
        } else {
            // SHOW THE LOGIN MODAL if not logged in
            loginModal.style.display = 'block';
            profile.style.display = 'none';
        }
        fetchAllPokemon();
    }

    // --- Event Listeners ---
    
    closeButton.onclick = function() {
        modal.style.display = 'none';
        isShiny = false;
        SHINY_TOGGLE.textContent = 'Toggle Shiny';
    }

    window.onclick = function(event) {
        if (event.target == modal) {
            modal.style.display = 'none';
            isShiny = false;
            SHINY_TOGGLE.textContent = 'Toggle Shiny';
        }
    }
    
    // Search Filter (Fixed)
    searchInput.addEventListener('input', (e) => {
        const searchTerm = e.target.value.toLowerCase();
        const filteredPokemon = allPokemon.filter(p => 
            p.name.includes(searchTerm) || String(p.id).padStart(3, '0').includes(searchTerm) || String(p.id).includes(searchTerm)
        );
        displayPokemon(filteredPokemon);
    });

    retryButton.addEventListener('click', fetchAllPokemon);

    // --- Initialization ---
    init();
});
</script>

</body>
</html>
