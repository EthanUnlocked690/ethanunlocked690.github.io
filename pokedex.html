<!DOCTYPE html>
<!-- saved from url=(0047)https://ethanunlocked690.github.io/pokedex.html -->
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pokédex - The Ultimate Version</title>
<link rel="preconnect" href="https://fonts.googleapis.com/">
<link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin="">
<link href="./Pokédex - The Ultimate Version_files/css2" rel="stylesheet">
<style>
/* General Body Styles */
body {
    font-family: 'Roboto Mono', monospace;
    background-color: #f0f0f0;
    color: #333;
    margin: 0;
    padding: 20px;
    text-align: center;
    background-image: url('pokedex-top.png'), url('pokedex-bottom.png');
    background-position: top center, bottom center;
    background-repeat: no-repeat;
    background-size: contain;
}

h1 {
    color: #e4000f;
    text-transform: uppercase;
    letter-spacing: 2px;
}

#loadingMessage {
    font-size: 1.2rem;
    color: #555;
    display: none;
}

#loadingMessage.error {
    color: #e4000f;
}

#retryButton {
    background-color: #e4000f;
    color: #fff;
    border: none;
    padding: 10px 20px;
    border-radius: 25px;
    font-family: 'Roboto Mono', monospace;
    font-size: 16px;
    cursor: pointer;
    margin-top: 10px;
    display: none;
}

#retryButton:hover {
    background-color: #c2000d;
}

/* Top Navbar */
.top-navbar {
    background-color: #333;
    color: #fff;
    padding: 10px;
    text-align: left;
}

.top-navbar a {
    color: #fff;
    text-decoration: none;
    font-size: 16px;
}

.nav-container {
    display: flex;
    justify-content: center;
    flex-wrap: wrap;
    margin-bottom: 20px;
    gap: 10px;
}

.nav-button {
    background-color: #333;
    color: #fff;
    border: none;
    padding: 10px 20px;
    border-radius: 25px;
    font-family: 'Roboto Mono', monospace;
    font-size: 16px;
    cursor: pointer;
    transition: background-color 0.3s;
}

.nav-button:hover,
.nav-button.active {
    background-color: #e4000f;
}

/* Search Bar */
.search-container {
    margin-bottom: 20px;
}

#searchInput {
    width: 80%;
    max-width: 400px;
    padding: 10px 15px;
    border: 2px solid #ccc;
    border-radius: 25px;
    font-size: 16px;
    font-family: 'Roboto Mono', monospace;
    outline: none;
    transition: border-color 0.3s;
}

#searchInput:focus {
    border-color: #e4000f;
}

/* Pokédex Container (Grid) */
.pokedex-container {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
    padding: 20px;
    max-width: 1200px;
    margin: 0 auto;
}

/* Pokémon Card */
.pokemon-card {
    background-color: #fff;
    border-radius: 15px;
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    padding: 20px;
    text-align: center;
    transition: transform 0.2s, box-shadow 0.2s;
    cursor: pointer;
}

.pokemon-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 16px rgba(0,0,0,0.2);
}

.pokemon-card .pokemon-id {
    font-size: 14px;
    color: #888;
    font-weight: bold;
}

.pokemon-card img {
    width: 150px;
    height: 150px;
    margin: 10px auto;
    display: block;
}

.pokemon-card .pokemon-name {
    margin: 15px 0 10px;
    font-size: 22px;
    font-weight: bold;
    text-transform: capitalize;
}

/* Types Container */
.pokemon-types {
    display: flex;
    justify-content: center;
    gap: 10px;
    margin-top: 10px;
}

.type {
    padding: 5px 15px;
    border-radius: 15px;
    color: white;
    font-size: 14px;
    text-transform: uppercase;
    font-weight: bold;
}

/* Pokémon Type Colors */
.type.normal { background-color: #A8A77A; }
.type.fire { background-color: #EE8130; }
.type.water { background-color: #6390F0; }
.type.electric { background-color: #F7D02C; }
.type.grass { background-color: #7AC74C; }
.type.ice { background-color: #96D9D6; }
.type.fighting { background-color: #C22E28; }
.type.poison { background-color: #A33EA1; }
.type.ground { background-color: #E2BF65; }
.type.flying { background-color: #A98FF3; }
.type.psychic { background-color: #F95587; }
.type.bug { background-color: #A6B91A; }
.type.rock { background-color: #B6A136; }
.type.ghost { background-color: #735797; }
.type.dragon { background-color: #6F35FC; }
.type.dark { background-color: #705746; }
.type.steel { background-color: #B7B7CE; }
.type.fairy { background-color: #D685AD; }

/* Modal Styles */
.modal {
    display: none;
    position: fixed;
    z-index: 10;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    overflow: auto;
    background-color: rgba(0,0,0,0.4);
    backdrop-filter: blur(5px);
}

.modal-content {
    background-color: #fff;
    margin: 10% auto;
    padding: 30px;
    border: 1px solid #888;
    width: 80%;
    max-width: 600px;
    border-radius: 20px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.3);
    position: relative;
    animation-name: animatetop;
    animation-duration: 0.4s;
    text-align: left;
}

@keyframes animatetop {
    from {top: -300px; opacity: 0}
    to {top: 0; opacity: 1}
}

.close-button {
    color: #aaa;
    float: right;
    font-size: 28px;
    font-weight: bold;
    cursor: pointer;
}

.close-button:hover,
.close-button:focus {
    color: black;
    text-decoration: none;
}

.modal-info h2 {
    text-align: center;
    text-transform: capitalize;
    font-size: 2.5rem;
    margin-top: 0;
}

.modal-info .modal-id {
    font-size: 1.5rem;
    color: #888;
    text-align: center;
}

.modal-info .modal-image {
    display: block;
    margin: 0 auto 20px;
    width: 200px;
    height: 200px;
    cursor: pointer;
}

/* Attack Animation */
.modal-image.attack {
    animation: attack-pulse 0.5s ease-in-out;
}

@keyframes attack-pulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.1) translateX(-5px); }
    100% { transform: scale(1); }
}

.modal-info .modal-types {
    display: flex;
    justify-content: center;
    gap: 10px;
    margin-bottom: 20px;
}

.modal-info .details p {
    margin: 5px 0;
}

.modal-info .description {
    margin-top: 20px;
    font-style: italic;
    text-align: justify;
}

.modal-info .stats-list {
    list-style-type: none;
    padding: 0;
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 10px;
}

.modal-info .stats-list li {
    background-color: #f5f5f5;
    padding: 10px;
    border-radius: 10px;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.modal-info .stats-list span:first-child {
    font-weight: bold;
    text-transform: uppercase;
}

/* Variety Button Styles */
.variety-section {
    margin-top: 20px;
}
.variety-section h4 {
    margin-bottom: 10px;
    font-size: 1.2rem;
    color: #555;
    border-bottom: 2px solid #ddd;
    padding-bottom: 5px;
}
.variety-buttons {
    display: flex;
    justify-content: center;
    flex-wrap: wrap;
    gap: 10px;
}
.variety-button {
    background-color: #6390F0;
    color: white;
    border: none;
    padding: 8px 15px;
    border-radius: 20px;
    cursor: pointer;
    font-family: 'Roboto Mono', monospace;
    font-size: 14px;
    transition: background-color 0.3s;
}
.variety-button.active {
    background-color: #3f65b8;
}
.variety-button.shiny-button {
    background-color: #FFD700;
    color: #000;
}
.variety-button.shiny-button.active {
    background-color: #e4c200;
}

.tcg-card-section {
    margin-top: 20px;
    text-align: center;
}
.tcg-card-section img {
    max-width: 100%;
    height: auto;
    border: 5px solid #fff;
    box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    border-radius: 10px;
}
.tcg-card-section .card-loading {
    font-style: italic;
    color: #888;
}

/* Evolution Chain */
.evolution-section {
    margin-top: 20px;
}
.evolution-section h4 {
    margin-bottom: 10px;
    font-size: 1.2rem;
    color: #555;
    border-bottom: 2px solid #ddd;
    padding-bottom: 5px;
}
.evolution-chain {
    display: flex;
    justify-content: center;
    gap: 20px;
}
.evolution-item {
    cursor: pointer;
}
.evolution-item.current img {
    transform: scale(1.2);
}
.evolution-item.current .evolution-name {
    font-weight: bold;
}
.evolution-item img {
    width: 80px;
    height: 80px;
}
.evolution-item .evolution-name {
    text-transform: capitalize;
}

/* Menu Button */
#menu-button {
    position: fixed;
    bottom: 20px;
    right: 20px;
    background: url('ball.png') no-repeat center;
    background-size: contain;
    width: 60px;
    height: 60px;
    border: none;
    cursor: pointer;
    z-index: 1000;
}
#menu-button:hover::after {
    content: 'Menu';
    position: absolute;
    bottom: 70px;
    right: 0;
    background: #000;
    color: #fff;
    padding: 5px;
    border-radius: 5px;
}
.menu-options {
    position: fixed;
    bottom: 90px;
    right: 20px;
    display: none;
    flex-direction: column;
    gap: 10px;
    z-index: 1000;
}
.menu-option {
    width: 50px;
    height: 50px;
    background-size: contain;
    background-repeat: no-repeat;
    background-position: center;
    cursor: pointer;
    position: relative;
}
.menu-option:hover::after {
    content: attr(data-text);
    position: absolute;
    right: 60px;
    top: 10px;
    background: #000;
    color: #fff;
    padding: 5px;
    border-radius: 5px;
    white-space: nowrap;
}
#help-option { background: url('question.png') no-repeat center; background-size: contain; }
#catch-option { background: url('pokeball-outline.png') no-repeat center; background-size: contain; }
#guess-option { background: url('guess.png') no-repeat center; background-size: contain; }
#battle-option { background: url('battle.png') no-repeat center; background-size: contain; }
#edit-option { background: url('admin.png') no-repeat center; background-size: contain; }
#edit-option.admin-signed-in { background: url('edit.png') no-repeat center; background-size: contain; }
#edit-option:hover::after { content: 'Admin Access Only!'; }
#edit-option.admin-signed-in:hover::after { content: 'Edit'; }
#caught-option { background: url('caught.png') no-repeat center; background-size: contain; }

/* Login Modal */
#login-modal {
    display: block;
    position: fixed;
    z-index: 2000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0,0,0,0.5);
}
#login-content {
    background: #fff;
    margin: 15% auto;
    padding: 20px;
    width: 300px;
    text-align: center;
    border-radius: 10px;
}
#login-logo {
    width: 100px;
    margin-bottom: 20px;
}
#username, #password, #signup-name, #signup-password, #signup-age, #profile-name, #admin-username, #admin-password {
    width: 100%;
    padding: 10px;
    margin: 10px 0;
    border: 1px solid #ccc;
    border-radius: 5px;
    box-sizing: border-box;
}
.login-option {
    padding: 10px 20px;
    background: #e4000f;
    color: #fff;
    border: none;
    cursor: pointer;
    border-radius: 5px;
    margin: 5px;
    width: 100%;
}

/* Catch Modal */
#catch-modal {
    display: none;
    position: fixed;
    z-index: 1500;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.5);
}
#catch-content {
    background: #fff;
    margin: 10% auto;
    padding: 20px;
    width: 400px;
    text-align: center;
    border-radius: 10px;
    position: relative;
}
#pokemon-area {
    height: 200px;
    position: relative;
}
#berry-button {
    background: url('berry.png') no-repeat center;
    background-size: contain;
    width: 50px;
    height: 50px;
    border: none;
    cursor: pointer;
    position: absolute;
    top: 20px;
    right: 20px;
}
#pokeball {
    position: absolute;
    bottom: 50px;
    left: 50%;
    transform: translateX(-50%);
    width: 60px;
    height: 60px;
    background: url('pokeball.png') no-repeat center;
    background-size: contain;
    cursor: grab;
}
#pokeball.dragging {
    cursor: grabbing;
}
.shake {
    animation: shake 0.5s;
    animation-iteration-count: 3;
}
@keyframes shake {
    0% { transform: translate(1px, 1px) rotate(0deg); }
    10% { transform: translate(-1px, -2px) rotate(-1deg); }
    20% { transform: translate(-3px, 0px) rotate(1deg); }
    30% { transform: translate(3px, 2px) rotate(0deg); }
    40% { transform: translate(1px, -1px) rotate(1deg); }
    50% { transform: translate(-1px, 2px) rotate(-1deg); }
    60% { transform: translate(-3px, 1px) rotate(0deg); }
    70% { transform: translate(3px, 1px) rotate(-1deg); }
    80% { transform: translate(-1px, -1px) rotate(1deg); }
    90% { transform: translate(1px, 2px) rotate(0deg); }
    100% { transform: translate(1px, -2px) rotate(-1deg); }
}
#pay-unlimited {
    padding: 10px 20px;
    background: #e4000f;
    color: #fff;
    border: none;
    cursor: pointer;
    margin-top: 20px;
    border-radius: 5px;
}

/* Payment Modal */
#payment-modal {
    display: none;
    position: fixed;
    z-index: 1500;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.5);
}
#payment-content {
    background: #fff;
    margin: 10% auto;
    padding: 20px;
    width: 400px;
    text-align: center;
    border-radius: 10px;
}
#payment-form input {
    width: 100%;
    padding: 10px;
    margin: 10px 0;
    border: 1px solid #ccc;
    border-radius: 5px;
    box-sizing: border-box;
}
#confirm-payment {
    background: #e4000f;
    color: #fff;
    border: none;
    padding: 15px 30px;
    border-radius: 5px;
    cursor: pointer;
    font-size: 16px;
    margin: 20px 0;
}
#confirm-payment:hover {
    background: #c2000d;
}
#claim-trial {
    background: #4CAF50;
    color: white;
    border: none;
    padding: 10px 20px;
    border-radius: 5px;
    cursor: pointer;
    margin: 10px;
}
#claim-trial:hover {
    background: #45a049;
}
#trial-section {
    margin: 10px 0;
    padding: 10px;
    border: 1px solid #ddd;
    border-radius: 5px;
}
.mobile-payment {
    font-size: 18px;
    padding: 20px;
}
.mobile-payment button {
    background: #007AFF;
    color: white;
    border: none;
    padding: 15px 30px;
    border-radius: 10px;
    font-size: 16px;
    cursor: pointer;
    margin: 10px;
}
.mobile-payment button:hover {
    background: #005bb5;
}

/* Profile Modal */
#profile-modal {
    display: none;
    position: fixed;
    z-index: 1500;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.5);
}
#profile-content {
    background: #fff;
    margin: 10% auto;
    padding: 20px;
    width: 400px;
    text-align: center;
    border-radius: 10px;
    position: relative;
}
#online-status {
    margin-top: 10px;
    padding: 5px;
}
#cancel-premium {
    background: #f44336;
    color: white;
    border: none;
    padding: 10px 20px;
    border-radius: 5px;
    cursor: pointer;
    margin: 10px;
}
#cancel-premium:hover {
    background: #da190b;
}

/* Battle Modal */
#battle-modal {
    display: none;
    position: fixed;
    z-index: 1500;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.5);
}
#battle-content {
    background: #fff;
    margin: 10% auto;
    padding: 20px;
    width: 300px;
    text-align: center;
    border-radius: 10px;
}
#team-rocket, #battle-friend {
    width: 100px;
    height: 100px;
    background-size: contain;
    cursor: pointer;
    margin: 10px auto;
}
#team-rocket { background: url('team.png') no-repeat center; }
#battle-friend { background: url('some.png') no-repeat center; }

/* Caught Pokemon Modal */
#caught-pokemon-modal {
    display: none;
    position: fixed;
    z-index: 1500;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.5);
}
#caught-content {
    background: #fff;
    margin: 10% auto;
    padding: 20px;
    width: 400px;
    text-align: center;
    border-radius: 10px;
}

/* Help Modal */
#help-modal {
    display: none;
    position: fixed;
    z-index: 1500;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.5);
}
#help-content {
    background: #fff;
    margin: 10% auto;
    padding: 20px;
    width: 400px;
    text-align: center;
    border-radius: 10px;
}

/* Guess Modal */
#guess-modal {
    display: none;
    position: fixed;
    z-index: 1500;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.5);
}
#guess-content {
    background: #fff;
    margin: 10% auto;
    padding: 20px;
    width: 400px;
    text-align: center;
    border-radius: 10px;
}

/* Edit Modal */
#edit-modal {
    display: none;
    position: fixed;
    z-index: 1500;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.5);
}
#edit-content {
    background: #fff;
    margin: 10% auto;
    padding: 20px;
    width: 400px;
    text-align: center;
    border-radius: 10px;
}
</style>
</head>
<body>
<div id="login-modal" class="modal" style="display: none;">
    <div id="login-content">
        <span class="close-button">×</span>
        <img id="login-logo" src="./Pokédex - The Ultimate Version_files/logo.png" alt="Logo">
        <button id="login-option" class="login-option" style="background: rgb(228, 0, 15);">Log In</button>
        <button id="signup-option" class="login-option" style="background: rgb(228, 0, 15);">Sign Up</button>
        <button id="admin-login-option" class="login-option" style="background: rgb(194, 0, 13);">Admin Log-in</button>
        <div id="login-form" style="display: none;">
            <input type="text" id="username" placeholder="Username">
            <input type="password" id="password" placeholder="Password">
            <button id="login-button" class="login-option">Submit</button>
        </div>
        <div id="signup-form" style="display: none;">
            <input type="text" id="signup-name" placeholder="Username">
            <input type="password" id="signup-password" placeholder="Password">
            <input type="text" id="profile-name" placeholder="Profile Name">
            <input type="number" id="signup-age" placeholder="Age">
            <input type="file" id="profile-pic" accept="image/*">
            <select id="profile-gallery">
                <option value="default-profile.png">Default</option>
            </select>
            <button id="submit-signup" class="login-option">Submit</button>
        </div>
        <div id="admin-login-form" style="display: block;">
            <input type="text" id="admin-username" placeholder="Admin Username">
            <input type="password" id="admin-password" placeholder="Admin Password">
            <button id="admin-login-button" class="login-option">Submit</button>
        </div>
    </div>
</div>

<div id="profile-modal" class="modal">
    <div id="profile-content">
        <span class="close-button">×</span>
        <h2>Profile</h2>
        <p>Premium: <span id="premium-status">No</span></p>
        <p>Caught Pokémon: <span id="caught-count">0</span></p>
        <p>Daily Catches Left: <span id="daily-catches">5</span></p>
        <button id="cancel-premium" style="display: none;">Cancel Premium</button>
    </div>
</div>

<div id="battle-modal" class="modal">
    <div id="battle-content">
        <span class="close-button">×</span>
        <h2>Battle</h2>
        <div id="team-rocket"></div>
    </div>
</div>

<div id="caught-pokemon-modal" class="modal">
    <div id="caught-content">
        <span class="close-button">×</span>
        <h2>Caught Pokémon</h2>
        <div id="caught-list"></div>
    </div>
</div>

<div id="help-modal" class="modal">
    <div id="help-content">
        <span class="close-button">×</span>
        <h2>Help</h2>
        <p>Welcome to the Ultimate Pokédex! Browse Pokémon, catch them in a Pokémon GO-style simulation, battle Team Rocket or friends, and play Guess the Pokémon!</p>
    </div>
</div>

<div id="guess-modal" class="modal">
    <div id="guess-content">
        <span class="close-button">×</span>
        <h2>Guess the Pokémon</h2>
        <div id="guess-image"></div>
        <input type="text" id="guess-input" placeholder="Who&#39;s that Pokémon?">
        <button id="guess-submit">Submit</button>
    </div>
</div>

<div id="edit-modal" class="modal" style="display: block;">
    <div id="edit-content">
        <span class="close-button">×</span>
        <p>The admin can propose changes here!</p>
        <div id="admin-edit-forms">
            <!-- Admin can change background image permanently -->
            <h3>Change Background Image</h3>
            <input type="file" id="background-upload" accept="image/*">
            <button id="apply-background">Apply Background</button>
            <!-- Admin can add custom Pokémon permanently -->
            <h3>Add Custom Pokémon</h3>
            <input type="text" id="custom-poke-name" placeholder="Pokémon Name">
            <input type="text" id="custom-poke-types" placeholder="Types (comma separated)">
            <input type="text" id="custom-poke-id" placeholder="ID (unique number)">
            <input type="file" id="custom-poke-image" accept="image/*">
            <input type="text" id="custom-poke-height" placeholder="Height (in dm)">
            <input type="text" id="custom-poke-weight" placeholder="Weight (in hg)">
            <input type="text" id="custom-poke-abilities" placeholder="Abilities (comma separated)">
            <textarea id="custom-poke-description" placeholder="Description"></textarea>
            <button id="add-custom-poke">Add Custom Pokémon</button>
            <!-- Admin can remove Pokémon permanently -->
            <h3>Remove Pokémon</h3>
            <input type="text" id="remove-poke-name" placeholder="Pokémon Name to Remove">
            <button id="remove-poke">Remove Pokémon</button>
            <!-- Admin can add additional background images or elements -->
            <h3>Add Additional Background Element</h3>
            <input type="file" id="additional-bg-upload" accept="image/*">
            <input type="text" id="additional-bg-position" placeholder="Position (e.g., top left)">
            <button id="apply-additional-bg">Apply Additional Background</button>
            <!-- Admin can remove custom elements -->
            <h3>Remove Custom Element</h3>
            <input type="text" id="remove-element-id" placeholder="Element ID to Remove">
            <button id="remove-element">Remove Element</button>
            <!-- Admin can add custom styles -->
            <h3>Add Custom CSS Rule</h3>
            <textarea id="custom-css-rule" placeholder="CSS Rule (e.g., body { color: red; })"></textarea>
            <button id="apply-custom-css">Apply CSS</button>
            <!-- Admin can reset all changes -->
            <h3>Reset All Custom Changes</h3>
            <button id="reset-changes">Reset Changes</button>
        </div>
    </div>
</div>

<div id="catch-modal" class="modal">
    <div id="catch-content">
        <span class="close-button">×</span>
        <h2>Catch a Pokémon</h2>
        <div id="pokemon-area"></div>
        <button id="berry-button"></button>
        <div id="pokeball"></div>
        <p>Daily catches left: <span id="daily-left">5</span></p>
        <button id="pay-unlimited">Pay for Unlimited</button>
    </div>
</div>

<div id="payment-modal" class="modal">
    <div id="payment-content">
        <span class="close-button">×</span>
        <h2>Premium Subscription</h2>
        <p>Upgrade to Premium for unlimited catches! Cancel anytime.</p>
        <p id="weekly-price"><strong>$20/week</strong></p>
        <div id="trial-section" style="display: none;">
            <p>If subscribed to <a href="https://www.youtube.com/@ethanandisabella4098" target="_blank">EthanUnlocked's gaming hits</a>, claim 7-day free trial! (One-time only)</p>
            <button id="claim-trial">Claim Free Trial</button>
        </div>
        <div id="payment-form">
            <input type="text" id="card-name" placeholder="Cardholder Name">
            <input type="text" id="card-number" placeholder="Card Number">
            <input type="text" id="card-expiry" placeholder="MM/YY">
            <input type="text" id="card-cvv" placeholder="CVV">
            <button id="confirm-payment">Confirm Payment</button>
        </div>
        <div id="mobile-payment" class="mobile-payment" style="display: none;">
            <p>Confirm your purchase with Face ID or Touch ID</p>
            <button id="mobile-confirm">Confirm with Face ID</button>
            <button id="touch-confirm" style="display: none;">Confirm with Touch ID</button>
        </div>
    </div>
</div>

<button id="menu-button"></button>
<div class="menu-options" style="display: none;">
    <div id="help-option" class="menu-option" data-text="Help"></div>
    <div id="catch-option" class="menu-option" data-text="Catch a Pokémon"></div>
    <div id="guess-option" class="menu-option" data-text="Guess the Pokémon"></div>
    <div id="battle-option" class="menu-option" data-text="Battle"></div>
    <div id="edit-option" class="menu-option admin-signed-in" data-text="Edit"></div>
    <div id="caught-option" class="menu-option" data-text="Show Caught Pokémon"></div>
</div>

<div class="top-navbar">
    <a href="https://ethanunlocked690.github.io/turtle.html">Back to others</a>
</div>

<div id="profile" style="cursor: pointer; width: 40px; height: 40px; background-size: cover; position: fixed; top: 10px; right: 10px; display: block; background-image: url(&quot;default-profile.png&quot;);"></div>

<h1>Pokédex</h1>

<div class="nav-container">
    <button class="nav-button active" data-category="all">All</button>
    <button class="nav-button" data-category="mega">Mega</button>
    <button class="nav-button" data-category="regional">Regional</button>
    <button class="nav-button" data-category="shiny">Shiny</button>
    <button class="nav-button" data-category="legendary">Legendary</button>
    <button class="nav-button" data-category="mythical">Mythical</button>
    <button class="nav-button" data-category="gmax">G-Max</button>
    <button class="nav-button" data-category="ultra-beast">Ultra Beast</button>
</div>

<div class="search-container">
    <input type="text" id="searchInput" placeholder="Search for a Pokémon...">
</div>

<p id="loadingMessage" class="error" style="display: block;">Failed to load Pokédex. Please check your connection or try again later.</p>
<button id="retryButton" style="display: block;">Retry</button>

<div id="pokedex-container" class="pokedex-container"></div>

<div id="pokemonModal" class="modal">
    <div class="modal-content">
        <span class="close-button">×</span>
        <div id="modal-body"></div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    const pokedexContainer = document.getElementById('pokedex-container');
    const searchInput = document.getElementById('searchInput');
    const loadingMessage = document.getElementById('loadingMessage');
    const retryButton = document.getElementById('retryButton');
    const pokemonModal = document.getElementById('pokemonModal');
    const modalBody = document.getElementById('modal-body');
    const navButtons = document.querySelectorAll('.nav-button');
    const menuButton = document.getElementById('menu-button');
    const menuOptions = document.querySelector('.menu-options');
    const loginModal = document.getElementById('login-modal');
    const loginOption = document.getElementById('login-option');
    const signupOption = document.getElementById('signup-option');
    const adminLoginOption = document.getElementById('admin-login-option');
    const loginForm = document.getElementById('login-form');
    const signupForm = document.getElementById('signup-form');
    const adminLoginForm = document.getElementById('admin-login-form');
    const loginButton = document.getElementById('login-button');
    const submitSignup = document.getElementById('submit-signup');
    const adminLoginButton = document.getElementById('admin-login-button');
    const profile = document.getElementById('profile');
    const profileModal = document.getElementById('profile-modal');
    const catchModal = document.getElementById('catch-modal');
    const berryButton = document.getElementById('berry-button');
    const pokeball = document.getElementById('pokeball');
    const dailyLeft = document.getElementById('daily-left');
    const payUnlimited = document.getElementById('pay-unlimited');
    const paymentModal = document.getElementById('payment-modal');
    const paymentForm = document.getElementById('payment-form');
    const mobilePayment = document.getElementById('mobile-payment');
    const confirmPayment = document.getElementById('confirm-payment');
    const mobileConfirm = document.getElementById('mobile-confirm');
    const touchConfirm = document.getElementById('touch-confirm');
    const battleModal = document.getElementById('battle-modal');
    const caughtPokemonModal = document.getElementById('caught-pokemon-modal');
    const helpModal = document.getElementById('help-modal');
    const guessModal = document.getElementById('guess-modal');
    const editModal = document.getElementById('edit-modal');
    const editOption = document.getElementById('edit-option');
    const claimTrial = document.getElementById('claim-trial');
    const cancelPremium = document.getElementById('cancel-premium');
    const trialSection = document.getElementById('trial-section');
    // Additional admin elements
    const applyBackground = document.getElementById('apply-background');
    const backgroundUpload = document.getElementById('background-upload');
    const addCustomPoke = document.getElementById('add-custom-poke');
    const customPokeName = document.getElementById('custom-poke-name');
    const customPokeTypes = document.getElementById('custom-poke-types');
    const customPokeId = document.getElementById('custom-poke-id');
    const customPokeImage = document.getElementById('custom-poke-image');
    const customPokeHeight = document.getElementById('custom-poke-height');
    const customPokeWeight = document.getElementById('custom-poke-weight');
    const customPokeAbilities = document.getElementById('custom-poke-abilities');
    const customPokeDescription = document.getElementById('custom-poke-description');
    const removePoke = document.getElementById('remove-poke');
    const removePokeName = document.getElementById('remove-poke-name');
    const applyAdditionalBg = document.getElementById('apply-additional-bg');
    const additionalBgUpload = document.getElementById('additional-bg-upload');
    const additionalBgPosition = document.getElementById('additional-bg-position');
    const removeElement = document.getElementById('remove-element');
    const removeElementId = document.getElementById('remove-element-id');
    const applyCustomCss = document.getElementById('apply-custom-css');
    const customCssRule = document.getElementById('custom-css-rule');
    const resetChanges = document.getElementById('reset-changes');

    let allPokemon = [];
    const cachedSpeciesData = {};
    const cachedVarietyData = {};
    const ULTRA_BEASTS = ['nihilego', 'buzzwole', 'pheromosa', 'xurkitree', 'celesteela', 'kartana', 'guzzlord', 'poipole', 'naganadel', 'stakataka', 'blacephalon'];
    let user = null;
    let caughtPokemon = [];
    let dailyCatches = 5;
    let isPremium = false;
    let loginTimestamp = null;
    let currentExtendWeeks = 1;
    // Custom admin storage keys
    let customPokemon = JSON.parse(localStorage.getItem('customPokemon')) || [];
    let blacklistedPokemon = JSON.parse(localStorage.getItem('blacklistedPokemon')) || [];
    let customBackgrounds = JSON.parse(localStorage.getItem('customBackgrounds')) || [];
    let customElements = JSON.parse(localStorage.getItem('customElements')) || [];
    let customCssRules = JSON.parse(localStorage.getItem('customCssRules')) || [];

    // Device detection for payment system
    const isMobileDevice = () => {
        return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
    };

    const users = JSON.parse(localStorage.getItem('users')) || {};
    const adminCredentials = { username: 'EthanUnlocked', password: 'Subscribe123!' };

    const getHolidayDiscount = () => {
        const now = new Date();
        const month = now.getMonth() + 1;
        const day = now.getDate();
        const holidays = {
            easter: { m: 4, d: 20, disc: 0.1 }, // Approx Easter 2025
            halloween: { m: 10, d: 31, disc: 0.3 },
            christmas: { m: 12, d: 25, disc: 0.5 }
        };
        for (let h in holidays) {
            let hol = holidays[h];
            if (month === hol.m && day === hol.d) {
                return hol.disc;
            }
        }
        if (month === 12 && day === 31) {
            return { special: true, price: 0.99, weeks: 4 };
        }
        return 0;
    };

    const getSpeciesNameFromVarietyName = (name) => {
        if (name.includes('-')) {
            return name.split('-')[0];
        }
        return name;
    };

    const getSpeciesData = async (pokemonIdOrName) => {
        const speciesName = getSpeciesNameFromVarietyName(pokemonIdOrName);
        if (cachedSpeciesData[speciesName]) return cachedSpeciesData[speciesName];
        try {
            const url = `https://pokeapi.co/api/v2/pokemon-species/${speciesName}`;
            const response = await fetch(url);
            if (!response.ok) {
                console.warn(`HTTP error fetching species ${speciesName}: ${response.status}`);
                return null;
            }
            const speciesData = await response.json();
            cachedSpeciesData[speciesName] = speciesData;
            return speciesData;
        } catch (error) {
            console.error(`Failed to fetch species data for ${speciesName}:`, error);
            return null;
        }
    };

    const getPokemonData = async (name) => {
        if (cachedVarietyData[name]) return cachedVarietyData[name];
        try {
            const url = `https://pokeapi.co/api/v2/pokemon/${name}`;
            const response = await fetch(url);
            if (!response.ok) throw new Error(`Failed to fetch variety data for ${name}`);
            const data = await response.json();
            cachedVarietyData[name] = data;
            return data;
        } catch (error) {
            console.error(`Failed to fetch variety data for ${name}:`, error);
            throw error;
        }
    };

    const getEvolutionChain = async (speciesData) => {
        if (!speciesData) return [];
        try {
            const response = await fetch(speciesData.evolution_chain.url);
            const data = await response.json();
            const chain = [];
            let current = data.chain;
            while (current) {
                const pokemonData = await getPokemonData(current.species.name);
                chain.push({ name: current.species.name, data: pokemonData });
                current = current.evolves_to[0];
            }
            return chain;
        } catch (error) {
            console.error('Failed to fetch evolution chain:', error);
            return [];
        }
    };

    const checkPremiumExpiry = () => {
        if (user && user.isPremium && user.premiumExpiry && Date.now() > user.premiumExpiry) {
            user.isPremium = false;
            isPremium = false;
            dailyCatches = 5;
            localStorage.setItem('currentUser', JSON.stringify(user));
            users[user.username] = user;
            localStorage.setItem('users', JSON.stringify(users));
        }
    };

    const fetchAllPokemon = async () => {
        loadingMessage.style.display = 'block';
        loadingMessage.textContent = 'Loading Pokédex...';
        loadingMessage.classList.remove('error');
        retryButton.style.display = 'none';
        pokedexContainer.innerHTML = '';

        try {
            const response = await fetch('https://pokeapi.co/api/v2/pokemon?limit=10000');
            if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
            const data = await response.json();

            const pokemonPromises = data.results.map(p => fetch(p.url).then(res => res.json()));
            allPokemon = await Promise.all(pokemonPromises);
            // Apply admin removals (blacklist)
            allPokemon = allPokemon.filter(p => !blacklistedPokemon.includes(p.name));
            // Add custom Pokémon from admin
            allPokemon = [...allPokemon, ...customPokemon];
            loadingMessage.style.display = 'none';
            filterAndDisplayPokemon('all');
        } catch (error) {
            console.error('Failed to fetch Pokémon data:', error);
            loadingMessage.textContent = 'Failed to load Pokédex. Please check your connection or try again later.';
            loadingMessage.classList.add('error');
            retryButton.style.display = 'block';
        }
    };

    const filterAndDisplayPokemon = async (category) => {
        pokedexContainer.innerHTML = '';
        loadingMessage.style.display = 'block';

        let currentPokemonToDisplay;
        switch (category) {
            case 'all': currentPokemonToDisplay = allPokemon; break;
            case 'mega': currentPokemonToDisplay = allPokemon.filter(p => p.name.includes('-mega') || p.name.includes('-primal')); break;
            case 'regional': currentPokemonToDisplay = allPokemon.filter(p => p.name.includes('-alola') || p.name.includes('-galar') || p.name.includes('-hisui')); break;
            case 'shiny': currentPokemonToDisplay = allPokemon.filter(p => p.sprites.front_shiny || p.sprites.other['official-artwork'].front_shiny); break;
            case 'legendary': 
                currentPokemonToDisplay = [];
                for (const p of allPokemon) {
                    const speciesData = await getSpeciesData(p.name);
                    if (speciesData?.is_legendary && !speciesData?.is_mythical) {
                        currentPokemonToDisplay.push(p);
                    }
                }
                break;
            case 'mythical': 
                currentPokemonToDisplay = [];
                for (const p of allPokemon) {
                    const speciesData = await getSpeciesData(p.name);
                    if (speciesData?.is_mythical) {
                        currentPokemonToDisplay.push(p);
                    }
                }
                break;
            case 'gmax': currentPokemonToDisplay = allPokemon.filter(p => p.name.includes('-gmax')); break;
            case 'ultra-beast': currentPokemonToDisplay = allPokemon.filter(p => ULTRA_BEASTS.includes(p.name)); break;
            default: currentPokemonToDisplay = allPokemon;
        }

        loadingMessage.style.display = 'none';
        displayPokemon(currentPokemonToDisplay, category);
    };

    const getPokemonImageUrl = (pokemon, isShiny = false) => {
        const name = pokemon.name;
        const isMegaOrPrimal = name.includes('-mega') || name.includes('-primal');
        const isRegional = name.includes('-alola') || name.includes('-galar') || name.includes('-hisui');
        const isGmax = name.includes('-gmax');

        if (isMegaOrPrimal || isRegional || isGmax) {
            return isShiny ? pokemon.sprites.other['official-artwork'].front_shiny : pokemon.sprites.other['official-artwork'].front_default;
        } else {
            const animatedSprites = pokemon.sprites.versions['generation-v']['black-white'].animated;
            const animatedUrl = isShiny ? animatedSprites.front_shiny : animatedSprites.front_default;
            return animatedUrl || pokemon.sprites.front_default;
        }
    };

    const displayPokemon = (pokemonList, category) => {
        pokedexContainer.innerHTML = '';
        const displayShiny = category === 'shiny';
        pokemonList.forEach(pokemon => {
            const pokemonCard = document.createElement('div');
            pokemonCard.classList.add('pokemon-card');
            pokemonCard.setAttribute('data-id', pokemon.id);

            const name = pokemon.name;
            const id = pokemon.id.toString().padStart(3, '0');
            const imageUrl = getPokemonImageUrl(pokemon, displayShiny);

            let displayName = name.replace(/-gmax|-amped/, '').replace(/-mega-x/, ' Mega X').replace(/-mega-y/, ' Mega Y').replace(/-mega/, ' Mega').replace(/-primal/, ' Primal').replace(/-alola/, ' Alola').replace(/-galar/, ' Galar').replace(/-hisui/, ' Hisui').replace(/-battle-bond/, '').replace(/-original-cap/, '');

            pokemonCard.innerHTML = `
                <div class="pokemon-id">#${id}</div>
                <img src="${imageUrl}" alt="${name}">
                <h2 class="pokemon-name">${displayName}</h2>
                <div class="pokemon-types">
                    ${pokemon.types.map(typeInfo => `<span class="type ${typeInfo.type.name}">${typeInfo.type.name}</span>`).join('')}
                </div>
            `;
            pokedexContainer.appendChild(pokemonCard);
        });
    };

    const fetchTcgCard = async (pokemonName) => {
        try {
            const searchName = pokemonName.split('-')[0];
            const url = `https://api.pokemontcg.io/v2/cards?q=name:${searchName}`;
            const response = await fetch(url);
            const data = await response.json();
            return data.data.length > 0 ? data.data[0].images.large : null;
        } catch (error) {
            console.error('Failed to fetch TCG card:', error);
            return null;
        }
    };

    const getAttackSound = async (pokemon) => {
        try {
            const move = pokemon.moves[0]?.move.name || 'tackle';
            return `https://play.pokemonshowdown.com/audio/cries/${move}.mp3`;
        } catch {
            return null;
        }
    };

    const showPokemonDetails = async (pokemon, isShiny = false) => {
        try {
            const speciesName = getSpeciesNameFromVarietyName(pokemon.name);
            const speciesData = await getSpeciesData(speciesName);
            if (!speciesData) throw new Error(`No species data for ${speciesName}`);
            const varieties = await Promise.all(speciesData.varieties.map(v => getPokemonData(v.pokemon.name)));
            const evolutionChain = await getEvolutionChain(speciesData);
            renderModalContent(pokemon, speciesData, varieties, isShiny, evolutionChain);
            pokemonModal.style.display = 'block';

            const modalImage = document.querySelector('#modal-body .modal-image');
            const modalAudio = document.querySelector('#pokemon-cry');
            const attackSound = await getAttackSound(pokemon);
            modalAudio.src = attackSound || `https://play.pokemonshowdown.com/audio/cries/${speciesName}.mp3`;

            modalImage.addEventListener('click', () => {
                modalImage.classList.remove('attack');
                void modalImage.offsetWidth;
                modalImage.classList.add('attack');
                modalAudio.currentTime = 0;
                modalAudio.play();
            });

            const tcgCardSection = document.getElementById('tcg-card-section');
            if (tcgCardSection) {
                tcgCardSection.innerHTML = '<p class="card-loading">Loading TCG card...</p>';
                const tcgCardUrl = await fetchTcgCard(pokemon.name);
                tcgCardSection.innerHTML = tcgCardUrl ? `
                    <h4>Trading Card</h4>
                    <img src="${tcgCardUrl}" alt="${pokemon.name} TCG Card">
                ` : `<h4>Trading Card</h4><p class="card-loading">No TCG card found.</p>`;
            }

            const evolutionItems = document.querySelectorAll('.evolution-item');
            evolutionItems.forEach(item => {
                item.addEventListener('click', async () => {
                    const evoName = item.getAttribute('data-name');
                    const evoPokemon = allPokemon.find(p => p.name === evoName);
                    if (evoPokemon) {
                        showPokemonDetails(evoPokemon, isShiny);
                    }
                });
            });
        } catch (error) {
            console.error('Error in showPokemonDetails:', error);
            alert('Failed to load Pokémon details. Please try again.');
        }
    };

    const getVarietyButtonName = (varietyName) => {
        if (varietyName.includes('-mega-x')) return 'Mega X';
        if (varietyName.includes('-mega-y')) return 'Mega Y';
        if (varietyName.includes('-mega')) return 'Mega';
        if (varietyName.includes('-primal')) return 'Primal';
        if (varietyName.includes('-gmax')) return 'G-Max';
        if (varietyName.includes('-alola')) return 'Alolan';
        if (varietyName.includes('-galar')) return 'Galarian';
        if (varietyName.includes('-hisui')) return 'Hisuian';
        return 'Normal';
    };

    const renderModalContent = (pokemon, speciesData, varieties, isShiny = false, evolutionChain) => {
        const name = pokemon.name;
        const id = pokemon.id.toString().padStart(3, '0');
        const types = pokemon.types.map(typeInfo => typeInfo.type.name);
        const height = (pokemon.height / 10).toFixed(1);
        const weight = (pokemon.weight / 10).toFixed(1);
        const abilities = pokemon.abilities.map(abilityInfo => abilityInfo.ability.name).join(', ');
        const stats = pokemon.stats.map(statInfo => ({
            name: statInfo.stat.name.replace('-', ' '),
            value: statInfo.base_stat
        }));
        const imageUrl = getPokemonImageUrl(pokemon, isShiny);
        const descriptionEntry = speciesData.flavor_text_entries.find(entry => entry.language.name === 'en' && entry.version.name === 'omega-ruby');
        const description = descriptionEntry ? descriptionEntry.flavor_text.replace(/\n/g, ' ') : 'No description available.';
        const origin = speciesData.generation ? speciesData.generation.name.replace('generation-', '') : 'Unknown';

        const megaForms = varieties.filter(v => v.name.includes('-mega') || v.name.includes('-primal'));
        const regionalForms = varieties.filter(v => v.name.includes('-alola') || v.name.includes('-galar') || v.name.includes('-hisui'));
        const gmaxForms = varieties.filter(v => v.name.includes('-gmax'));
        const normalForm = varieties.find(v => !v.name.includes('-') || v.name === 'basculin-red-striped' || v.name === 'minior-red-meteor');

        const renderButtons = (forms, currentName) => {
            if (forms.length === 0) return '';
            return forms.map(v => {
                const buttonName = getVarietyButtonName(v.name);
                const isActive = v.name === currentName;
                return `<button class="variety-button ${isActive ? 'active' : ''}" data-variety-name="${v.name}">${buttonName}</button>`;
            }).join('');
        };

        const renderEvolutionChain = () => {
            if (!evolutionChain || evolutionChain.length === 0) return '';
            return `
                <div class="evolution-section">
                    <h4>Evolution Chain</h4>
                    <div class="evolution-chain">
                        ${evolutionChain.map(evo => `
                            <div class="evolution-item ${evo.name === pokemon.name ? 'current' : ''}" data-name="${evo.name}">
                                <img src="${getPokemonImageUrl(evo.data)}" alt="${evo.name}">
                                <div class="evolution-name">${evo.name}</div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        };

        const isCurrentlyShiny = isShiny ? 'active' : '';

        modalBody.innerHTML = `
            <div class="modal-info">
                <img src="${imageUrl}" alt="${name}" class="modal-image">
                <h2 class="modal-name">${name.replace(/-gmax|-amped/, '').replace(/-mega-x/, ' Mega X').replace(/-mega-y/, ' Mega Y').replace(/-mega/, ' Mega').replace(/-primal/, ' Primal').replace(/-alola/, ' Alola').replace(/-galar/, ' Galar').replace(/-hisui/, ' Hisui').replace(/-battle-bond/, '').replace(/-original-cap/, '')}</h2>
                <div class="modal-id">#${id}</div>
                <div class="modal-types">
                    ${types.map(type => `<span class="type ${type}">${type}</span>`).join('')}
                </div>
                <p class="description">"${description}"</p>
                <div class="variety-section normal-forms">
                    <h4>Normal Form</h4>
                    <div class="variety-buttons">
                        ${normalForm ? `<button class="variety-button ${!name.includes('-') ? 'active' : ''}" data-variety-name="${normalForm.name}">Normal</button>` : ''}
                    </div>
                </div>
                ${megaForms.length > 0 ? `
                    <div class="variety-section mega-forms">
                        <h4>Mega Forms</h4>
                        <div class="variety-buttons">
                            ${renderButtons(megaForms, name)}
                        </div>
                    </div>` : ''}
                ${regionalForms.length > 0 ? `
                    <div class="variety-section regional-forms">
                        <h4>Regional Forms</h4>
                        <div class="variety-buttons">
                            ${renderButtons(regionalForms, name)}
                        </div>
                    </div>` : ''}
                ${gmaxForms.length > 0 ? `
                    <div class="variety-section gmax-forms">
                        <h4>G-Max Forms</h4>
                        <div class="variety-buttons">
                            ${renderButtons(gmaxForms, name)}
                        </div>
                    </div>` : ''}
                <div class="variety-section shiny-toggle">
                    <h4>Appearance</h4>
                    <div class="variety-buttons">
                        <button class="variety-button shiny-button ${isCurrentlyShiny}" data-variety-name="shiny">Shiny</button>
                    </div>
                </div>
                <div class="details">
                    <p><strong>Origin:</strong> ${origin.toUpperCase()}</p>
                    <p><strong>Height:</strong> ${height} m</p>
                    <p><strong>Weight:</strong> ${weight} kg</p>
                    <p><strong>Abilities:</strong> ${abilities}</p>
                </div>
                <h3>Base Stats</h3>
                <ul class="stats-list">
                    ${stats.map(stat => `<li><span>${stat.name}</span><span>${stat.value}</span></li>`).join('')}
                </ul>
                <div id="tcg-card-section" class="tcg-card-section"></div>
                ${renderEvolutionChain()}
            </div>
            <audio id="pokemon-cry" preload="auto"></audio>
        `;
    };

    const checkLoginTimeout = () => {
        if (loginTimestamp && (Date.now() - loginTimestamp) > 7 * 24 * 60 * 60 * 1000) {
            user = null;
            localStorage.removeItem('currentUser');
            loginModal.style.display = 'block';
            profile.style.display = 'none';
            showLoginForm();
        }
    };

    const showLoginForm = () => {
        loginForm.style.display = 'block';
        signupForm.style.display = 'none';
        adminLoginForm.style.display = 'none';
        loginOption.style.background = '#c2000d';
        signupOption.style.background = '#e4000f';
        adminLoginOption.style.background = '#e4000f';
    };

    const showAdminLoginForm = () => {
        adminLoginForm.style.display = 'block';
        loginForm.style.display = 'none';
        signupForm.style.display = 'none';
        adminLoginOption.style.background = '#c2000d';
        loginOption.style.background = '#e4000f';
        signupOption.style.background = '#e4000f';
    };

    // Login functionality
    loginOption.addEventListener('click', showLoginForm);

    signupOption.addEventListener('click', () => {
        signupForm.style.display = 'block';
        loginForm.style.display = 'none';
        adminLoginForm.style.display = 'none';
        signupOption.style.background = '#c2000d';
        loginOption.style.background = '#e4000f';
        adminLoginOption.style.background = '#e4000f';
    });

    adminLoginOption.addEventListener('click', showAdminLoginForm);

    loginButton.addEventListener('click', () => {
        const username = document.getElementById('username').value;
        const password = document.getElementById('password').value;
        if (users[username] && users[username].password === password) {
            user = users[username];
            user.isAdmin = false;
            user.caught = user.caught || [];
            user.messages = user.messages || [];
            user.onlineStatus = user.onlineStatus || 'Online';
            user.trialUsed = user.trialUsed || false;
            user.isPremium = user.isPremium || false;
            user.premiumExpiry = user.premiumExpiry || null;
            editOption.classList.remove('admin-signed-in');
            localStorage.setItem('currentUser', JSON.stringify(user));
            loginTimestamp = Date.now();
            localStorage.setItem('loginTimestamp', loginTimestamp);
            loginModal.style.display = 'none';
            profile.style.backgroundImage = `url(${user.profilePic})`;
            profile.style.display = 'block';
            isPremium = user.isPremium;
            if (isPremium) dailyCatches = Infinity;
            checkPremiumExpiry();
            caughtPokemon = user.caught.map(name => allPokemon.find(p => p.name === name)).filter(Boolean);
            fetchAllPokemon();
        } else {
            alert('Invalid credentials');
        }
    });

    adminLoginButton.addEventListener('click', () => {
        const username = document.getElementById('admin-username').value;
        const password = document.getElementById('admin-password').value;
        if (username === adminCredentials.username && password === adminCredentials.password) {
            user = { username, isAdmin: true, profilePic: 'default-profile.png', profileName: 'Admin', age: 18, caught: [], messages: [], onlineStatus: 'Online', trialUsed: false, isPremium: false, premiumExpiry: null };
            editOption.classList.add('admin-signed-in');
            localStorage.setItem('currentUser', JSON.stringify(user));
            loginTimestamp = Date.now();
            localStorage.setItem('loginTimestamp', loginTimestamp);
            loginModal.style.display = 'none';
            profile.style.backgroundImage = `url(${user.profilePic})`;
            profile.style.display = 'block';
            checkPremiumExpiry();
            fetchAllPokemon();
        } else {
            alert('Invalid admin credentials');
        }
    });

    submitSignup.addEventListener('click', () => {
        const username = document.getElementById('signup-name').value;
        const password = document.getElementById('signup-password').value;
        const profileName = document.getElementById('profile-name').value;
        const age = parseInt(document.getElementById('signup-age').value);
        const profilePic = document.getElementById('profile-pic').files[0];
        const galleryPic = document.getElementById('profile-gallery').value;

        const inappropriateWords = ['badword1', 'badword2'];
        if (inappropriateWords.some(word => profileName.toLowerCase().includes(word))) {
            alert('Inappropriate profile name. Account banned for 3 days.');
            return;
        }

        if (isNaN(age) || age < 13) {
            alert('You must be at least 13 years old to sign up.');
            return;
        }

        if (users[username]) {
            alert('Username already exists');
            return;
        }

        const profilePicUrl = profilePic ? URL.createObjectURL(profilePic) : galleryPic;
        users[username] = {
            username,
            password,
            profileName,
            age,
            profilePic: profilePicUrl,
            caught: [],
            messages: [],
            onlineStatus: 'Online',
            trialUsed: false,
            isPremium: false,
            premiumExpiry: null
        };
        localStorage.setItem('users', JSON.stringify(users));
        alert('Sign up successful! Please log in.');
        signupForm.style.display = 'none';
        loginForm.style.display = 'block';
        loginOption.style.background = '#c2000d';
        signupOption.style.background = '#e4000f';
        adminLoginOption.style.background = '#e4000f';
    });

    // Profile functionality
    profile.addEventListener('click', () => {
        if (!user) {
            alert('Please log in first!');
            return;
        }
        document.getElementById('premium-status').textContent = isPremium ? 'Yes' : 'No';
        document.getElementById('caught-count').textContent = user.caught ? user.caught.length : 0;
        document.getElementById('daily-catches').textContent = isPremium ? '∞' : dailyCatches;
        if (isPremium) {
            cancelPremium.style.display = 'block';
        } else {
            cancelPremium.style.display = 'none';
        }
        profileModal.style.display = 'block';
    });

    cancelPremium.addEventListener('click', () => {
        if (confirm('Are you sure you want to cancel your premium subscription? You can resubscribe anytime.')) {
            user.isPremium = false;
            user.premiumExpiry = null;
            isPremium = false;
            dailyCatches = 5;
            localStorage.setItem('currentUser', JSON.stringify(user));
            users[user.username] = user;
            localStorage.setItem('users', JSON.stringify(users));
            alert('Premium subscription cancelled.');
            document.getElementById('premium-status').textContent = 'No';
            document.getElementById('daily-catches').textContent = '5';
            cancelPremium.style.display = 'none';
        }
    });

    // Menu functionality
    menuButton.addEventListener('click', () => {
        menuOptions.style.display = menuOptions.style.display === 'flex' ? 'none' : 'flex';
    });

    document.getElementById('help-option').addEventListener('click', () => {
        helpModal.style.display = 'block';
        menuOptions.style.display = 'none';
    });

    document.getElementById('catch-option').addEventListener('click', () => {
        catchModal.style.display = 'block';
        menuOptions.style.display = 'none';
        dailyLeft.textContent = isPremium ? '∞' : dailyCatches;
        spawnRandomPokemon();
    });

    document.getElementById('guess-option').addEventListener('click', () => {
        guessModal.style.display = 'block';
        menuOptions.style.display = 'none';
        startGuessGame();
    });

    document.getElementById('battle-option').addEventListener('click', () => {
        battleModal.style.display = 'block';
        menuOptions.style.display = 'none';
    });

    editOption.addEventListener('click', () => {
        if (user && user.isAdmin) {
            editModal.style.display = 'block';
            menuOptions.style.display = 'none';
        } else {
            loginModal.style.display = 'block';
            showAdminLoginForm();
        }
    });

    document.getElementById('caught-option').addEventListener('click', () => {
        displayCaughtPokemon();
        caughtPokemonModal.style.display = 'block';
        menuOptions.style.display = 'none';
    });

    // Team Rocket battle
    document.getElementById('team-rocket').addEventListener('click', () => {
        alert('Battling Team Rocket! Prepare for trouble!');
        // Additional battle logic can be added here if needed
    });

    // Catch Pokemon functionality
    const spawnRandomPokemon = () => {
        const randomPokemon = allPokemon[Math.floor(Math.random() * allPokemon.length)];
        const pokemonArea = document.getElementById('pokemon-area');
        pokemonArea.innerHTML = `
            <img src="${getPokemonImageUrl(randomPokemon)}" 
                 alt="${randomPokemon.name}" 
                 style="width: 100px; height: 100px; position: absolute; top: 20px; left: 50%; transform: translateX(-50%);"
                 data-pokemon-id="${randomPokemon.id}">
        `;
    };

    let isDragging = false;

    pokeball.addEventListener('mousedown', (e) => {
        isDragging = true;
        pokeball.classList.add('dragging');
        e.preventDefault();
    });

    document.addEventListener('mousemove', (e) => {
        if (isDragging) {
            const rect = document.getElementById('catch-content').getBoundingClientRect();
            const x = e.clientX - rect.left - 30;
            const y = e.clientY - rect.top - 30;
            pokeball.style.left = `${x}px`;
            pokeball.style.top = `${y}px`;
            pokeball.style.transform = 'none';
        }
    });

    document.addEventListener('mouseup', () => {
        if (isDragging) {
            isDragging = false;
            pokeball.classList.remove('dragging');
            
            const pokemonImg = document.querySelector('#pokemon-area img');
            if (pokemonImg) {
                const pokemonRect = pokemonImg.getBoundingClientRect();
                const ballRect = pokeball.getBoundingClientRect();
                
                const distance = Math.sqrt(
                    Math.pow(pokemonRect.left - ballRect.left, 2) + 
                    Math.pow(pokemonRect.top - ballRect.top, 2)
                );
                
                if (distance < 100) {
                    attemptCatch(pokemonImg);
                } else {
                    resetPokeball();
                }
            }
        }
    });

    const attemptCatch = (pokemonImg) => {
        pokeball.classList.add('shake');
        setTimeout(() => {
            pokeball.classList.remove('shake');
            const catchSuccess = Math.random() > 0.5;
            
            if ((isPremium || dailyCatches > 0) && catchSuccess) {
                const pokemonId = pokemonImg.dataset.pokemonId;
                const pokemon = allPokemon.find(p => p.id == pokemonId);
                caughtPokemon.push(pokemon);
                if (!isPremium && dailyCatches !== Infinity) {
                    dailyCatches--;
                    dailyLeft.textContent = dailyCatches;
                }
                alert(`Congratulations! You caught ${pokemon.name}!`);
                pokemonImg.style.display = 'none';
                
                if (user) {
                    user.caught = user.caught || [];
                    user.caught.push(pokemon.name);
                    users[user.username].caught = user.caught;
                    localStorage.setItem('users', JSON.stringify(users));
                    localStorage.setItem('currentUser', JSON.stringify(user));
                }
            } else if (!isPremium && dailyCatches <= 0) {
                alert('No daily catches left! Consider upgrading to premium.');
            } else {
                alert('Oh no! The Pokémon escaped! Try again!');
            }
            resetPokeball();
        }, 1000);
    };

    const resetPokeball = () => {
        pokeball.style.left = '50%';
        pokeball.style.top = '';
        pokeball.style.transform = 'translateX(-50%)';
    };

    berryButton.addEventListener('click', () => {
        alert('You used a berry! The Pokémon is easier to catch now.');
        // Optionally, you can increase the catch success rate here.
    });

    payUnlimited.addEventListener('click', () => {
        paymentModal.style.display = 'block';
        let discount = getHolidayDiscount();
        let price = 20;
        if (typeof discount === 'object' && discount.special) {
            price = discount.price;
            document.getElementById('weekly-price').innerHTML = `<strong>$${price}/4 weeks (New Year Special!)</strong>`;
        } else if (discount > 0) {
            price = price - price * discount;
            document.getElementById('weekly-price').innerHTML = `<strong>$${price.toFixed(2)}/week (Holiday Discount!)</strong>`;
        } else {
            document.getElementById('weekly-price').innerHTML = `<strong>$20/week</strong>`;
        }
        // Show trial if not used
        if (user && !user.trialUsed) {
            trialSection.style.display = 'block';
        } else {
            trialSection.style.display = 'none';
        }
    });

    claimTrial.addEventListener('click', () => {
        if (user && !user.trialUsed) {
            user.isPremium = true;
            user.trialUsed = true;
            user.premiumExpiry = Date.now() + 7 * 24 * 60 * 60 * 1000; // 7 days
            isPremium = true;
            dailyCatches = Infinity;
            localStorage.setItem('currentUser', JSON.stringify(user));
            users[user.username] = user;
            localStorage.setItem('users', JSON.stringify(users));
            alert('Free trial activated! Enjoy 7 days of premium.');
            paymentModal.style.display = 'none';
        }
    });

    confirmPayment.addEventListener('click', () => {
        // Payment validation logic would go here (omitted for demo)
        if (user) {
            user.isPremium = true;
            user.premiumExpiry = Date.now() + 7 * 24 * 60 * 60 * 1000 * currentExtendWeeks;
            isPremium = true;
            dailyCatches = Infinity;
            localStorage.setItem('currentUser', JSON.stringify(user));
            users[user.username] = user;
            localStorage.setItem('users', JSON.stringify(users));
            alert('Thank you for subscribing to premium!');
            paymentModal.style.display = 'none';
        }
    });

    mobileConfirm.addEventListener('click', () => {
        confirmPayment.click();
    });

    // Modal close handlers
    document.querySelectorAll('.close-button').forEach(btn => {
        btn.addEventListener('click', (e) => {
            e.target.closest('.modal').style.display = 'none';
            if (e.target.closest('#login-modal')) {
                // Optionally reset to login option
                showLoginForm();
            }
        });
    });

    // Modal click outside to close
    window.onclick = function(event) {
        document.querySelectorAll('.modal').forEach(modal => {
            if (event.target == modal) {
                modal.style.display = 'none';
            }
        });
    };

    // Search functionality
    searchInput.addEventListener('input', () => {
        const search = searchInput.value.toLowerCase().trim();
        const filtered = allPokemon.filter(p => p.name.includes(search));
        displayPokemon(filtered, 'all');
    });

    // Navigation category buttons
    navButtons.forEach(btn => {
        btn.addEventListener('click', async function() {
            navButtons.forEach(b => b.classList.remove('active'));
            this.classList.add('active');
            await filterAndDisplayPokemon(this.dataset.category);
        });
    });

    // Pokémon card click for modal
    pokedexContainer.addEventListener('click', async (e) => {
        const card = e.target.closest('.pokemon-card');
        if (card) {
            const id = card.dataset.id;
            const pokemon = allPokemon.find(p => p.id == id);
            if (pokemon) showPokemonDetails(pokemon);
        }
    });

    // Variety and shiny buttons in modal
    modalBody.addEventListener('click', async (e) => {
        if (e.target.classList.contains('variety-button')) {
            const varietyName = e.target.dataset.varietyName;
            const isShiny = e.target.classList.contains('shiny-button');
            let pokemonToShow;
            if (isShiny) {
                const name = document.querySelector('.modal-info .modal-name').textContent.toLowerCase().replace(/ /g, '-');
                pokemonToShow = allPokemon.find(p => p.name === name) || allPokemon.find(p => p.name === varietyName) || allPokemon[0];
                showPokemonDetails(pokemonToShow, true);
            } else {
                pokemonToShow = allPokemon.find(p => p.name === varietyName);
                showPokemonDetails(pokemonToShow, false);
            }
        }
    });

    // Guess the Pokémon game logic
    function startGuessGame() {
        const guessImage = document.getElementById('guess-image');
        const guessInput = document.getElementById('guess-input');
        const guessSubmit = document.getElementById('guess-submit');

        const pokemon = allPokemon[Math.floor(Math.random() * allPokemon.length)];
        guessImage.innerHTML = `<img src="${getPokemonImageUrl(pokemon)}" alt="Guess" style="filter: brightness(0) saturate(100%); width:150px; height:150px;">`;

        guessSubmit.onclick = () => {
            if (guessInput.value.trim().toLowerCase() === pokemon.name) {
                guessImage.innerHTML = `<img src="${getPokemonImageUrl(pokemon)}" alt="${pokemon.name}" style="width:150px; height:150px;">`;
                alert(`Correct! It's ${pokemon.name}!`);
            } else {
                alert('Try again!');
            }
        };
    }

    // Display caught Pokémon
    function displayCaughtPokemon() {
        const caughtList = document.getElementById('caught-list');
        if (!user || !user.caught || user.caught.length === 0) {
            caughtList.innerHTML = '<p>You have not caught any Pokémon yet!</p>';
            return;
        }
        caughtList.innerHTML = user.caught.map(name => {
            const poke = allPokemon.find(p => p.name === name);
            if (!poke) return '';
            return `
                <div style="display: inline-block; margin: 10px; text-align: center;">
                    <img src="${getPokemonImageUrl(poke)}" style="width: 60px; height: 60px;">
                    <div>${poke.name}</div>
                </div>
            `;
        }).join('');
    }

    // Apply stored custom changes on load
    function applyCustomChanges() {
        // Apply custom background
        const customBg = localStorage.getItem('customBackground');
        if (customBg) {
            document.body.style.backgroundImage = `url('${customBg}'), url('pokedex-top.png'), url('pokedex-bottom.png')`;
        }
        // Apply additional backgrounds
        customBackgrounds.forEach(bg => {
            document.body.style.backgroundImage += `, url('${bg.url}')`;
            document.body.style.backgroundPosition += `, ${bg.position}`;
        });
        // Apply custom CSS rules
        const styleSheet = document.createElement('style');
        styleSheet.innerText = customCssRules.join('\n');
        document.head.appendChild(styleSheet);
        // Apply custom elements (if any, e.g., images)
        customElements.forEach(el => {
            const img = document.createElement('img');
            img.src = el.url;
            img.style.position = 'fixed';
            img.style[el.position.split(' ')[0]] = '0';
            img.style[el.position.split(' ')[1]] = '0';
            img.id = el.id;
            document.body.appendChild(img);
        });
    }

    // Admin change listeners
    if (applyBackground) {
        applyBackground.addEventListener('click', () => {
            const file = backgroundUpload.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    const base64 = e.target.result;
                    document.body.style.backgroundImage = `url('${base64}'), url('pokedex-top.png'), url('pokedex-bottom.png')`;
                    localStorage.setItem('customBackground', base64);
                    alert('Background applied and saved permanently!');
                };
                reader.readAsDataURL(file);
            }
        });
    }

    if (addCustomPoke) {
        addCustomPoke.addEventListener('click', () => {
            const name = customPokeName.value.trim();
            const types = customPokeTypes.value.split(',').map(t => ({ type: { name: t.trim() } }));
            const id = parseInt(customPokeId.value);
            const height = parseInt(customPokeHeight.value);
            const weight = parseInt(customPokeWeight.value);
            const abilities = customPokeAbilities.value.split(',').map(a => ({ ability: { name: a.trim() } }));
            const description = customPokeDescription.value;
            const file = customPokeImage.files[0];

            if (name && types.length && id && file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    const imageBase64 = e.target.result;
                    const newPoke = {
                        name,
                        id,
                        types,
                        height,
                        weight,
                        abilities,
                        sprites: { front_default: imageBase64, other: { 'official-artwork': { front_default: imageBase64 } } },
                        stats: [], // Default empty, can add more
                        moves: [] // Default empty
                    };
                    customPokemon.push(newPoke);
                    localStorage.setItem('customPokemon', JSON.stringify(customPokemon));
                    allPokemon.push(newPoke);
                    filterAndDisplayPokemon('all');
                    alert(`Custom Pokémon ${name} added permanently!`);
                };
                reader.readAsDataURL(file);
            } else {
                alert('Please fill all fields!');
            }
        });
    }

    if (removePoke) {
        removePoke.addEventListener('click', () => {
            const name = removePokeName.value.trim().toLowerCase();
            if (name) {
                blacklistedPokemon.push(name);
                localStorage.setItem('blacklistedPokemon', JSON.stringify(blacklistedPokemon));
                allPokemon = allPokemon.filter(p => p.name.toLowerCase() !== name);
                filterAndDisplayPokemon('all');
                alert(`Pokémon ${name} removed permanently!`);
            }
        });
    }

    if (applyAdditionalBg) {
        applyAdditionalBg.addEventListener('click', () => {
            const file = additionalBgUpload.files[0];
            const position = additionalBgPosition.value.trim();
            if (file && position) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    const base64 = e.target.result;
                    document.body.style.backgroundImage += `, url('${base64}')`;
                    document.body.style.backgroundPosition += `, ${position}`;
                    customBackgrounds.push({ url: base64, position });
                    localStorage.setItem('customBackgrounds', JSON.stringify(customBackgrounds));
                    alert('Additional background applied and saved permanently!');
                };
                reader.readAsDataURL(file);
            }
        });
    }

    if (removeElement) {
        removeElement.addEventListener('click', () => {
            const id = removeElementId.value.trim();
            if (id) {
                const el = document.getElementById(id);
                if (el) el.remove();
                customElements = customElements.filter(e => e.id !== id);
                localStorage.setItem('customElements', JSON.stringify(customElements));
                alert(`Element ${id} removed permanently!`);
            }
        });
    }

    if (applyCustomCss) {
        applyCustomCss.addEventListener('click', () => {
            const rule = customCssRule.value.trim();
            if (rule) {
                const styleSheet = document.createElement('style');
                styleSheet.innerText = rule;
                document.head.appendChild(styleSheet);
                customCssRules.push(rule);
                localStorage.setItem('customCssRules', JSON.stringify(customCssRules));
                alert('Custom CSS applied and saved permanently!');
            }
        });
    }

    if (resetChanges) {
        resetChanges.addEventListener('click', () => {
            if (confirm('Reset all custom changes? This is permanent.')) {
                localStorage.removeItem('customBackground');
                localStorage.removeItem('customPokemon');
                localStorage.removeItem('blacklistedPokemon');
                localStorage.removeItem('customBackgrounds');
                localStorage.removeItem('customElements');
                localStorage.removeItem('customCssRules');
                location.reload();
            }
        });
    }

    // On load: restore user session if any and load pokedex
    function init() {
        // Try to restore session
        const loggedInUser = localStorage.getItem('currentUser');
        if (loggedInUser) {
            user = JSON.parse(loggedInUser);
            isPremium = user.isPremium;
            profile.style.backgroundImage = `url(${user.profilePic})`;
            profile.style.display = 'block';
            loginTimestamp = parseInt(localStorage.getItem('loginTimestamp'), 10) || Date.now();
            checkPremiumExpiry();
        } else {
            loginModal.style.display = 'block';
        }
        applyCustomChanges();
        fetchAllPokemon();
    }

    init();
});
</script>


</body></html>
