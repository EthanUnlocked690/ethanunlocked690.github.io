<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pokédex - The Ultimate Version</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* General Body Styles */
        body {
            font-family: 'Roboto Mono', monospace;
            background-color: #f0f0f0;
            color: #333;
            margin: 0;
            padding: 20px;
            text-align: center;
        }

        h1 {
            color: #e4000f;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        #loadingMessage {
            font-size: 1.2rem;
            color: #555;
            display: none; /* Initially hidden */
        }

        /* Navigation Bar */
        .nav-container {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            margin-bottom: 20px;
            gap: 10px;
        }

        .nav-button {
            background-color: #333;
            color: #fff;
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            font-family: 'Roboto Mono', monospace;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .nav-button:hover,
        .nav-button.active {
            background-color: #e4000f;
        }

        /* Search Bar */
        .search-container {
            margin-bottom: 20px;
        }

        #searchInput {
            width: 80%;
            max-width: 400px;
            padding: 10px 15px;
            border: 2px solid #ccc;
            border-radius: 25px;
            font-size: 16px;
            font-family: 'Roboto Mono', monospace;
            outline: none;
            transition: border-color 0.3s;
        }

        #searchInput:focus {
            border-color: #e4000f;
        }

        /* Pokédex Container (Grid) */
        .pokedex-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }

        /* Pokémon Card */
        .pokemon-card {
            background-color: #fff;
            border-radius: 15px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            padding: 20px;
            text-align: center;
            transition: transform 0.2s, box-shadow 0.2s;
            cursor: pointer;
        }

        .pokemon-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 16px rgba(0,0,0,0.2);
        }

        .pokemon-card .pokemon-id {
            font-size: 14px;
            color: #888;
            font-weight: bold;
        }

        .pokemon-card img {
            width: 150px;
            height: 150px;
            margin: 10px auto;
            display: block;
        }

        .pokemon-card .pokemon-name {
            margin: 15px 0 10px;
            font-size: 22px;
            font-weight: bold;
            text-transform: capitalize;
        }

        /* Types Container */
        .pokemon-types {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 10px;
        }

        .type {
            padding: 5px 15px;
            border-radius: 15px;
            color: white;
            font-size: 14px;
            text-transform: uppercase;
            font-weight: bold;
        }

        /* Pokémon Type Colors */
        .type.normal { background-color: #A8A77A; }
        .type.fire { background-color: #EE8130; }
        .type.water { background-color: #6390F0; }
        .type.electric { background-color: #F7D02C; }
        .type.grass { background-color: #7AC74C; }
        .type.ice { background-color: #96D9D6; }
        .type.fighting { background-color: #C22E28; }
        .type.poison { background-color: #A33EA1; }
        .type.ground { background-color: #E2BF65; }
        .type.flying { background-color: #A98FF3; }
        .type.psychic { background-color: #F95587; }
        .type.bug { background-color: #A6B91A; }
        .type.rock { background-color: #B6A136; }
        .type.ghost { background-color: #735797; }
        .type.dragon { background-color: #6F35FC; }
        .type.dark { background-color: #705746; }
        .type.steel { background-color: #B7B7CE; }
        .type.fairy { background-color: #D685AD; }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.4);
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background-color: #fff;
            margin: 10% auto;
            padding: 30px;
            border: 1px solid #888;
            width: 80%;
            max-width: 600px;
            border-radius: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            position: relative;
            animation-name: animatetop;
            animation-duration: 0.4s;
            text-align: left;
        }

        @keyframes animatetop {
            from {top: -300px; opacity: 0}
            to {top: 0; opacity: 1}
        }

        .close-button {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .close-button:hover,
        .close-button:focus {
            color: black;
            text-decoration: none;
        }

        .modal-info h2 {
            text-align: center;
            text-transform: capitalize;
            font-size: 2.5rem;
            margin-top: 0;
        }

        .modal-info .modal-id {
            font-size: 1.5rem;
            color: #888;
            text-align: center;
        }

        .modal-info .modal-image {
            display: block;
            margin: 0 auto 20px;
            width: 200px;
            height: 200px;
            cursor: pointer;
        }

        /* Attack Animation */
        .modal-image.attack {
            animation: attack-pulse 0.5s ease-in-out;
        }

        @keyframes attack-pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1) translateX(-5px); }
            100% { transform: scale(1); }
        }

        .modal-info .modal-types {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
        }

        .modal-info .details p {
            margin: 5px 0;
        }
        
        .modal-info .description {
            margin-top: 20px;
            font-style: italic;
            text-align: justify;
        }

        .modal-info .stats-list {
            list-style-type: none;
            padding: 0;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .modal-info .stats-list li {
            background-color: #f5f5f5;
            padding: 10px;
            border-radius: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-info .stats-list span:first-child {
            font-weight: bold;
            text-transform: uppercase;
        }
        
        /* Variety Button Styles */
        .variety-section {
            margin-top: 20px;
        }
        .variety-section h4 {
            margin-bottom: 10px;
            font-size: 1.2rem;
            color: #555;
            border-bottom: 2px solid #ddd;
            padding-bottom: 5px;
        }
        .variety-buttons {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 10px;
        }
        .variety-button {
            background-color: #6390F0;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            font-family: 'Roboto Mono', monospace;
            font-size: 14px;
            transition: background-color 0.3s;
        }
        .variety-button.active {
            background-color: #3f65b8;
        }
    </style>
</head>
<body>

    <h1>Pokédex</h1>

    <div class="nav-container">
        <button class="nav-button active" data-category="all">All</button>
        <button class="nav-button" data-category="mega">Mega</button>
        <button class="nav-button" data-category="shiny">Shiny</button>
        <button class="nav-button" data-category="legendary">Legendary</button>
        <button class="nav-button" data-category="mythical">Mythical</button>
        <button class="nav-button" data-category="gmax">G-Max</button>
    </div>

    <div class="search-container">
        <input type="text" id="searchInput" placeholder="Search for a Pokémon...">
    </div>

    <p id="loadingMessage">Loading Pokédex...</p>

    <div id="pokedex-container" class="pokedex-container">
        </div>

    <div id="pokemonModal" class="modal">
        <div class="modal-content">
            <span class="close-button">&times;</span>
            <div id="modal-body">
                </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const pokedexContainer = document.getElementById('pokedex-container');
            const searchInput = document.getElementById('searchInput');
            const loadingMessage = document.getElementById('loadingMessage');
            const pokemonModal = document.getElementById('pokemonModal');
            const modalBody = document.getElementById('modal-body');
            const closeModal = document.querySelector('.close-button');
            const navButtons = document.querySelectorAll('.nav-button');

            let allPokemon = [];
            const cachedSpeciesData = {};
            const cachedVarietyData = {};

            const gmaxPokemonList = [
                "charizard-gmax", "butterfree-gmax", "pikachu-gmax", "meowth-gmax", "machamp-gmax",
                "gengar-gmax", "kingler-gmax", "lapras-gmax", "eevee-gmax", "snorlax-gmax",
                "garbodor-gmax", "melmetal-gmax", "corviknight-gmax", "orbeetle-gmax", "drednaw-gmax",
                "coalossal-gmax", "flapple-gmax", "appletun-gmax", "sandaconda-gmax", "toxtricity-amped-gmax",
                "centiskorch-gmax", "hatterene-gmax", "grimmsnarl-gmax", "alcremie-gmax", "copperajah-gmax",
                "duraludon-gmax", "venusaur-gmax", "blastoise-gmax", "rillaboom-gmax", "cinderace-gmax",
                "inteleon-gmax", "urshifu-single-strike-gmax", "urshifu-rapid-strike-gmax"
            ];

            const getSpeciesData = async (pokemonId) => {
                const speciesId = String(pokemonId).includes('-') ? pokemonId.split('-')[0] : pokemonId;
                if (cachedSpeciesData[speciesId]) {
                    return cachedSpeciesData[speciesId];
                }
                try {
                    const url = `https://pokeapi.co/api/v2/pokemon-species/${speciesId}`;
                    const response = await fetch(url);
                    const speciesData = await response.json();
                    cachedSpeciesData[speciesId] = speciesData;
                    return speciesData;
                } catch (error) {
                    console.error(`Failed to fetch species data for ID ${speciesId}:`, error);
                    return null;
                }
            };
            
            const getPokemonData = async (name) => {
                if (cachedVarietyData[name]) {
                    return cachedVarietyData[name];
                }
                try {
                    const url = `https://pokeapi.co/api/v2/pokemon/${name}`;
                    const response = await fetch(url);
                    const data = await response.json();
                    cachedVarietyData[name] = data;
                    return data;
                } catch (error) {
                    console.error(`Failed to fetch variety data for ${name}:`, error);
                    return null;
                }
            };

            const fetchAllPokemon = async () => {
                loadingMessage.style.display = 'block';
                try {
                    const response = await fetch('https://pokeapi.co/api/v2/pokemon?limit=10000');
                    const data = await response.json();
                    
                    const pokemonPromises = data.results.map(p => fetch(p.url).then(res => res.json()));
                    allPokemon = await Promise.all(pokemonPromises);
                    
                    const speciesPromises = allPokemon.map(p => getSpeciesData(p.id));
                    await Promise.all(speciesPromises);
                    
                    loadingMessage.style.display = 'none';
                    filterAndDisplayPokemon('all');
                } catch (error) {
                    console.error('Failed to fetch Pokémon data:', error);
                    loadingMessage.textContent = 'Failed to load Pokédex. Please try again later.';
                }
            };
            
            const filterAndDisplayPokemon = async (category) => {
                pokedexContainer.innerHTML = '';
                loadingMessage.style.display = 'block';

                let currentPokemonToDisplay;
                switch (category) {
                    case 'all':
                        currentPokemonToDisplay = allPokemon;
                        break;
                    case 'mega':
                        currentPokemonToDisplay = allPokemon.filter(p => p.name.includes('-mega') || p.name.includes('-primal'));
                        break;
                    case 'shiny':
                        currentPokemonToDisplay = allPokemon;
                        break;
                    case 'legendary':
                        currentPokemonToDisplay = allPokemon.filter(p => {
                            const species = cachedSpeciesData[p.id];
                            return species && species.is_legendary && !species.is_mythical;
                        });
                        break;
                    case 'mythical':
                        currentPokemonToDisplay = allPokemon.filter(p => {
                            const species = cachedSpeciesData[p.id];
                            return species && species.is_mythical;
                        });
                        break;
                    case 'gmax':
                        currentPokemonToDisplay = allPokemon.filter(p => gmaxPokemonList.includes(p.name));
                        break;
                    default:
                         currentPokemonToDisplay = allPokemon;
                        break;
                }
                
                loadingMessage.style.display = 'none';
                displayPokemon(currentPokemonToDisplay, category);
            };

            const getPokemonImageUrl = (pokemonName, isShiny = false) => {
                const baseShowdownUrl = 'https://play.pokemonshowdown.com/sprites/gen5ani';
                const baseShowdownShinyUrl = 'https://play.pokemonshowdown.com/sprites/gen5ani-shiny';
                const baseUrl = isShiny ? baseShowdownShinyUrl : baseShowdownUrl;
                const normalizedName = pokemonName.replace('♀', '-f').replace('♂', '-m');

                // Special handling for Mega, Primal, and G-Max forms
                if (normalizedName.includes('-mega') || normalizedName.includes('-primal') || normalizedName.includes('-gmax')) {
                    return `${baseUrl}/${normalizedName}.gif`;
                }
                 // Special handling for regional forms and other special forms
                const specialForms = [
                    '-alola', '-galar', '-hisui', '-cosplay', '-libre', '-luchador', '-phd', '-belle', '-heart-trim',
                    '-star-trim', '-ribbon-trim', '-dandy', '-gorgeous', '-kabuki', '-senjitsu', '-elite', '-totem',
                    '-hero', '-zenith', '-sky', '-sunny', '-rainy', '-snowy', '-blaze', '-aqua', '-pa-alola', '-original',
                    '-spiky-eared', '-therian', '-incarnate', '-resolute', '-pirouette', '-ordinary', '-aria', '-elect',
                    '-pau', '-pom-pom', '-rock-ruff', '-unbound', '-ash', '-meadow', '-sensu', '-baile', '-hangry',
                    '-full-belly', '-school', '-solo', '-busted', '-dada', '-crowned', '-amped', '-low-key',
                    '-single-strike', '-rapid-strike', '-ice', '-dark', '-ghost', '-fighting', '-bug', '-ground',
                    '-fire', '-water', '-grass', '-electric', '-psychic', '-rock', '-steel', '-fairy', '-poison',
                    '-dragon', '-flying', '-female', '-male', '-battle-bond', '-original-cap', '-dusk'
                ];
                for (const form of specialForms) {
                    if (normalizedName.includes(form)) {
                        return `${baseUrl}/${normalizedName}.gif`;
                    }
                }

                // Fallback to the original PokéAPI sprites
                return `https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/versions/generation-v/black-white/animated/${isShiny ? 'shiny/' : ''}${pokemonName}.gif`;
            };

            const displayPokemon = (pokemonList, category) => {
                pokedexContainer.innerHTML = '';
                pokemonList.forEach(pokemon => {
                    const pokemonCard = document.createElement('div');
                    pokemonCard.classList.add('pokemon-card');
                    pokemonCard.setAttribute('data-id', pokemon.id);

                    const name = pokemon.name;
                    const id = pokemon.id.toString().padStart(3, '0');
                    const imageUrl = getPokemonImageUrl(name, category === 'shiny');

                    let displayName;
                    if (category === 'mega' || category === 'gmax') {
                        displayName = name;
                    } else {
                        displayName = name.replace(/-gmax|-amped/, '').replace(/-mega-x|-mega-y|-mega|-primal/, '').replace(/-alola|-galar|-hisui/, '').replace(/-battle-bond/, '').replace(/-original-cap/, '');
                    }
                    
                    pokemonCard.innerHTML = `
                        <div class="pokemon-id">#${id}</div>
                        <img src="${imageUrl}" alt="${name}">
                        <h2 class="pokemon-name">${displayName}</h2>
                        <div class="pokemon-types">
                            ${pokemon.types.map(typeInfo => `<span class="type ${typeInfo.type.name}">${typeInfo.type.name}</span>`).join('')}
                        </div>
                    `;
                    pokedexContainer.appendChild(pokemonCard);
                });
            };

            const showPokemonDetails = async (pokemon) => {
                const speciesId = pokemon.name.includes('-gmax') ? pokemon.name.split('-')[0] : pokemon.id;
                const speciesData = await getSpeciesData(speciesId);
                const varieties = await Promise.all(speciesData.varieties.map(v => getPokemonData(v.pokemon.name)));
                
                renderModalContent(pokemon, speciesData, varieties);
                pokemonModal.style.display = 'block';

                const modalImage = document.querySelector('#modal-body .modal-image');
                const modalAudio = document.querySelector('#pokemon-cry');
                const baseName = pokemon.name.split('-')[0];
                modalAudio.src = `https://play.pokemonshowdown.com/audio/cries/${baseName}.mp3`;

                modalImage.addEventListener('click', () => {
                    modalImage.classList.remove('attack');
                    void modalImage.offsetWidth; 
                    modalImage.classList.add('attack');
                    
                    modalAudio.currentTime = 0;
                    modalAudio.play();
                });
            };

            const getVarietyButtonName = (varietyName) => {
                if (varietyName.includes('-mega-x')) return 'Mega X';
                if (varietyName.includes('-mega-y')) return 'Mega Y';
                if (varietyName.includes('-mega')) return 'Mega';
                if (varietyName.includes('-primal')) return 'Primal';
                if (varietyName.includes('-gmax')) return 'G-Max';
                if (varietyName.includes('-alola')) return 'Alolan';
                if (varietyName.includes('-galar')) return 'Galarian';
                if (varietyName.includes('-hisui')) return 'Hisuian';
                
                return 'Normal';
            };
            
            const renderModalContent = (pokemon, speciesData, varieties, isShiny = false) => {
                const name = pokemon.name;
                const id = pokemon.id.toString().padStart(3, '0');
                const types = pokemon.types.map(typeInfo => typeInfo.type.name);
                const height = (pokemon.height / 10).toFixed(1);
                const weight = (pokemon.weight / 10).toFixed(1);
                const abilities = pokemon.abilities.map(abilityInfo => abilityInfo.ability.name).join(', ');
                const stats = pokemon.stats.map(statInfo => ({
                    name: statInfo.stat.name.replace('-', ' '),
                    value: statInfo.base_stat
                }));
                
                const imageUrl = getPokemonImageUrl(name, isShiny);
               
                const descriptionEntry = speciesData.flavor_text_entries.find(entry => entry.language.name === 'en' && entry.version.name === 'omega-ruby');
                const description = descriptionEntry ? descriptionEntry.flavor_text.replace(/\n/g, ' ') : 'No description available.';
                const origin = speciesData.generation ? speciesData.generation.name.replace('generation-', '') : 'Unknown';

                const megaForms = varieties.filter(v => v.name.includes('-mega') || v.name.includes('-primal'));
                const regionalForms = varieties.filter(v => v.name.includes('-alola') || v.name.includes('-galar') || v.name.includes('-hisui'));
                const gmaxForms = varieties.filter(v => v.name.includes('-gmax'));
                const normalForm = varieties.find(v => !v.name.includes('-') || v.name === 'basculin-red-striped' || v.name === 'minior-red-meteor');

                const renderButtons = (forms) => {
                    if (forms.length === 0) return '';
                    return forms.map(v => {
                        const buttonName = getVarietyButtonName(v.name);
                        const isActive = v.name === pokemon.name;
                        return `<button class="variety-button ${isActive ? 'active' : ''}" data-variety-name="${v.name}">${buttonName}</button>`;
                    }).join('');
                };

                const isCurrentlyShiny = isShiny ? 'active' : '';

                modalBody.innerHTML = `
                    <div class="modal-info">
                        <img src="${imageUrl}" alt="${name}" class="modal-image">
                        <h2 class="modal-name">${name.replace(/-gmax|-amped/, '').replace(/-mega-x|-mega-y|-mega|-primal/, '').replace(/-alola|-galar|-hisui/, '').replace(/-battle-bond/, '').replace(/-original-cap/, '')}</h2>
                        <div class="modal-id">#${id}</div>
                        <div class="modal-types">
                            ${types.map(type => `<span class="type ${type}">${type}</span>`).join('')}
                        </div>
                        <p class="description">"${description}"</p>
                        
                        <div class="variety-section normal-forms">
                           <h4>Normal Form</h4>
                           <div class="variety-buttons">
                               <button class="variety-button ${!name.includes('-') ? 'active' : ''}" data-variety-name="${normalForm.name}">Normal</button>
                           </div>
                        </div>

                        ${megaForms.length > 0 ? `
                        <div class="variety-section mega-forms">
                           <h4>Mega Forms</h4>
                           <div class="variety-buttons">
                               ${renderButtons(megaForms)}
                           </div>
                        </div>` : ''}
                        
                        ${regionalForms.length > 0 ? `
                        <div class="variety-section regional-forms">
                           <h4>Regional Forms</h4>
                           <div class="variety-buttons">
                               ${renderButtons(regionalForms)}
                           </div>
                        </div>` : ''}

                        ${gmaxForms.length > 0 ? `
                        <div class="variety-section gmax-forms">
                           <h4>G-Max Forms</h4>
                           <div class="variety-buttons">
                               ${renderButtons(gmaxForms)}
                           </div>
                        </div>` : ''}

                        <div class="variety-section shiny-toggle">
                            <h4>Appearance</h4>
                            <div class="variety-buttons">
                                <button class="variety-button ${isCurrentlyShiny}" data-variety-name="shiny">Shiny</button>
                            </div>
                        </div>

                        <div class="details">
                            <p><strong>Origin:</strong> ${origin.toUpperCase()}</p>
                            <p><strong>Height:</strong> ${height} m</p>
                            <p><strong>Weight:</strong> ${weight} kg</p>
                            <p><strong>Abilities:</strong> ${abilities}</p>
                        </div>
                        <h3>Base Stats</h3>
                        <ul class="stats-list">
                            ${stats.map(stat => `<li><span>${stat.name}</span><span>${stat.value}</span></li>`).join('')}
                        </ul>
                    </div>
                    <audio id="pokemon-cry" preload="auto"></audio>
                `;
            };

            pokedexContainer.addEventListener('click', (e) => {
                const card = e.target.closest('.pokemon-card');
                if (card) {
                    const pokemonId = card.getAttribute('data-id');
                    const selectedPokemon = allPokemon.find(p => p.id == pokemonId);
                    if (selectedPokemon) {
                        showPokemonDetails(selectedPokemon);
                    }
                }
            });

            modalBody.addEventListener('click', async (e) => {
                const button = e.target.closest('.variety-button');
                if (button) {
                    const varietyName = button.dataset.varietyName;
                    
                    if (varietyName === 'shiny') {
                        const currentName = document.querySelector('.modal-image').alt;
                        const currentPokemonData = await getPokemonData(currentName);
                        const speciesData = await getSpeciesData(currentPokemonData.id);
                        const varieties = await Promise.all(speciesData.varieties.map(v => getPokemonData(v.pokemon.name)));
                        renderModalContent(currentPokemonData, speciesData, varieties, true);
                    } else {
                        const pokemonData = await getPokemonData(varietyName);
                        const speciesData = await getSpeciesData(pokemonData.id);
                        const varieties = await Promise.all(speciesData.varieties.map(v => getPokemonData(v.pokemon.name)));
                        renderModalContent(pokemonData, speciesData, varieties);
                    }
                }
            });

            closeModal.addEventListener('click', () => {
                pokemonModal.style.display = 'none';
            });

            window.addEventListener('click', (e) => {
                if (e.target === pokemonModal) {
                    pokemonModal.style.display = 'none';
                }
            });

            searchInput.addEventListener('input', (e) => {
                const searchTerm = e.target.value.toLowerCase();
                const currentCategory = document.querySelector('.nav-button.active').dataset.category;
                const filteredPokemon = allPokemon.filter(pokemon => {
                    const isNameMatch = pokemon.name.toLowerCase().includes(searchTerm);
                    const isIdMatch = pokemon.id.toString().includes(searchTerm);
                    return isNameMatch || isIdMatch;
                });
                displayPokemon(filteredPokemon, currentCategory);
            });

            navButtons.forEach(button => {
                button.addEventListener('click', () => {
                    navButtons.forEach(btn => btn.classList.remove('active'));
                    button.classList.add('active');
                    const category = button.getAttribute('data-category');
                    filterAndDisplayPokemon(category);
                });
            });

            fetchAllPokemon();
        });
    </script>
</body>
</html>
