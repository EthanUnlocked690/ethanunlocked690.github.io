<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gaming Club UI Architect</title>
    <style>
        /* =======================================
           ADVANCED CSS STYLES (Embedded)
           ======================================= */

        /* 1. CSS Variables for Theming */
        :root {
            --color-primary: #ff3377; /* Highlight Pink */
            --color-secondary: #00ffc8; /* Aqua/Neon Green */
            --color-background: #0d1117; /* Dark Background */
            --canvas-bg: #161b22; /* Canvas color */
            --tool-bg: #0d1117;
            --tool-border: #2d333b;
            --font-stack: 'Montserrat', sans-serif;
            --element-fill: #21262d; /* Default Card Fill */
        }

        /* Base Layout */
        body {
            display: flex;
            font-family: var(--font-stack);
            background-color: var(--color-background);
            color: var(--color-secondary);
            margin: 0;
            min-height: 100vh;
        }

        /* 2. Layout Sections */
        #ui-canvas {
            flex-grow: 1;
            position: relative;
            overflow: hidden;
            background-color: var(--canvas-bg);
            border: 5px dashed var(--color-secondary);
        }

        #design-tools {
            width: 300px;
            background-color: var(--tool-bg);
            padding: 20px;
            box-shadow: -4px 0 10px rgba(0, 0, 0, 0.5);
            border-left: 1px solid var(--tool-border);
            overflow-y: auto;
            flex-shrink: 0;
        }

        .tool-header {
            color: var(--color-primary);
            border-bottom: 1px solid var(--tool-border);
            padding-bottom: 5px;
            margin-top: 20px;
        }

        /* Buttons & Inputs */
        button {
            background-color: var(--color-primary);
            color: #fff;
            border: none;
            padding: 10px 15px;
            margin: 5px 0;
            width: 100%;
            cursor: pointer;
            transition: background-color 0.2s;
            font-weight: bold;
            border-radius: 4px;
        }

        button:hover {
            background-color: #ff5599;
        }
        
        /* Dynamic Property Pane */
        #property-pane label {
            display: block;
            margin-top: 10px;
            color: var(--color-secondary);
        }

        /* 3. SVG Element Styling and Interactivity */
        .ui-element {
            /* This makes the elements look like standard UI boxes */
            fill: var(--element-fill); 
            stroke: var(--color-secondary);
            stroke-width: 2px;
            fill-opacity: 0.9;
            cursor: grab;
        }
        
        /* Specific element visual differentiation */
        .ui-element[data-type="roster-panel"] {
            stroke: #4CAF50; /* Green */
        }
        .ui-element[data-type="leaderboard"] {
            stroke: #2196F3; /* Blue */
        }
        .ui-element[data-type="stream-overlay"] {
            fill: rgba(255, 51, 119, 0.1);
            stroke: var(--color-primary);
            stroke-dasharray: 8, 4;
            stroke-width: 3px;
        }


        /* Selection and Dragging State */
        .ui-element.is-selected {
            stroke: var(--color-primary);
            stroke-width: 4px;
            filter: drop-shadow(0 0 8px var(--color-primary));
        }

        .ui-element.is-dragging {
            cursor: grabbing;
            opacity: 0.7;
        }

        /* 4. Resizing Handles */
        .resize-handle {
            fill: var(--color-secondary);
            stroke: #fff;
            stroke-width: 2px;
            cursor: nwse-resize; 
            opacity: 0; 
            transition: opacity 0.2s;
        }

        .is-selected ~ .resize-handle {
            opacity: 1; 
        }
        
        .resize-handle[data-handle="n"], .resize-handle[data-handle="s"] { cursor: ns-resize; }
        .resize-handle[data-handle="e"], .resize-handle[data-handle="w"] { cursor: ew-resize; }
        
        /* 5. Rotation Handle */
        .rotate-handle {
            fill: var(--color-primary);
            stroke: #fff;
            stroke-width: 2px;
            cursor: grab; 
            opacity: 0;
            transition: opacity 0.2s;
        }

        .is-selected ~ .rotate-handle {
            opacity: 1;
        }
    </style>
</head>
<body>

    <main id="ui-canvas" role="region" aria-label="Gaming Club UI Design Viewport">
        <svg id="ui-svg-viewport" viewBox="0 0 1200 800" style="width: 100%; height: 100%;">
            <g id="designer-elements">
                <rect data-element-id="base" width="1200" height="800" fill="var(--canvas-bg)" data-type="base-layer"></rect>
                
                <g id="selection-group"></g>
            </g>
        </svg>
    </main>
    
    <aside id="design-tools" aria-label="Gaming UI Tools">
        <h2 class="tool-header">Add Gaming Components</h2>
        <div class="tool-group">
            <button data-action="add-element" data-element-type="roster-panel">Add Roster Panel üë•</button>
            <button data-action="add-element" data-element-type="leaderboard">Add Leaderboard üèÜ</button>
            <button data-action="add-element" data-element-type="news-feed">Add News Feed üì∞</button>
            <button data-action="add-element" data-element-type="recruitment-form">Add Recruitment Form üìù</button>
            <button data-action="add-element" data-element-type="stream-overlay">Add Stream Overlay Zone üì∫</button>
        </div>

        <h2 class="tool-header">Element Properties</h2>
        <div id="property-pane">
            <p id="no-selection-message">Select an element to edit its properties.</p>
        </div>
        
        <h2 class="tool-header">Layout Controls</h2>
        <footer>
            <button id="export-json">Export Layout Data</button>
            <button id="delete-element" disabled>Delete Selected</button>
        </footer>
    </aside>


    <script>
        // =======================================
        // ADVANCED JAVASCRIPT LOGIC (REUSED/ADAPTED)
        // =======================================
        
        // --- 1. Global State Management ---
        const uiState = {
            elements: [
                // Initial example element
                { id: 'lb-1', type: 'leaderboard', x: 50, y: 50, width: 300, height: 400, style: { fill: '#21262d', opacity: 0.9 }, rotation: 0, removable: true },
            ],
            selectedElementId: null,
            // Configuration for new elements
            newElementConfig: {
                'roster-panel': { type: 'rect', defaultW: 250, defaultH: 350, defaultFill: '#21262d' },
                'leaderboard': { type: 'rect', defaultW: 400, defaultH: 500, defaultFill: '#21262d' },
                'news-feed': { type: 'rect', defaultW: 300, defaultH: 200, defaultFill: '#21262d' },
                'recruitment-form': { type: 'rect', defaultW: 450, defaultH: 300, defaultFill: '#21262d' },
                'stream-overlay': { type: 'rect', defaultW: 800, defaultH: 500, defaultFill: 'rgba(255, 51, 119, 0.1)' },
            }
        };

        // --- 2. DOM Elements and Constants ---
        const canvas = document.getElementById('ui-svg-viewport');
        const designerElements = document.getElementById('designer-elements');
        const selectionGroup = document.getElementById('selection-group');
        const propertyPane = document.getElementById('property-pane');
        const designTools = document.getElementById('design-tools');
        
        // Interaction State Variables
        let activeElement = null; 
        let activeState = null;   
        let initialMousePos = { x: 0, y: 0 };
        let initialElementBounds = {}; 
        let resizeHandleType = null;

        // --- 3. Core Utility Functions ---

        /** Converts screen coordinates to SVG coordinates */
        function screenToSvg(clientX, clientY) {
            const svgPoint = canvas.createSVGPoint();
            svgPoint.x = clientX;
            svgPoint.y = clientY;
            return svgPoint.matrixTransform(canvas.getScreenCTM().inverse());
        }

        /** Finds an element in the state by its ID */
        function getElementState(id) {
            return uiState.elements.find(el => el.id === id);
        }

        // --- 4. Rendering and Selection ---

        /** Renders all elements from the uiState to the SVG canvas. */
        function renderElements() {
            // Remove everything except the base layer and selection group
            designerElements.querySelectorAll('.ui-element').forEach(el => el.remove());
            
            uiState.elements.forEach(el => {
                if (el.type === 'base-layer') return;

                const svgEl = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
                
                // Add attributes from state
                svgEl.setAttribute('class', 'ui-element');
                svgEl.setAttribute('data-element-id', el.id);
                svgEl.setAttribute('data-type', el.type);

                svgEl.setAttribute('x', el.x);
                svgEl.setAttribute('y', el.y);
                svgEl.setAttribute('width', el.width);
                svgEl.setAttribute('height', el.height);
                svgEl.setAttribute('fill', el.style.fill);
                svgEl.style.opacity = el.style.opacity || 1;
                
                // Apply rotation transform
                svgEl.setAttribute('transform', `rotate(${el.rotation}, ${el.x + el.width / 2}, ${el.y + el.height / 2})`);

                designerElements.insertBefore(svgEl, selectionGroup); 
            });
            updateSelection();
        }

        /** Handles element selection and renders control handles. */
        function updateSelection() {
            designerElements.querySelectorAll('.ui-element').forEach(el => {
                el.classList.remove('is-selected');
            });

            selectionGroup.innerHTML = ''; // Clear previous handles

            if (!uiState.selectedElementId) {
                renderPropertyPane();
                document.getElementById('delete-element').disabled = true;
                return;
            }

            const state = getElementState(uiState.selectedElementId);
            const element = document.querySelector(`[data-element-id="${uiState.selectedElementId}"]`);
            
            if (element) {
                element.classList.add('is-selected');
                document.getElementById('delete-element').disabled = !state.removable;

                // 1. Selection Bounds Rectangle (Dashed border)
                const boundsRect = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
                boundsRect.setAttribute('x', state.x);
                boundsRect.setAttribute('y', state.y);
                boundsRect.setAttribute('width', state.width);
                boundsRect.setAttribute('height', state.height);
                boundsRect.setAttribute('fill', 'none');
                boundsRect.setAttribute('stroke', 'var(--color-primary)');
                boundsRect.setAttribute('stroke-dasharray', '5,5');
                boundsRect.setAttribute('stroke-width', '1');
                boundsRect.setAttribute('pointer-events', 'none'); 
                boundsRect.setAttribute('transform', `rotate(${state.rotation}, ${state.x + state.width / 2}, ${state.y + state.height / 2})`);
                selectionGroup.appendChild(boundsRect);

                // 2. Resizing Handles (8 points)
                const handles = [
                    { h: 'nw', x: state.x, y: state.y }, { h: 'n', x: state.x + state.width / 2, y: state.y },
                    { h: 'ne', x: state.x + state.width, y: state.y }, { h: 'e', x: state.x + state.width, y: state.y + state.height / 2 },
                    { h: 'se', x: state.x + state.width, y: state.y + state.height }, { h: 's', x: state.x + state.width / 2, y: state.y + state.height },
                    { h: 'sw', x: state.x, y: state.y + state.height }, { h: 'w', x: state.x, y: state.y + state.height / 2 }
                ];
                
                const center = { x: state.x + state.width / 2, y: state.y + state.height / 2 };

                handles.forEach(pos => {
                    const handle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                    handle.setAttribute('class', 'resize-handle');
                    handle.setAttribute('data-handle', pos.h);
                    handle.setAttribute('cx', pos.x);
                    handle.setAttribute('cy', pos.y);
                    handle.setAttribute('r', 5);
                    handle.setAttribute('transform', `rotate(${state.rotation}, ${center.x}, ${center.y})`);
                    selectionGroup.appendChild(handle);
                });
                
                // 3. Rotation Handle
                const rotateHandle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                const rotateY = state.y - 20; // 20px above the top edge
                rotateHandle.setAttribute('class', 'rotate-handle');
                rotateHandle.setAttribute('data-handle', 'rotate');
                rotateHandle.setAttribute('cx', center.x);
                rotateHandle.setAttribute('cy', rotateY);
                rotateHandle.setAttribute('r', 7);
                rotateHandle.setAttribute('transform', `rotate(${state.rotation}, ${center.x}, ${center.y})`);
                selectionGroup.appendChild(rotateHandle);
            }

            renderPropertyPane(state);
        }

        // --- 5. Dynamic Property Pane (Sidebar) ---

        /** Renders the dynamic property controls for the selected element. */
        function renderPropertyPane(state) {
            let html = '';
            
            if (!state) {
                propertyPane.innerHTML = `<p id="no-selection-message">Select an element to edit its properties.</p>`;
                return;
            }

            html += `
                <label>Component Type: **${state.type.toUpperCase().replace('-', ' ')}**</label>
                <label for="prop-fill-color">Fill Color</label>
                <input type="color" id="prop-fill-color" data-prop="style.fill" value="${state.style.fill || '#ffffff'}" style="width: 100%;">
                
                <label for="prop-opacity">Opacity: ${ (state.style.opacity * 100).toFixed(0) }%</label>
                <input type="range" id="prop-opacity" data-prop="style.opacity" min="0.1" max="1" step="0.05" value="${state.style.opacity || 0.9}">
                <label>X Position: ${state.x.toFixed(0)}</label>
                <label>Y Position: ${state.y.toFixed(0)}</label>
                <label>Rotation: ${state.rotation.toFixed(0)}¬∞</label>
            `;
            
            propertyPane.innerHTML = html;
        }

        /** Handles input changes in the property pane. */
        propertyPane.addEventListener('input', (e) => {
            if (!uiState.selectedElementId) return;
            const input = e.target;
            const prop = input.getAttribute('data-prop');
            const state = getElementState(uiState.selectedElementId);
            
            if (!prop) return;

            let value = input.value;
            if (input.type === 'range') value = parseFloat(value);
            
            // Handle nested properties (like style.fill)
            if (prop.includes('.')) {
                const parts = prop.split('.');
                state[parts[0]][parts[1]] = value;
            } else {
                state[prop] = value;
            }
            
            renderElements(); 
        });

        // --- 6. Interaction Handlers (Move, Resize, Rotate) ---
        
        canvas.addEventListener('mousedown', (e) => {
            const target = e.target;
            const svgPos = screenToSvg(e.clientX, e.clientY);
            initialMousePos = svgPos;
            
            if (target.classList.contains('resize-handle')) {
                activeState = 'resize';
                resizeHandleType = target.getAttribute('data-handle');
                const state = getElementState(uiState.selectedElementId);
                initialElementBounds = { ...state, centerX: state.x + state.width / 2, centerY: state.y + state.height / 2 };
                activeElement = document.querySelector(`[data-element-id="${uiState.selectedElementId}"]`);
                e.preventDefault(); 
                return;
            } 
            
            if (target.classList.contains('rotate-handle')) {
                activeState = 'rotate';
                const state = getElementState(uiState.selectedElementId);
                initialElementBounds = { ...state, centerX: state.x + state.width / 2, centerY: state.y + state.height / 2 };
                activeElement = document.querySelector(`[data-element-id="${uiState.selectedElementId}"]`);
                e.preventDefault();
                return;
            }

            const elementTarget = target.closest('.ui-element');
            if (elementTarget && elementTarget.getAttribute('data-type') !== 'base-layer') {
                uiState.selectedElementId = elementTarget.getAttribute('data-element-id');
                activeElement = elementTarget;
                activeState = 'move';
                activeElement.classList.add('is-dragging');

                const state = getElementState(uiState.selectedElementId);
                initialElementBounds = { x: state.x, y: state.y }; 
                initialMousePos = { x: svgPos.x - state.x, y: svgPos.y - state.y }; 

            } else {
                uiState.selectedElementId = null;
            }
            updateSelection();
        });

        window.addEventListener('mousemove', (e) => {
            if (!activeState) return;

            const svgPos = screenToSvg(e.clientX, e.clientY);
            const state = getElementState(uiState.selectedElementId);

            if (activeState === 'move') {
                state.x = svgPos.x - initialMousePos.x;
                state.y = svgPos.y - initialMousePos.y;
                
            } else if (activeState === 'resize') {
                
                let newX = initialElementBounds.x;
                let newY = initialElementBounds.y;
                let newW = initialElementBounds.width;
                let newH = initialElementBounds.height;

                const dx = svgPos.x - initialMousePos.x;
                const dy = svgPos.y - initialMousePos.y;

                if (resizeHandleType.includes('w')) { newX += dx; newW -= dx; }
                if (resizeHandleType.includes('e')) { newW += dx; }
                if (resizeHandleType.includes('n')) { newY += dy; newH -= dy; }
                if (resizeHandleType.includes('s')) { newH += dy; }
                
                if (newW > 10) { state.x = newX; state.width = newW; }
                if (newH > 10) { state.y = newY; state.height = newH; }

            } else if (activeState === 'rotate') {
                const center = { x: state.x + state.width / 2, y: state.y + state.height / 2 };
                
                const angleRad = Math.atan2(svgPos.y - center.y, svgPos.x - center.x);
                let angleDeg = angleRad * (180 / Math.PI) + 90; 
                
                if (angleDeg < 0) angleDeg += 360;
                
                // Snap to 15-degree increments
                state.rotation = Math.round(angleDeg / 15) * 15;
            }

            renderElements(); 
        });

        window.addEventListener('mouseup', () => {
            if (activeState === 'move' && activeElement) {
                activeElement.classList.remove('is-dragging');
            }
            activeState = null;
            activeElement = null;
            resizeHandleType = null;
            updateSelection(); 
        });


        // --- 7. Toolbar and Global Controls ---

        // Add new elements
        designTools.addEventListener('click', (e) => {
            const action = e.target.getAttribute('data-action');
            const type = e.target.getAttribute('data-element-type');

            if (action === 'add-element' && type) {
                const config = uiState.newElementConfig[type];
                if (!config) return;

                const newId = `${type}-${Date.now()}`;
                const newElement = {
                    id: newId,
                    type: type,
                    x: 100 + Math.random() * 50, // Slightly randomized initial position
                    y: 100 + Math.random() * 50,
                    width: config.defaultW,
                    height: config.defaultH,
                    style: { fill: config.defaultFill, opacity: 0.9 },
                    rotation: 0,
                    removable: true
                };

                uiState.elements.push(newElement);
                uiState.selectedElementId = newId;
                renderElements();
            }
        });
        
        // Delete selected element
        document.getElementById('delete-element').addEventListener('click', () => {
            const id = uiState.selectedElementId;
            const state = getElementState(id);
            if (!id || !state || !state.removable) return;

            uiState.elements = uiState.elements.filter(el => el.id !== id);
            uiState.selectedElementId = null;
            renderElements();
        });

        // Export Configuration
        document.getElementById('export-json').addEventListener('click', () => {
            // Only export the component data
            const exportData = uiState.elements.filter(el => el.type !== 'base-layer');
            const jsonOutput = JSON.stringify(exportData, null, 2);
            
            const blob = new Blob([jsonOutput], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'gaming_ui_layout.json';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            alert('Layout configuration exported successfully! (Check Downloads)');
        });


        // --- 8. Initialization ---
        document.addEventListener('DOMContentLoaded', () => {
            renderElements();
        });
    </script>
</body>
</html>
