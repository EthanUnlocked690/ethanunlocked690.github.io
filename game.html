<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Belt Blitz - Chore-Core Survival</title>
    <style>
        /* ========================================================= */
        /* CSS STYLES - CHORE-CORE SURVIVAL */
        /* ========================================================= */
        :root {
            --floor-color: #2c2c54;
            --wall-color: #3d3d6e;
            --player-color: #ffcc00;
            --mom-color: #ff3333;
            --chore-color: #00ff99;
            --boost-color: #33ccff;
            --font-family: 'Arial', sans-serif;
            --belt-pulse: 0.5s;
        }

        body {
            background-color: #1a1a37;
            color: white;
            font-family: var(--font-family);
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            overflow: hidden;
            perspective: 800px; /* 3D viewing distance */
        }

        .game-container {
            width: 90vw;
            height: 90vh;
            display: grid;
            grid-template-columns: 3fr 1fr; /* World and HUD */
            border: 5px solid var(--wall-color);
            box-shadow: 0 0 50px rgba(255, 51, 51, 0.4); /* Danger glow */
        }

        /* --- 3D Parkour World --- */
        #game-world {
            background-color: var(--floor-color);
            position: relative;
            transform-style: preserve-3d;
            transform: rotateX(45deg); /* Tilt the floor up for 3D effect */
            overflow: hidden;
        }

        /* --- Entities (Player, Mom, Chores) --- */
        .entity {
            position: absolute;
            width: 40px;
            height: 40px;
            text-align: center;
            line-height: 40px;
            font-weight: bold;
            border-radius: 50%;
            transition: transform 0.1s linear; /* Smooth movement */
            transform-style: preserve-3d;
        }

        #player {
            background-color: var(--player-color);
            z-index: 10;
            box-shadow: 0 0 15px var(--player-color);
        }
        
        #mom {
            background-color: var(--mom-color);
            z-index: 5;
            box-shadow: 0 0 20px var(--mom-color);
        }

        .chore {
            background-color: var(--chore-color);
            z-index: 8;
            border-radius: 5px;
            box-shadow: 0 0 10px var(--chore-color);
        }

        .boost {
            background-color: var(--boost-color);
            z-index: 8;
            border-radius: 50%;
            box-shadow: 0 0 10px var(--boost-color);
            animation: pulse-boost 1s infinite alternate;
        }

        /* Mom's danger aura */
        #mom.belt-ready {
            animation: belt-pulse var(--belt-pulse) infinite alternate;
        }

        @keyframes belt-pulse {
            from {
                box-shadow: 0 0 20px var(--mom-color);
            }
            to {
                box-shadow: 0 0 40px var(--mom-color);
                transform: scale(1.1);
            }
        }
        
        @keyframes pulse-boost {
            from { opacity: 1; }
            to { opacity: 0.5; }
        }

        /* --- Dashboard/HUD --- */
        #hud {
            background-color: var(--wall-color);
            padding: 20px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        #chores-list h3 {
            border-bottom: 2px dashed var(--chore-color);
            padding-bottom: 5px;
            margin-top: 0;
        }

        .chore-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }
        
        .chore-item.done {
            text-decoration: line-through;
            color: gray;
        }

        #status-display {
            font-size: 1.1em;
        }

        .stat-line {
            padding: 5px 0;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .danger-bar {
            background-color: #555;
            height: 20px;
            margin-top: 10px;
        }

        #idle-danger {
            width: 0%;
            height: 100%;
            background-color: var(--mom-color);
            transition: width 0.2s linear;
        }
    </style>
</head>
<body>

<div class="game-container">
    <div id="game-world">
        <div id="player" class="entity">P</div>
        <div id="mom" class="entity">M</div>
    </div>
    
    <div id="hud">
        <div id="chores-list">
            <h3>Chores Remaining</h3>
            </div>
        
        <div id="status-display">
            <div class="stat-line">Health: <span id="hp-value">100</span></div>
            <div class="stat-line">Speed: <span id="speed-value">5</span></div>
            <div class="stat-line">Score: <span id="score-value">0</span></div>
            
            <p>Idle Danger (2s limit):</p>
            <div class="danger-bar">
                <div id="idle-danger"></div>
            </div>
            
            <p id="game-message" style="color: var(--boost-color); font-weight: bold;"></p>
        </div>
    </div>
</div>

<script>
    // =========================================================
    //                          JAVASCRIPT LOGIC
    // =========================================================

    // --- Configuration & Global State ---
    const GAME_TICK = 100; // Physics update interval (ms)
    const MAX_IDLE_TIME = 2000; // 2 seconds idle limit
    const CHORE_RANGE = 50; // Distance to complete a chore
    
    let state = {
        running: false,
        lastUpdateTime: 0,
        player: { x: 50, y: 50, hp: 100, speed: 5, score: 0, dx: 0, dy: 0, isIdle: true, lastMoveTime: 0 },
        mom: { x: 200, y: 200, speed: 4, damage: 15, range: 60, isNear: false, lastStrikeTime: 0 },
        chores: [],
        boosts: [],
        activeKeys: {} // Tracks pressed keys for movement
    };
    
    // --- DOM Elements ---
    const $ = id => document.getElementById(id);
    const elements = {
        world: $('game-world'),
        playerEl: $('player'),
        momEl: $('mom'),
        hud: $('hud'),
        hpValue: $('hp-value'),
        speedValue: $('speed-value'),
        scoreValue: $('score-value'),
        idleDanger: $('idle-danger'),
        choresList: $('chores-list'),
        gameMessage: $('game-message')
    };

    // --- Core Game Classes ---
    
    class Chore {
        constructor(id, name, x, y) {
            this.id = id;
            this.name = name;
            this.x = x;
            this.y = y;
            this.isDone = false;
            this.element = this.createElement();
            state.chores.push(this);
        }
        
        createElement() {
            const el = document.createElement('div');
            el.className = 'entity chore';
            el.id = `chore-${this.id}`;
            el.textContent = this.name.charAt(0);
            elements.world.appendChild(el);
            
            // HUD item
            const listItem = document.createElement('div');
            listItem.id = `chore-list-${this.id}`;
            listItem.className = 'chore-item';
            listItem.innerHTML = `<span>${this.name}</span> <span style="color: var(--chore-color);">[${this.name.charAt(0)}]</span>`;
            elements.choresList.appendChild(listItem);

            return el;
        }

        updatePosition() {
            // Apply 3D transform based on location
            this.element.style.transform = `translate(${this.x}px, ${this.y}px) translateZ(0)`;
        }

        complete() {
            if (this.isDone) return;
            this.isDone = true;
            this.element.remove();
            $(`chore-list-${this.id}`).classList.add('done');
            state.player.score += 50;
            displayMessage(`Chore **${this.name}** DONE! (+50)`, 'var(--chore-color)');
            
            if (state.chores.every(c => c.isDone)) {
                endGame('VICTORY: All Chores Done! Mom\'s wrath is appeased.');
            }
        }
    }

    class Boost {
        constructor(id, type, x, y) {
            this.id = id;
            this.type = type; // 'speed' or 'health'
            this.x = x;
            this.y = y;
            this.element = this.createElement();
            state.boosts.push(this);
        }

        createElement() {
            const el = document.createElement('div');
            el.className = 'entity boost';
            el.id = `boost-${this.id}`;
            el.textContent = this.type === 'speed' ? 'S' : 'H';
            elements.world.appendChild(el);
            return el;
        }

        updatePosition() {
             this.element.style.transform = `translate(${this.x}px, ${this.y}px) translateZ(0)`;
        }

        collect() {
            if (this.type === 'speed') {
                state.player.speed += 2;
                displayMessage('SPEED BOOST! (+2 speed)', 'var(--boost-color)');
            } else if (this.type === 'health') {
                state.player.hp = Math.min(100, state.player.hp + 20);
                displayMessage('HEALTH RESTORED! (+20 HP)', 'var(--boost-color)');
            }
            this.element.remove();
            state.boosts = state.boosts.filter(b => b.id !== this.id);
        }
    }

    // --- Game Logic ---

    function initGame() {
        // Initial setup
        state.player.lastMoveTime = Date.now();
        state.mom.lastStrikeTime = Date.now();
        state.running = true;
        
        // Spawn Chores
        new Chore(1, 'Dishes', 100, 400);
        new Chore(2, 'Laundry', 500, 150);
        new Chore(3, 'Tidy Room', 700, 550);

        // Spawn Boosts
        new Boost(1, 'speed', 300, 500);
        new Boost(2, 'health', 600, 400);

        // Position Mom and Player
        state.player.x = elements.world.offsetWidth / 2;
        state.player.y = elements.world.offsetHeight / 2;
        state.mom.x = 0;
        state.mom.y = 0;

        // Start the physics and rendering loop
        gameLoop();
    }
    
    function displayMessage(text, color) {
        elements.gameMessage.textContent = text;
        elements.gameMessage.style.color = color;
        setTimeout(() => { elements.gameMessage.textContent = ''; }, 1000);
    }

    // --- Input Handling (WASD Movement) ---
    document.addEventListener('keydown', (e) => {
        if (!state.running) return;
        state.activeKeys[e.key.toLowerCase()] = true;
    });

    document.addEventListener('keyup', (e) => {
        if (!state.running) return;
        state.activeKeys[e.key.toLowerCase()] = false;
    });

    function handleMovement() {
        let dx = 0, dy = 0;
        const speed = state.player.speed;

        if (state.activeKeys['w'] || state.activeKeys['arrowup']) dy -= speed;
        if (state.activeKeys['s'] || state.activeKeys['arrowdown']) dy += speed;
        if (state.activeKeys['a'] || state.activeKeys['arrowleft']) dx -= speed;
        if (state.activeKeys['d'] || state.activeKeys['arrowright']) dx += speed;
        
        state.player.dx = dx;
        state.player.dy = dy;

        if (dx !== 0 || dy !== 0) {
            // Player is moving
            state.player.isIdle = false;
            state.player.lastMoveTime = Date.now();
        } else {
            state.player.isIdle = true;
        }
    }

    // --- Physics Update (Game Logic Tick) ---
    function updatePhysics() {
        const now = Date.now();
        
        // 1. Player Movement & Boundary Check
        state.player.x += state.player.dx;
        state.player.y += state.player.dy;

        const worldW = elements.world.offsetWidth;
        const worldH = elements.world.offsetHeight;
        
        state.player.x = Math.max(0, Math.min(state.player.x, worldW - elements.playerEl.offsetWidth));
        state.player.y = Math.max(0, Math.min(state.player.y, worldH - elements.playerEl.offsetHeight));
        
        // 2. Mom's AI (Chasing)
        const momDX = state.player.x - state.mom.x;
        const momDY = state.player.y - state.mom.y;
        const momDist = Math.sqrt(momDX * momDX + momDY * momDY);
        
        // Mom moves towards the player
        state.mom.x += (momDX / momDist) * state.mom.speed;
        state.mom.y += (momDY / momDist) * state.mom.speed;
        
        // Mom attack logic (If Mom is close, she attacks based on Idle Timer)
        if (momDist < state.mom.range) {
            state.mom.isNear = true;
            // The actual attack is triggered by the Idle Timer (Rule of the game)
        } else {
            state.mom.isNear = false;
        }

        // 3. Chore/Boost Interaction
        state.chores.forEach(chore => {
            if (!chore.isDone && calculateDistance(state.player.x, state.player.y, chore.x, chore.y) < CHORE_RANGE) {
                // If player is close AND hits SPACE/E, they could complete the chore
                // Simplified: Auto-complete when close for demo
                // if (state.activeKeys['e']) { chore.complete(); } // Add this for a more advanced version
                chore.complete(); 
            }
        });

        state.boosts.forEach(boost => {
            if (calculateDistance(state.player.x, state.player.y, boost.x, boost.y) < 50) {
                boost.collect();
            }
        });
        
        // 4. Idle Danger Check (The Core Chore-Core Rule)
        const idleTime = now - state.player.lastMoveTime;
        elements.idleDanger.style.width = `${Math.min(100, (idleTime / MAX_IDLE_TIME) * 100)}%`;

        if (state.player.isIdle && idleTime >= MAX_IDLE_TIME) {
            if (now - state.mom.lastStrikeTime > GAME_TICK * 2) { // Prevents rapid-fire hits
                // Mom hits the player!
                state.player.hp -= state.mom.damage;
                state.mom.lastStrikeTime = now;
                elements.playerEl.style.backgroundColor = 'var(--mom-color)';
                setTimeout(() => { elements.playerEl.style.backgroundColor = 'var(--player-color)'; }, 100);
                displayMessage(`WHAP! Idle too long! (-${state.mom.damage} HP)`, 'var(--mom-color)');
                if (state.player.hp <= 0) {
                    endGame('DEFEAT: You ran out of HP! The chores won.');
                }
            }
        }
    }

    // --- Rendering Update (Frame update) ---
    function updateDisplay() {
        // Player and Mom rendering (3D positioning)
        elements.playerEl.style.transform = `translate(${state.player.x}px, ${state.player.y}px) translateZ(10px)`;
        elements.momEl.style.transform = `translate(${state.mom.x}px, ${state.mom.y}px) translateZ(10px)`;
        
        // Entity updates
        state.chores.forEach(c => c.updatePosition());
        state.boosts.forEach(b => b.updatePosition());

        // HUD updates
        elements.hpValue.textContent = state.player.hp;
        elements.speedValue.textContent = state.player.speed;
        elements.scoreValue.textContent = state.player.score;
        
        // Mom's proximity visual feedback
        if (state.mom.isNear || state.player.isIdle) {
            elements.momEl.classList.add('belt-ready');
        } else {
            elements.momEl.classList.remove('belt-ready');
        }
    }

    // --- Game Loop and Utilities ---

    function gameLoop(timestamp) {
        if (!state.running) return;

        handleMovement(); // Update desired direction from keys
        
        // Throttle physics updates to a consistent interval
        if (timestamp - state.lastUpdateTime >= GAME_TICK) {
            updatePhysics();
            state.lastUpdateTime = timestamp;
        }
        
        updateDisplay(); // Render every frame
        requestAnimationFrame(gameLoop);
    }
    
    function calculateDistance(x1, y1, x2, y2) {
        return Math.sqrt(Math.pow(x2 - x1, 2) + Math.pow(y2 - y1, 2));
    }

    function endGame(message) {
        state.running = false;
        alert(`GAME OVER! ${message}`);
    }

    // Start the game!
    window.onload = initGame;
    
</script>

</body>
</html>
