<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ATLAS — Simple Simulation Console (LOCAL ONLY)</title>
<link href="https://fonts.googleapis.com/css2?family=Inconsolata:wght@400;700&display=swap" rel="stylesheet">
<style>
  :root{
    --bg:#060608;
    --panel:#0d0e10;
    --accent:#00ff66;
    --muted:#9aa;
    --radius:10px;
    --mono: "Inconsolata", monospace;
  }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;background:linear-gradient(180deg,#000,#05030b);color:#dfe;font-family:var(--mono),monospace}
  .wrap{max-width:1000px;margin:24px auto;padding:18px;display:grid;grid-template-columns:320px 1fr;gap:16px}
  .panel{background:var(--panel);padding:12px;border-radius:var(--radius);border:1px solid rgba(255,255,255,0.03)}
  .title{display:flex;align-items:center;gap:8px;margin-bottom:8px}
  .logo{font-weight:700;color:var(--accent);font-size:1.1rem}
  .help{color:var(--muted);font-size:0.85rem}
  /* Left column */
  .targets{display:flex;flex-direction:column;gap:8px}
  .target{padding:8px;border-radius:8px;background:rgba(255,255,255,0.01);cursor:pointer;display:flex;justify-content:space-between;align-items:center}
  .target.selected{outline:2px solid rgba(0,255,102,0.12);box-shadow:0 6px 14px rgba(0,255,102,0.03)}
  .actions{margin-top:12px;display:flex;gap:8px}
  button{font-family:var(--mono);padding:8px 10px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:#dfe;cursor:pointer}
  button.primary{background:linear-gradient(90deg, rgba(0,255,102,0.05), transparent);border-color:rgba(0,255,102,0.12)}
  /* Right column (terminal) */
  .terminal{height:62vh;display:flex;flex-direction:column}
  .output{flex:1;background:#050507;padding:12px;border-radius:8px;overflow:auto;border:1px solid rgba(255,255,255,0.02);font-size:13px;line-height:1.35}
  .controls{display:flex;gap:8px;margin-top:10px;align-items:center}
  input[type="text"]{flex:1;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.03);background:transparent;color:#dfe;font-family:var(--mono)}
  .small{font-size:12px;color:var(--muted)}
  .kbd{background:rgba(255,255,255,0.02);padding:3px 6px;border-radius:6px;border:1px solid rgba(255,255,255,0.02)}
  .log-line{white-space:pre-wrap;margin:6px 0}
  .muted-note{color:var(--muted);font-size:12px;margin-top:8px}
  /* compact mobile */
  @media (max-width:820px){
    .wrap{grid-template-columns:1fr; padding:12px}
  }
</style>
</head>
<body>
  <main class="wrap" role="main" aria-label="ATLAS simple simulation console">
    <section class="panel" aria-label="Targets">
      <div class="title">
        <div class="logo">ATLAS SIM</div>
        <div class="help small">Local demo • no network • safe</div>
      </div>

      <div>
        <div class="small muted-note">Pick a simulated target to inspect and operate on.</div>
        <div id="targets" class="targets" role="list" aria-label="Simulated targets"></div>
      </div>

      <div class="actions">
        <button id="btnSimLogin" class="primary">Sim Login</button>
        <button id="btnApply">Apply</button>
      </div>

      <div class="muted-note" style="margin-top:10px">
        Shortcuts: Up/Down (history), Tab (autocomplete), Ctrl+Enter (run payload — disabled in simplified view).
      </div>
    </section>

    <section class="panel terminal" aria-label="Terminal">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
        <div>
          <strong>Terminal</strong>
          <div class="small">Simple commands: help, list, select, status, apply, clear, export</div>
        </div>
        <div class="small">Target: <span id="currentTarget">— none —</span></div>
      </div>

      <div id="output" class="output" role="log" aria-live="polite" tabindex="0"></div>

      <div class="controls">
        <input id="cmd" type="text" placeholder='Type a command (help)' aria-label="Command input" />
        <button id="run" class="primary">Run</button>
        <button id="clear">Clear</button>
      </div>

      <div class="muted-note">This page is intentionally simple and local-only. Do NOT paste real credentials.</div>
    </section>
  </main>

<script>
/*
  Simplified hack-like simulation:
  - Local-only simulated targets (stored in localStorage)
  - Very small command set and clear UI
  - Command history (Up/Down) and Tab autocomplete
  - No payload editor, no network, no real credential handling
*/

const DEFAULT = [
  { id:'site-1', name:'NOVA SHOP', url:'nova-shop.local', settings:{maintenance:false, homepage:'Welcome to Nova!'}, accounts:[{user:'admin@nova', pass:'pass1'}], logs:[] },
  { id:'site-2', name:'SKYCHAT', url:'skychat.local', settings:{maintenance:true, homepage:'SkyChat is offline'}, accounts:[{user:'root@sky', pass:'root'}], logs:[] },
  { id:'site-3', name:'UNI LIBRARY', url:'lib.uni.local', settings:{maintenance:false, homepage:'Read & learn'}, accounts:[], logs:[] }
];

const STORAGE_KEY = 'atlas_simple_targets_v1';

function loadTargets(){
  try {
    const raw = localStorage.getItem(STORAGE_KEY);
    if(!raw){ localStorage.setItem(STORAGE_KEY, JSON.stringify(DEFAULT)); return JSON.parse(JSON.stringify(DEFAULT)); }
    return JSON.parse(raw);
  } catch(e){ console.error(e); return JSON.parse(JSON.stringify(DEFAULT)); }
}
function saveTargets(t){ localStorage.setItem(STORAGE_KEY, JSON.stringify(t)); }

let targets = loadTargets();
let selected = null;

/* UI refs */
const targetsEl = document.getElementById('targets');
const output = document.getElementById('output');
const cmdInput = document.getElementById('cmd');
const runBtn = document.getElementById('run');
const clearBtn = document.getElementById('clear');
const currentTargetSpan = document.getElementById('currentTarget');
const btnSimLogin = document.getElementById('btnSimLogin');
const btnApply = document.getElementById('btnApply');

/* Command history + autocomplete */
let history = JSON.parse(localStorage.getItem('atlas_cmd_history') || '[]');
let histIndex = history.length;
const COMMANDS = ['help','list','select','status','login','apply','clear','export','info'];

function persistHistory(){
  localStorage.setItem('atlas_cmd_history', JSON.stringify(history.slice(-200)));
}

/* Render target list (very simple) */
function renderTargets(){
  targetsEl.innerHTML = '';
  targets.forEach(t=>{
    const div = document.createElement('div');
    div.className = 'target' + (selected && selected.id===t.id ? ' selected' : '');
    div.tabIndex = 0;
    div.setAttribute('role','button');
    div.innerHTML = `<div><strong>${t.name}</strong><div class="small" style="color:var(--muted)">${t.url}</div></div>
                     <div class="small">${t.settings.maintenance ? 'MAINT' : 'OK'}</div>`;
    div.addEventListener('click', ()=> selectTarget(t.id));
    div.addEventListener('keydown', (e)=> { if(e.key==='Enter' || e.key===' ') selectTarget(t.id); });
    targetsEl.appendChild(div);
  });
}

/* Terminal helpers */
function log(s, cls=''){
  const d = document.createElement('div');
  d.className = 'log-line ' + cls;
  d.textContent = `[${new Date().toLocaleTimeString()}] ${s}`;
  output.appendChild(d);
  output.scrollTop = output.scrollHeight;
}

/* Basic commands */
async function runCommand(raw){
  const line = raw.trim();
  if(!line) return;
  history.push(line); persistHistory(); histIndex = history.length;
  log('> ' + line, ''); // echo
  const parts = line.split(/\s+/);
  const cmd = parts.shift().toLowerCase();

  switch(cmd){
    case 'help':
      log('Commands: help, list, select <id|name>, status, login <user> <pass> (sim), apply (sim), export <id>, clear', 'status-ok');
      break;
    case 'list':
      targets.forEach(t => log(`${t.id} — ${t.name} — ${t.url} — maintenance=${t.settings.maintenance}`));
      break;
    case 'select':
      if(parts.length === 0){ log('select requires id or name', 'status-err'); break; }
      const q = parts.join(' ');
      const found = targets.find(t => t.id === q || t.name.toLowerCase() === q.toLowerCase());
      if(found){ selectTarget(found.id); log(`Selected ${found.name}`, 'status-ok'); } else log('target not found', 'status-err');
      break;
    case 'status':
      if(!selected){ log('no target selected', 'status-err'); break; }
      log(JSON.stringify(selected.settings, null, 2));
      break;
    case 'login':
      if(!selected){ log('select a target first', 'status-err'); break; }
      if(parts.length < 2){ log('usage: login <user> <pass>', 'status-err'); break; }
      const user = parts[0], pass = parts[1];
      const acct = selected.accounts.find(a => a.user === user && a.pass === pass);
      if(acct){ log(`[AUTH] Success role=${acct.role || 'user'}`, 'status-ok'); selected.logs.push(`[auth] ${new Date().toISOString()} ${user} success`); saveTargets(targets); }
      else { log('[AUTH] Failed', 'status-err'); selected.logs.push(`[auth] ${new Date().toISOString()} ${user} failed`); saveTargets(targets); }
      break;
    case 'apply':
      if(!selected){ log('no target selected', 'status-err'); break; }
      // small simulated apply
      log('[APPLY] Running simulated deploy...', 'status-warn');
      await new Promise(r=>setTimeout(r,400));
      log('[APPLY] Completed (local only).', 'status-ok');
      selected.logs.push(`[apply] ${new Date().toISOString()}`);
      saveTargets(targets);
      break;
    case 'export':
      // export a target JSON
      let toExport = selected;
      if(parts.length>0){ toExport = targets.find(t => t.id === parts[0]); if(!toExport){ log('target not found', 'status-err'); break; } }
      downloadJson(toExport, `${toExport.id}.json`);
      log('Exported JSON (download started)', 'status-ok');
      break;
    case 'clear':
      output.innerHTML = '';
      break;
    case 'info':
      log('Simple ATLAS simulator — local only. Use responsibly for learning.', 'status-ok');
      break;
    default:
      log('Unknown command: ' + cmd, 'status-err');
  }
}

/* select a target programmatically */
function selectTarget(id){
  selected = targets.find(t => t.id === id) || null;
  currentTargetSpan.textContent = selected ? selected.name : '— none —';
  renderTargets();
}

/* small helper: download JSON */
function downloadJson(obj, filename){
  const blob = new Blob([JSON.stringify(obj, null, 2)], { type: 'application/json' });
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = filename;
  document.body.appendChild(a);
  a.click();
  a.remove();
}

/* Autocomplete: tab cycles suggestions for commands and target names */
function autocomplete(inputValue){
  const caret = inputValue;
  const parts = caret.split(/\s+/);
  if(parts.length <= 1){
    // suggest commands
    const prefix = parts[0] ? parts[0].toLowerCase() : '';
    const matches = COMMANDS.concat(targets.map(t=>t.id)).filter(x => x.toLowerCase().startsWith(prefix) && x.toLowerCase() !== prefix);
    return matches;
  } else {
    // after a command, suggest target ids or names for select/export
    const cmd = parts[0].toLowerCase();
    if(['select','export'].includes(cmd)){
      const prefix = parts.slice(1).join(' ');
      return targets.map(t=>t.id).filter(x => x.startsWith(prefix));
    }
    return [];
  }
}

/* Keyboard handling: history and tab */
cmdInput.addEventListener('keydown', (ev) => {
  if(ev.key === 'ArrowUp'){
    if(history.length === 0) return;
    ev.preventDefault();
    histIndex = Math.max(0, histIndex - 1);
    cmdInput.value = history[histIndex] || '';
  } else if(ev.key === 'ArrowDown'){
    if(history.length === 0) return;
    ev.preventDefault();
    histIndex = Math.min(history.length, histIndex + 1);
    cmdInput.value = history[histIndex] || '';
  } else if(ev.key === 'Tab'){
    ev.preventDefault();
    const matches = autocomplete(cmdInput.value);
    if(matches && matches.length > 0){
      // if single match, complete; if multiple, show the first and rotate suggestions on repeated Tab
      const current = cmdInput.value;
      // store rotation in dataset
      const key = 'autocompleteIndex';
      const idx = Number(cmdInput.dataset[key] || 0) % matches.length;
      cmdInput.value = (current.split(/\s+/)[0] ? current.split(/\s+/)[0] + ' ' : '') + matches[idx];
      cmdInput.dataset[key] = (idx + 1);
    }
  } else if(ev.key === 'Enter' && ev.ctrlKey){
    // ctrl+enter reserved, but simplified view does nothing special
    ev.preventDefault();
    log('[INFO] Ctrl+Enter reserved for advanced operations (disabled in this simplified view).', 'status-warn');
  } else if(ev.key === 'Enter'){
    ev.preventDefault();
    const v = cmdInput.value;
    cmdInput.value = '';
    runCommand(v);
  }
});

/* Button bindings */
runBtn.addEventListener('click', ()=> { const v = cmdInput.value.trim(); if(v){ cmdInput.value=''; runCommand(v); } });
clearBtn.addEventListener('click', ()=> { output.innerHTML=''; });

btnSimLogin.addEventListener('click', ()=> {
  if(!selected){ log('no target selected', 'status-err'); return; }
  // small fake login flow
  const user = prompt('Sim username (local only):','admin@demo');
  if(!user) { log('Sim login cancelled', 'status-warn'); return; }
  const pass = prompt('Sim password (local only):','password');
  if(!pass) { log('Sim login cancelled', 'status-warn'); return; }
  const acct = selected.accounts.find(a => a.user === user && a.pass === pass);
  if(acct){ log(`[AUTH] Success user=${user}`, 'status-ok'); selected.logs.push(`[auth] ${new Date().toISOString()} ${user} success`); saveTargets(targets); }
  else { log('[AUTH] Failed (sim)', 'status-err'); selected.logs.push(`[auth] ${new Date().toISOString()} ${user} failed`); saveTargets(targets); }
});

btnApply.addEventListener('click', async ()=> {
  if(!selected){ log('no target selected', 'status-err'); return; }
  log('[APPLY] Simulated apply starting...', 'status-warn');
  await new Promise(r=>setTimeout(r, 300));
  log('[APPLY] Done (local only)', 'status-ok');
  selected.logs.push(`[apply] ${new Date().toISOString()}`);
  saveTargets(targets);
});

/* Initialization */
renderTargets();
appendStartup();

function appendStartup(){
  log('ATLAS simple simulator initialized. Type "help" for commands.', 'status-ok');
  // restore last selected target if exists
  const lastId = localStorage.getItem('atlas_last_selected');
  if(lastId){
    const s = targets.find(t=>t.id === lastId);
    if(s) selectTarget(s.id);
  }
}

/* Save selected on unload */
window.addEventListener('beforeunload', ()=> {
  if(selected) localStorage.setItem('atlas_last_selected', selected.id);
});

/* expose for debugging (safe) */
window._ATLAS_SIMPLE = { targets, runCommand, selectTarget };

</script>
</body>
</html>
