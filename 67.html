<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Social Nexus - Mobile</title>
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#0f0f23">
    <style>
        /* (All the CSS from the previous mobile version – unchanged) */
        *, *::before, *::after {box-sizing:border-box;-webkit-tap-highlight-color:transparent;}
        html,body{margin:0;padding:0;height:100%;width:100%;overflow:hidden;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;background:#0f0f23;color:#e0e0e0;}
        #login{flex:1;display:flex;align-items:center;justify-content:center;padding:2rem;background:#0f0f23;}
        #login form{width:100%;max-width:320px;display:flex;flex-direction:column;gap:1.2rem;}
        #login input{padding:1rem 1.2rem;border:none;border-radius:12px;background:rgba(255,255,255,.08);color:#e0e0e0;font-size:1.1rem;backdrop-filter:blur(10px);}
        #login button{padding:1rem;background:linear-gradient(45deg,#667eea,#764ba2);border:none;border-radius:12px;color:white;font-weight:600;font-size:1.1rem;cursor:pointer;transition:transform .2s;}
        #login button:active{transform:scale(.96);}
        /* ... (rest of the CSS – identical to the mobile version you already have) ... */
    </style>
</head>
<body>
    <!-- ==== LOGIN ==== -->
    <div id="login">
        <form id="loginForm">
            <input type="text" id="username" placeholder="Username" required>
            <input type="password" id="password" placeholder="Password" required>
            <button type="submit">Login</button>
        </form>
    </div>

    <!-- ==== APP (unchanged) ==== -->
    <div id="app" style="display:none;">
        <!-- ... (all the app markup from the previous mobile version) ... -->
    </div>

    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <script>
        class SocialNexus {
            constructor() {
                this.users = {
                    'EthanUnlocked': 'h4cker',
                    'Beef Wellington': 'Eat_me',
                    'GyattmodePlays': 'justmyusername'
                };
                this.currentUser = null;
                this.peer = null;
                this.connections = {};
                this.calls = {};
                this.localStream = null;
                this.messageHistory = {};
                this.currentPeerId = null;
                this.isInCall = false;
                this.micEnabled = true;
                this.camEnabled = true;
                this.notificationPermission = 'default';
                this.unreadCounts = {};
                this.typingTimeouts = {};
                this.isTyping = false;
                this.isAppFocused = true;
                this.fileTransfers = {};
                this.voiceRecorder = null;
                this.isRecording = false;
                this.CHUNK_SIZE = 16384;
                this.MAX_FILE_SIZE = 10 * 1024 * 1024;

                this.init();
            }

            async init() {
                this.bindEvents();
                await this.requestNotificationPermission();
                this.setupDragDrop();
                this.setupTouchFeedback();
            }

            bindEvents() {
                // ← THIS LINE NOW WORKS BECAUSE id="loginForm" EXISTS
                document.getElementById('loginForm').addEventListener('submit', e => this.handleLogin(e));

                // ... (rest of the event listeners – unchanged) ...
            }

            handleLogin(e) {
                e.preventDefault();               // ← stops refresh
                const username = document.getElementById('username').value.trim();
                const password = document.getElementById('password').value.trim();

                if (this.users[username] && this.users[username] === password) {
                    this.currentUser = username;
                    document.getElementById('login').style.display = 'none';
                    document.getElementById('app').style.display = 'flex';
                    this.setupPeerAfterLogin();
                    this.populateUserList();
                    this.closeSidebar();
                } else {
                    alert('Invalid credentials.');
                }
            }

            // ... (all other methods from the previous mobile version – unchanged) ...
        }

        new SocialNexus();
    </script>
</body>
</html>
